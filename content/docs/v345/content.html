

  <div class="section" id="welcome-to-casadi-s-documentation">
<h1>Welcome to CasADi’s documentation!<a class="headerlink" href="#welcome-to-casadi-s-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-intro"></span><div class="section" id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>CasADi is an open-source software tool for numerical optimization in general and optimal control
(i.e. optimization involving differential equations) in particular. The project was started by
Joel Andersson and Joris Gillis while PhD students at the Optimization in Engineering Center
(OPTEC) of the KU Leuven under supervision of Moritz Diehl.</p>
<p>This document aims at giving a condensed introduction to CasADi. After reading it, you should be able to formulate and manipulate expressions in CasADi’s symbolic framework, generate derivative information efficiently using <em>algorithmic differentiation</em>, to set up, solve and perform forward and adjoint sensitivity analysis for systems of ordinary differential equations (ODE) or differential-algebraic equations (DAE) as well as to formulate and solve nonlinear programs (NLP) problems and optimal control problems (OCP).</p>
<p>CasADi is available for C++, Python and MATLAB/Octave with little or no difference in performance. In general, the Python API is the best documented and is slightly more stable than the MATLAB API. The C++ API is stable, but is not ideal for getting started with CasADi since there is limited documentation and since it lacks the interactivity of interpreted languages like MATLAB and Python. The MATLAB module has been tested successfully for Octave (version 4.0.2 or later).</p>
<div class="section" id="what-casadi-is-and-what-it-is-not">
<h3>1.1. What CasADi is and what it is <em>not</em><a class="headerlink" href="#what-casadi-is-and-what-it-is-not" title="Permalink to this headline">¶</a></h3>
<p>CasADi started out as a tool for algorithmic differentiation (AD) using a syntax borrowed from computer algebra systems (CAS), which explains its name. While AD still forms one of the core functionalities of the tool, the scope of the tool has since been considerably broadened, with the addition of support for ODE/DAE integration and sensitivity analysis, nonlinear programming and interfaces to other numerical tools. In its current form, it is a general-purpose tool for gradient-based numerical optimization – with a strong focus on optimal control – and CasADi is just a name without any particular meaning.</p>
<p>It is important to point out that CasADi is <em>not</em> a conventional AD tool, that can be used to calculate derivative information from existing user code with little to no modification. If you have an existing model written in C++, Python or MATLAB/Octave, you need to be prepared to reimplement the model using CasADi syntax.</p>
<p>Secondly, CasADi is <em>not</em> a computer algebra system. While the symbolic core does include an increasing set of tools for manipulate symbolic expressions, these capabilities are very limited compared to a proper CAS tool.</p>
<p>Finally, CasADi is not an “optimal control problem solver”, that allows the user to enter an OCP and then gives the solution back. Instead, it tries to provide the user with a set of “building blocks” that can be used to implement general-purpose or specific-purpose OCP solvers efficiently with a modest programming effort.</p>
</div>
<div class="section" id="help-and-support">
<span id="sec-support"></span><h3>1.2. Help and support<a class="headerlink" href="#help-and-support" title="Permalink to this headline">¶</a></h3>
<p>If you find simple bugs or lack some feature that you think would be relatively easy for us to add, the simplest thing is simply to write to the forum, located at <a class="reference external" href="http://forum.casadi.org/">http://forum.casadi.org/</a>. We check the forum regularly and try to respond as quickly as possible. The only thing we expect for this kind of support is that you cite us, cf. <a class="reference internal" href="#sec-citing"><span class="std std-numref">Section 1.3</span></a>, whenever you use CasADi in scientific work.</p>
<p>If you want more help, we are always open for academic or industrial cooperation. An academic cooperation usually take the form of a co-authorship of a peer reviewed paper, and an industrial cooperation involves a negotiated consulting contract. Please contact us directly if you are interested in this.</p>
</div>
<div class="section" id="citing-casadi">
<span id="sec-citing"></span><h3>1.3. Citing CasADi<a class="headerlink" href="#citing-casadi" title="Permalink to this headline">¶</a></h3>
<p>If you use CasADi in published scientific work, please cite the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@Article{Andersson2018,
  Author = {Joel A E Andersson and Joris Gillis and Greg Horn
            and James B Rawlings and Moritz Diehl},
  Title = {{CasADi} -- {A} software framework for nonlinear optimization
           and optimal control},
  Journal = {Mathematical Programming Computation},
  Year = {In Press, 2018},
}
</pre></div>
</div>
</div>
<div class="section" id="reading-this-document">
<h3>1.4. Reading this document<a class="headerlink" href="#reading-this-document" title="Permalink to this headline">¶</a></h3>
<p>The goal of this document is to make the reader familiar with the syntax of CasADi and provide easily available building blocks to build numerical optimization and dynamic optimization software. Our explanation is mostly program code driven and provides little mathematical background knowledge. We assume that the reader already has a fair knowledge of theory of optimization theory, solution of initial-value problems in differential equations and the programming language in question (C++, Python or MATLAB/Octave).</p>
<p>We will use Python and MATLAB/Octave syntax side-by-side in this guide, noting that the Python interface is more stable and better documented. Unless otherwise noted, the MATLAB/Octave syntax also applies to Octave. We try to point out the instances where has a diverging syntax. To facilitate switching between the programming languages, we also list the major differences in <a class="reference internal" href="index.html#sec-syntax-differences"><span class="std std-numref">Chapter 10</span></a>.</p>
</div>
</div>
<span id="document-install"></span><div class="section" id="obtaining-and-installing">
<h2>2. Obtaining and installing<a class="headerlink" href="#obtaining-and-installing" title="Permalink to this headline">¶</a></h2>
<p>CasADi is an open-source tool, available under LGPL license, which is a permissive license that allows the tool to be used royalty-free also in commercial closed-source applications. The main restriction of LGPL is that if you decide to modify CasADi’s source code as opposed to just using the tool for your application, these changes (a “derivative-work” of CasADi) must be released under LGPL as well.</p>
<p>The source code is hosted on GitHub and has a core written in self-contained C++ code, relying on nothing but the C++ Standard Library. Its front-ends to Python and MATLAB/Octave are full-featured and auto-generated using the tool <a class="reference external" href="http://www.swig.org/">SWIG</a>. These front-ends are unlikely to result in noticeable loss of efficiency. CasADi can be used on Linux, OS X and Windows.</p>
<p>For up-to-date installation instructions, visit CasADi’s install section: <a class="reference external" href="http://install.casadi.org/">http://install.casadi.org/</a></p>
</div>
<span id="document-symbolic"></span><div class="section" id="symbolic-framework">
<h2>3. Symbolic framework<a class="headerlink" href="#symbolic-framework" title="Permalink to this headline">¶</a></h2>
<p>At the core of CasADi is a self-contained symbolic framework that allows the user to construct symbolic expressions using a MATLAB inspired everything-is-a-matrix syntax, i.e. vectors are treated as n-by-1 matrices and scalars as 1-by-1 matrices. All matrices are <em>sparse</em> and use a general sparse format – <em>compressed column storage</em> (CCS) – to store matrices. In the following, we introduce the most fundamental classes of this framework.</p>
<div class="section" id="the-sx-symbolics">
<h3>3.1. The <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> symbolics<a class="headerlink" href="#the-sx-symbolics" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> data type is used to represent matrices whose elements consist of symbolic expressions made up by a sequence of unary and binary operations. To see how it works in practice, start an interactive Python shell (e.g. by typing <code class="docutils literal notranslate"><span class="pre">ipython</span></code> from a Linux terminal or inside a integrated development environment such as Spyder) or launch MATLAB’s or Octave’s graphical user interface. Assuming CasADi has been installed correctly, you can import the symbols into the workspace as follows:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">casadi</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">import</span> <span class="n">casadi</span><span class="o">.*</span>
</pre></div>
</div>
</div>
</div>
<p>Now create a variable <code class="docutils literal notranslate"><span class="pre">x</span></code> using the syntax:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>x
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>x =

x

</pre></div>
</div>
</div>
</div>
<p>This creates a 1-by-1 matrix, i.e. a scalar containing a symbolic primitive called <code class="docutils literal notranslate"><span class="pre">x</span></code>. This is just the display name, not the identifier. Multiple variables can have the same name, but still be different. The identifier is the return value. You can also create vector- or matrix-valued symbolic variables by supplying additional arguments to <code class="docutils literal notranslate"><span class="pre">SX.sym</span></code>:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[y_0, y_1, y_2, y_3, y_4]
[[Z_0, Z_4],
 [Z_1, Z_5],
 [Z_2, Z_6],
 [Z_3, Z_7]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Z</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>y =

[y_0, y_1, y_2, y_3, y_4]

Z =


[[Z_0, Z_4],
 [Z_1, Z_5],
 [Z_2, Z_6],
 [Z_3, Z_7]]

</pre></div>
</div>
</div>
</div>
<p>which creates a 5-by-1 matrix, i.e. a vector, and a 4-by-2 matrix with symbolic primitives, respectively.</p>
<p><code class="docutils literal notranslate"><span class="pre">SX.sym</span></code> is a (static) function which returns an <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> instance. When variables have been declared, expressions can now be formed in an intuitive way:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">10</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>sqrt((10+sq(x)))
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="p">=</span> <span class="n">x</span>^<span class="mi">2</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">f</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="nb">display</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f =

sqrt((10+sq(x)))

</pre></div>
</div>
</div>
</div>
<p>You can also create constant <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> instances <em>without</em> any symbolic primitives:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">B1</span> <span class="pre">=</span> <span class="pre">SX.zeros(4,5)</span></code>: A dense 4-by-5 empty matrix with all zeros</li>
<li><code class="docutils literal notranslate"><span class="pre">B2</span> <span class="pre">=</span> <span class="pre">SX(4,5)</span></code>: A sparse 4-by-5 empty matrix with all zeros</li>
<li><code class="docutils literal notranslate"><span class="pre">B4</span> <span class="pre">=</span> <span class="pre">SX.eye(4)</span></code>: A sparse 4-by-4 matrix with ones on the diagonal</li>
</ul>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>B1: @1=0,
[[@1, @1, @1, @1, @1],
 [@1, @1, @1, @1, @1],
 [@1, @1, @1, @1, @1],
 [@1, @1, @1, @1, @1]]
B2:
[[00, 00, 00, 00, 00],
 [00, 00, 00, 00, 00],
 [00, 00, 00, 00, 00],
 [00, 00, 00, 00, 00]]
B4: @1=1,
[[@1, 00, 00, 00],
 [00, @1, 00, 00],
 [00, 00, @1, 00],
 [00, 00, 00, @1]]
</pre></div>
</div>
<p>Note the difference between a sparse matrix with <em>structural</em> zeros and a dense matrix with <em>actual</em> zeros. When printing an expression with structural zeros, these will be represented as <code class="docutils literal notranslate"><span class="pre">00</span></code> to distinguish them from actual zeros <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>The following list summarizes the most commonly used ways of constructing new <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> expressions:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SX.sym(name,n,m)</span></code>: Create an <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(m\)</span> symbolic primitive</li>
<li><code class="docutils literal notranslate"><span class="pre">SX.zeros(n,m)</span></code>: Create an <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(m\)</span> dense matrix with all zeros</li>
<li><code class="docutils literal notranslate"><span class="pre">SX(n,m)</span></code>: Create an <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(m\)</span> sparse matrix with all <em>structural</em> zeros</li>
<li><code class="docutils literal notranslate"><span class="pre">SX.ones(n,m)</span></code>: Create an <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(m\)</span> dense matrix with all ones</li>
<li><code class="docutils literal notranslate"><span class="pre">SX.eye(n)</span></code>: Create an <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(n\)</span> diagonal matrix with ones on the diagonal and structural zeros elsewhere.</li>
<li><code class="docutils literal notranslate"><span class="pre">SX(scalar_type)</span></code>: Create a scalar (1-by-1 matrix) with value given by the argument. This method can be used explicitly, e.g. <code class="docutils literal notranslate"><span class="pre">SX(9)</span></code>, or implicitly, e.g. <code class="docutils literal notranslate"><span class="pre">9</span> <span class="pre">*</span> <span class="pre">SX.ones(2,2)</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">SX(matrix_type)</span></code>: Create a matrix given a numerical matrix given as a NumPy or SciPy matrix (in Python) or as a dense or sparse matrix (in MATLAB/Octave). In MATLAB/Octave e.g. <code class="docutils literal notranslate"><span class="pre">SX([1,2,3,4])</span></code> for a row vector, <code class="docutils literal notranslate"><span class="pre">SX([1;2;3;4])</span></code> for a column vector and <code class="docutils literal notranslate"><span class="pre">SX([1,2;3,4])</span></code> for a 2-by-2 matrix. This method can be used explicitly or implicitly.</li>
<li><code class="docutils literal notranslate"><span class="pre">repmat(v,n,m)</span></code>: Repeat expression <span class="math notranslate nohighlight">\(v\)</span> <span class="math notranslate nohighlight">\(n\)</span> times vertically and <span class="math notranslate nohighlight">\(m\)</span> times horizontally. <code class="docutils literal notranslate"><span class="pre">repmat(SX(3),2,1)</span></code> will create a 2-by-1 matrix with all elements 3.</li>
<li>(<em>Python only</em>) <code class="docutils literal notranslate"><span class="pre">SX(list)</span></code>: Create a column vector (<span class="math notranslate nohighlight">\(n\)</span>-by-1 matrix) with the elements in the list, e.g. <code class="docutils literal notranslate"><span class="pre">SX([1,2,3,4])</span></code> (note the difference between Python lists and MATLAB/Octave horizontal concatenation, which both uses square bracket syntax)</li>
<li>(<em>Python only</em>) <code class="docutils literal notranslate"><span class="pre">SX(list</span> <span class="pre">of</span> <span class="pre">list)</span></code>: Create a dense matrix with the elements in the lists, e.g. <code class="docutils literal notranslate"><span class="pre">SX([[1,2],[3,4]])</span></code> or a row vector (1-by-<span class="math notranslate nohighlight">\(n\)</span> matrix) using <code class="docutils literal notranslate"><span class="pre">SX([[1,2,3,4]])</span></code>.</li>
</ul>
<div class="section" id="note-on-namespaces">
<h4>3.1.1. Note on namespaces<a class="headerlink" href="#note-on-namespaces" title="Permalink to this headline">¶</a></h4>
<p>In MATLAB, if the <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">casadi.*</span></code> command is omitted, you can still use CasADi by prefixing all the symbols with the package name, e.g. <code class="docutils literal notranslate"><span class="pre">casadi.SX</span></code> instead of <code class="docutils literal notranslate"><span class="pre">SX</span></code>, provided the <code class="docutils literal notranslate"><span class="pre">casadi</span></code> package is in the path. We will not do this in the following for typographical reasons, but note that it is often preferable in user code. In Python, this usage corresponds to issuing <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">casadi</span></code> instead of <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">casadi</span> <span class="pre">import</span> <span class="pre">*</span></code>.</p>
<p>Unfortunately, Octave (version 4.0.3) does not implement MATLAB’s <code class="docutils literal notranslate"><span class="pre">import</span></code> command. To work around this issue, we provide a simple
function <code class="docutils literal notranslate"><span class="pre">import.m</span></code> that can be placed in Octave’s path enabling the compact syntax used in this guide.</p>
</div>
<div class="section" id="note-for-c-users">
<h4>3.1.2. Note for C++ users<a class="headerlink" href="#note-for-c-users" title="Permalink to this headline">¶</a></h4>
<p>In C++, all public symbols are defined in the <code class="docutils literal notranslate"><span class="pre">casadi</span></code> namespace and require the inclusion of the <code class="docutils literal notranslate"><span class="pre">casadi/casadi.hpp</span></code> header file.
The commands above would be equivalent to:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;casadi/casadi.hpp&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">casadi</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">SX</span> <span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">::</span><span class="n">sym</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span>
  <span class="n">SX</span> <span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">::</span><span class="n">sym</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">SX</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">SX</span><span class="o">::</span><span class="n">sym</span><span class="p">(</span><span class="s">&quot;Z&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">SX</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
  <span class="n">f</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;f: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">f</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dm">
<h3>3.2. <code class="xref py py-class docutils literal notranslate"><span class="pre">DM</span></code><a class="headerlink" href="#dm" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">DM</span></code> is very similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code>, but with the difference that the nonzero elements are numerical values and not symbolic expressions. The syntax is also the same, except for functions such as <code class="docutils literal notranslate"><span class="pre">SX.sym</span></code>, which have no equivalents.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">DM</span></code> is mainly used for storing matrices in CasADi and as inputs and outputs of functions. It is <em>not</em> intended to be used for computationally intensive calculations. For this purpose, use the builtin dense or sparse data types in MATLAB, NumPy or SciPy matrices in Python or an expression template based library such as <code class="docutils literal notranslate"><span class="pre">eigen</span></code>, <code class="docutils literal notranslate"><span class="pre">ublas</span></code> or <code class="docutils literal notranslate"><span class="pre">MTL</span></code> in C++. Conversion between the types is usually straightforward:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">DM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

<span class="n">C_dense</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">full</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<span class="n">C_dense</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="c1"># equivalent</span>

<span class="n">C_sparse</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">sparse</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csc_matrix</span>
<span class="n">C_sparse</span> <span class="o">=</span> <span class="n">csc_matrix</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="c1"># equivalent</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="p">=</span> <span class="n">DM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">C_dense</span> <span class="p">=</span> <span class="nb">full</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
<span class="n">C_sparse</span> <span class="p">=</span> <span class="nb">sparse</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>More usage examples for <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> can be found in the example pack at <a class="reference external" href="http://install.casadi.org/">http://install.casadi.org/</a>. For documentation of particular functions of this class (and others), find the “C++ API” on <a class="reference external" href="http://docs.casadi.org/">http://docs.casadi.org/</a> and search for information about <code class="docutils literal notranslate"><span class="pre">casadi::Matrix</span></code>.</p>
</div>
<div class="section" id="the-mx-symbolics">
<h3>3.3. The <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> symbolics<a class="headerlink" href="#the-mx-symbolics" title="Permalink to this headline">¶</a></h3>
<p>Let us perform a simple operation using the <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> above:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>@1=3,
[[((@1*x_0)+y), ((@1*x_2)+y)],
 [((@1*x_1)+y), ((@1*x_3)+y)]]
(2, 2)
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span>
<span class="n">f</span> <span class="p">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>@1=3,
[[((@1*x_0)+y), ((@1*x_2)+y)],
 [((@1*x_1)+y), ((@1*x_3)+y)]]
   2   2
</pre></div>
</div>
</div>
</div>
<p>As you can see, the output of this operation is a 2-by-2 matrix. Note how the multiplication and the addition were performed element-wise and new expressions (of type <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code>) were created for each entry of the result matrix.</p>
<p>We shall now introduce a second, more general <em>matrix expression</em> type <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code>. The <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> type allows, like <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code>, to build up expressions consisting of a sequence of elementary operations. But unlike <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code>, these elementary operations are not restricted to be scalar unary or binary operations (<span class="math notranslate nohighlight">\(\mathbb{R} \rightarrow \mathbb{R}\)</span> or <span class="math notranslate nohighlight">\(\mathbb{R} \times \mathbb{R} \rightarrow \mathbb{R}\)</span>). Instead, the elementary operations that are used to form <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> expressions are allowed to be general <em>multiple sparse-matrix valued</em> input, <em>multiple sparse-matrix valued</em> output functions: <span class="math notranslate nohighlight">\(\mathbb{R}^{n_1 \times m_1} \times \ldots \times \mathbb{R}^{n_N \times m_N} \rightarrow \mathbb{R}^{p_1 \times q_1} \times \ldots \times \mathbb{R}^{p_M \times q_M}\)</span>.</p>
<p>The syntax of <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> mirrors that of <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code>:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>((3*x)+y)
(2, 2)
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span>
<span class="n">f</span> <span class="p">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>((3*x)+y)
   2   2
</pre></div>
</div>
</div>
</div>
<p>Note how the result consists of only two operations (one multiplication and one addition) using <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> symbolics, whereas the <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> equivalent has eight (two for each element of the resulting matrix). As a consequence, <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> can be more economical when working with operations that are naturally vector or matrix valued with many elements. As we shall see in <a class="reference internal" href="index.html#sec-function"><span class="std std-numref">Chapter 4</span></a>, it is also much more general since we allow calls to arbitrary functions that cannot be expanded in terms of elementary operations.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> supports getting and setting elements, using the same syntax as <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code>, but the way it is implemented is very different. Test, for example, to print the element in the upper-left corner of a 2-by-2 symbolic variable:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>x[0]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =

x[0]

</pre></div>
</div>
</div>
</div>
<p>The output should be understood as an expression that is equal to the first (i.e. index 0 in C++) structurally non-zero element of <code class="docutils literal notranslate"><span class="pre">x</span></code>, unlike <code class="docutils literal notranslate"><span class="pre">x_0</span></code> in the <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> case above, which is the name of a symbolic primitive in the first (index 0) location of the matrix.</p>
<p>Similar results can be expected when trying to set elements:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">MX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>A: (project((zeros(2x2,1nz)[0] = x[0]))[1] = (x[0]+x[1]))
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">A</span> <span class="p">=</span> <span class="n">MX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">display</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>A =

(project((zeros(2x2,1nz)[0] = x[0]))[1] = (x[0]+x[1]))

</pre></div>
</div>
</div>
</div>
<p>The interpretation of the (admittedly cryptic) output is that starting with an all zero sparse matrix, an element is assigned to <code class="docutils literal notranslate"><span class="pre">x_0</span></code>. It is then projected to a matrix of different sparsity and an another element is assigned to <code class="docutils literal notranslate"><span class="pre">x_0+x_1</span></code>.</p>
<p>Element access and assignment, of the type you have just seen, are examples of operations that can be used to construct expressions. Other examples of operations are matrix multiplications, transposes, concatenations, resizings, reshapings and function calls.</p>
</div>
<div class="section" id="mixing-sx-and-mx">
<h3>3.4. Mixing <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code><a class="headerlink" href="#mixing-sx-and-mx" title="Permalink to this headline">¶</a></h3>
<p>You can <em>not</em> multiply an <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> object with an <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> object, or perform any other operation to mix the two in the same expression graph. You can, however, in an <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> graph include calls to a <code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code> defined by <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> expressions. This will be demonstrated in <a class="reference internal" href="index.html#sec-function"><span class="std std-numref">Chapter 4</span></a>. Mixing <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> is often a good idea since functions defined by <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> expressions have a much lower overhead per operation making it much faster for operations that are naturally written as a sequence of scalar operations. The <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> expressions are thus intended to be used for low level operations (for example the DAE right hand side in <a class="reference internal" href="index.html#sec-integrator"><span class="std std-numref">Section 4.4</span></a>), whereas the <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> expressions act as a glue and enables the formulation of e.g. the constraint function of an NLP (which might contain calls to ODE/DAE integrators, or might simply be too large to expand as one big expression).</p>
</div>
<div class="section" id="the-sparsity-class">
<span id="sec-sparsity-class"></span><h3>3.5. The <code class="xref py py-class docutils literal notranslate"><span class="pre">Sparsity</span></code> class<a class="headerlink" href="#the-sparsity-class" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, matrices in CasADi are stored using the <em>compressed column storage</em> (CCS) format. This is a standard format for sparse matrices that allows linear algebra operations such as element-wise operations, matrix multiplication and transposes to be performed efficiently. In the CCS format, the sparsity pattern is decoded using the dimensions – the number of rows and number of columns – and two vectors. The first vector contains the index of the first structurally nonzero element of each column and the second vector contains the row index for every nonzero element. For more details on the CCS format, see e.g.  <a class="reference external" href="http://netlib.org/linalg/html_templates/node92.html">Templates for the Solution of Linear Systems</a> on Netlib. Note that CasADi uses the CCS format for sparse as well as dense matrices.</p>
<p>Sparsity patterns in CasADi are stored as instances of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Sparsity</span></code> class, which is <em>reference-counted</em>, meaning that multiple matrices can share the same sparsity pattern, including <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> expression graphs and instances of <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">DM</span></code>. The <code class="xref py py-class docutils literal notranslate"><span class="pre">Sparsity</span></code> class is also <em>cached</em>, meaning that the creation of multiple instances of the same sparsity patterns is always avoided.</p>
<p>The following list summarizes the most commonly used ways of constructing new sparsity patterns:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Sparsity.dense(n,m)</span></code>: Create a dense <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(m\)</span> sparsity pattern</li>
<li><code class="docutils literal notranslate"><span class="pre">Sparsity(n,m)</span></code>: Create a sparse <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(m\)</span> sparsity pattern</li>
<li><code class="docutils literal notranslate"><span class="pre">Sparsity.diag(n)</span></code>: Create a diagonal <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(n\)</span> sparsity pattern</li>
<li><code class="docutils literal notranslate"><span class="pre">Sparsity.upper(n)</span></code>: Create an upper triangular <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(n\)</span> sparsity pattern</li>
<li><code class="docutils literal notranslate"><span class="pre">Sparsity.lower(n)</span></code>: Create a lower triangular <span class="math notranslate nohighlight">\(n\)</span>-by-<span class="math notranslate nohighlight">\(n\)</span> sparsity pattern</li>
</ul>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Sparsity</span></code> class can be used to create non-standard matrices, e.g.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">Sparsity</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, 00, 00],
 [x_1, x_3, 00],
 [x_2, x_4, x_5]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">Sparsity</span><span class="p">.</span><span class="nb">lower</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, 00, 00],
 [x_1, x_3, 00],
 [x_2, x_4, x_5]]
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-and-setting-elements-in-matrices">
<h4>3.5.1. Getting and setting elements in matrices<a class="headerlink" href="#getting-and-setting-elements-in-matrices" title="Permalink to this headline">¶</a></h4>
<p>To get or set an element or a set of elements in CasADi’s matrix types (<code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">DM</span></code>), we use square brackets in Python and round brackets in C++ and MATLAB. As is conventional in these languages, indexing starts from zero in C++ and Python but from one in MATLAB. In Python and C++, we allow negative indices to specify an index counted from the end. In MATLAB, use the <code class="docutils literal notranslate"><span class="pre">end</span></code> keyword for indexing from the end.</p>
<p>Indexing can be done with one index or two indices. With two indices, you reference a particular row (or set or rows) and a particular column (or set of columns). With one index, you reference an element (or set of elements) starting from the upper left corner and column-wise to the lower right corner. All elements are counted regardless of whether they are structurally zero or not.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="n">SX</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[[3, 7]]
@1=1,
[[@1, @1],
 [4, 5]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="p">=</span> <span class="n">SX</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">;</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="mi">1</span><span class="p">,:))</span>
<span class="n">M</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[[3, 7]]
@1=1,
[[@1, @1],
 [4, 5]]
</pre></div>
</div>
</div>
</div>
<p>Unlike Python’s NumPy, CasADi slices are not views into the data of the left hand side; rather, a slice access copies the data. As a result, the matrix <span class="math notranslate nohighlight">\(m\)</span> is not changed at all in the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="n">SX</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]])</span>
<span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,:][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[3, 7],
 [4, 5]]
</pre></div>
</div>
<p>The getting and setting matrix elements is elaborated in the following. The discussion applies to all of CasADi’s matrix types.</p>
<p><strong>Single element access</strong> is getting or setting by providing a row-column pair or its flattened index (column-wise starting in the upper left corner of the matrix):</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="n">diag</span><span class="p">(</span><span class="n">SX</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[3, 00, 00, 00],
 [00, 4, 00, 00],
 [00, 00, 5, 00],
 [00, 00, 00, 6]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="p">=</span> <span class="nb">diag</span><span class="p">(</span><span class="n">SX</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]));</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[3, 00, 00, 00],
 [00, 4, 00, 00],
 [00, 00, 5, 00],
 [00, 00, 00, 6]]
</pre></div>
</div>
</div>
</div>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>3
00
6
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="k">end</span><span class="p">,</span><span class="k">end</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>3
00
6
</pre></div>
</div>
</div>
</div>
<p><strong>Slice access</strong> means setting multiple elements at once. This is significantly more efficient than setting the elements one at a time. You get or set a slice by providing a (<em>start</em> , <em>stop</em> , <em>step</em>) triple. In Python and MATLAB, CasADi uses standard syntax:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[00, 4, 00, 00]

[[4, 00],
 [00, 00],
 [00, 6]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">(:,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[00, 4, 00, 00]

[[4, 00],
 [00, 00],
 [00, 6]]
</pre></div>
</div>
</div>
</div>
<p>In C++, CasADi’s <code class="xref py py-class docutils literal notranslate"><span class="pre">Slice</span></code> helper class can be used. For the example above, this means <code class="docutils literal notranslate"><span class="pre">M(Slice(),1)</span></code> and <code class="docutils literal notranslate"><span class="pre">M(Slice(1,-1),Slice(1,4,2))</span></code>, respectively.</p>
<p><strong>List access</strong> is similar to (but potentially less efficient than) slice access:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="n">SX</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="n">M</span><span class="p">[[</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">]])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[3, 7, 8, 9],
 [4, 5, 6, 1]]
[[3, 9]] [6, 7]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="p">=</span> <span class="n">SX</span><span class="p">([</span><span class="mi">3</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span><span class="p">;</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">1</span><span class="p">]);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]))</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">M</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="nb">numel</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[3, 7, 8, 9],
 [4, 5, 6, 1]]
[[3, 9]]
[[6, 7]]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="arithmetic-operations">
<h3>3.6. Arithmetic operations<a class="headerlink" href="#arithmetic-operations" title="Permalink to this headline">¶</a></h3>
<p>CasADi supports most standard arithmetic operations such as addition, multiplications, powers, trigonometric functions etc:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[(sin(y_0)-x), (sin(y_2)-x)],
 [(sin(y_1)-x), (sin(y_3)-x)]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="nb">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[(sin(y_0)-x), (sin(y_2)-x)],
 [(sin(y_1)-x), (sin(y_3)-x)]]
</pre></div>
</div>
</div>
</div>
<p>In C++ and Python (but not in MATLAB), the standard multiplication operation (using <code class="docutils literal notranslate"><span class="pre">*</span></code>) is reserved for element-wise multiplication (in MATLAB <code class="docutils literal notranslate"><span class="pre">.*</span></code>). For <strong>matrix multiplication</strong>, use <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&#64;</span> <span class="pre">B</span></code> or (<code class="docutils literal notranslate"><span class="pre">mtimes(A,B)</span></code> in Python 3.4+):</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="nd">@y</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[sq(y_0), sq(y_2)],
 [sq(y_1), sq(y_3)]]
[[(sq(y_0)+(y_2*y_1)), ((y_0*y_2)+(y_2*y_3))],
 [((y_1*y_0)+(y_3*y_1)), ((y_1*y_2)+sq(y_3))]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="n">y</span><span class="o">.*</span><span class="n">y</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[sq(y_0), sq(y_2)],
 [sq(y_1), sq(y_3)]]

[[(sq(y_0)+(y_2*y_1)), ((y_0*y_2)+(y_2*y_3))],
 [((y_1*y_0)+(y_3*y_1)), ((y_1*y_2)+sq(y_3))]]
</pre></div>
</div>
</div>
</div>
<p>As is customary in MATLAB, multiplication using <code class="docutils literal notranslate"><span class="pre">*</span></code> and <code class="docutils literal notranslate"><span class="pre">.*</span></code> are equivalent when either of the arguments is a scalar.</p>
<p><strong>Transposes</strong> are formed using the syntax <code class="docutils literal notranslate"><span class="pre">A.T</span></code> in Python, <code class="docutils literal notranslate"><span class="pre">A.T()</span></code> in C++ and with
<code class="docutils literal notranslate"><span class="pre">A</span></code> or <code class="docutils literal notranslate"><span class="pre">A.'</span></code> in MATLAB:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[y_0, y_2],
 [y_1, y_3]]

[[y_0, y_1],
 [y_2, y_3]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">y</span><span class="o">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[y_0, y_2],
 [y_1, y_3]]

[[y_0, y_1],
 [y_2, y_3]]
</pre></div>
</div>
</div>
</div>
<p><strong>Reshaping</strong> means changing the number of rows and columns but retaining the number of elements and the relative location of the nonzeros. This is a computationally very cheap operation which is performed using the syntax:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>@1=1,
[[@1, 00, 00, 00, 00, @1, 00, 00],
 [00, 00, @1, 00, 00, 00, 00, @1]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="nb">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="nb">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =

@1=1,
[[@1, 00, 00, 00, 00, @1, 00, 00],
 [00, 00, @1, 00, 00, 00, 00, @1]]

</pre></div>
</div>
</div>
</div>
<p><strong>Concatenation</strong> means stacking matrices horizontally or vertically. Due to the column-major way of storing elements in CasADi, it is most efficient to stack matrices horizontally. Matrices that are in fact column vectors (i.e. consisting of a single column), can also be stacked efficiently vertically. Vertical and horizontal concatenation is performed using the functions <code class="docutils literal notranslate"><span class="pre">vertcat</span></code> and <code class="docutils literal notranslate"><span class="pre">horzcat</span></code> (that take a variable amount of input arguments) in Python and C++ and with square brackets in MATLAB:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vertcat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[x_0, x_1, x_2, x_3, x_4, y_0, y_1, y_2, y_3, y_4]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">([</span><span class="n">x</span><span class="p">;</span><span class="n">y</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[x_0, x_1, x_2, x_3, x_4, y_0, y_1, y_2, y_3, y_4]
</pre></div>
</div>
</div>
</div>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">horzcat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, y_0],
 [x_1, y_1],
 [x_2, y_2],
 [x_3, y_3],
 [x_4, y_4]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, y_0],
 [x_1, y_1],
 [x_2, y_2],
 [x_3, y_3],
 [x_4, y_4]]
</pre></div>
</div>
</div>
</div>
<p>There are also variants of these functions that take a list (in Python) or a cell array (in Matlab) as inputs:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">hcat</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, y_0],
 [x_1, y_1],
 [x_2, y_2],
 [x_3, y_3],
 [x_4, y_4]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="p">=</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">};</span>
<span class="nb">disp</span><span class="p">([</span><span class="n">L</span><span class="p">{:}])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, y_0],
 [x_1, y_1],
 [x_2, y_2],
 [x_3, y_3],
 [x_4, y_4]]
</pre></div>
</div>
</div>
</div>
<p><strong>Horizontal and vertical split</strong> are the inverse operations of the above introduced horizontal and vertical concatenation. To split up an expression horizontally into <span class="math notranslate nohighlight">\(n\)</span> smaller expressions, you need to provide, in addition to the expression being split, a vector <em>offset</em> of length <span class="math notranslate nohighlight">\(n+1\)</span>. The first element of the <em>offset</em> vector must be 0 and the last element must be the number of columns. Remaining elements must follow in a non-decreasing order. The output <span class="math notranslate nohighlight">\(i\)</span> of the split operation then contains the columns <span class="math notranslate nohighlight">\(c\)</span> with <span class="math notranslate nohighlight">\(\textit{offset}[i] \le c &lt; \textit{offset}[i+1]\)</span>. The following demonstrates the syntax:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">horzsplit</span><span class="p">(</span><span class="n">x</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[x_0, x_1, x_2, x_3, x_4] [x_5, x_6, x_7, x_8, x_9]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">w</span> <span class="p">=</span> <span class="n">horzsplit</span><span class="p">(</span><span class="n">x</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">w</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">disp</span><span class="p">(</span><span class="n">w</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
{
  [1,1] =

  [x_0, x_1, x_2, x_3, x_4]

}

{
  [1,1] =

  [x_5, x_6, x_7, x_8, x_9]

}
</pre></div>
</div>
</div>
</div>
<p>The vertsplit operation works analogously, but with the <em>offset</em> vector referring to rows:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="n">vertsplit</span><span class="p">(</span><span class="n">x</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, x_5],
 [x_1, x_6],
 [x_2, x_7]]
[[x_3, x_8],
 [x_4, x_9]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="p">=</span> <span class="n">vertsplit</span><span class="p">(</span><span class="n">x</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">w</span><span class="p">{</span><span class="mi">1</span><span class="p">}),</span> <span class="nb">disp</span><span class="p">(</span><span class="n">w</span><span class="p">{</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, x_5],
 [x_1, x_6],
 [x_2, x_7]]

[[x_3, x_8],
 [x_4, x_9]]
</pre></div>
</div>
</div>
</div>
<p>Note that it is always possible to use slice element access instead of horizontal and vertical split, for the above vertical split:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,:],</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">,:]]</span>
<span class="k">print</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, x_5],
 [x_1, x_6],
 [x_2, x_7]]
[[x_3, x_8],
 [x_4, x_9]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="p">=</span> <span class="p">{</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,:),</span> <span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">,:)};</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">w</span><span class="p">{</span><span class="mi">1</span><span class="p">}),</span> <span class="nb">disp</span><span class="p">(</span><span class="n">w</span><span class="p">{</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[x_0, x_5],
 [x_1, x_6],
 [x_2, x_7]]

[[x_3, x_8],
 [x_4, x_9]]
</pre></div>
</div>
</div>
</div>
<p>For <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> graphs, this alternative way is completely equivalent, but for <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> graphs using <code class="docutils literal notranslate"><span class="pre">horzsplit</span></code>/<code class="docutils literal notranslate"><span class="pre">vertsplit</span></code> is <em>significantly more efficient when all the split expressions are needed</em>.</p>
<p><strong>Inner product</strong>, defined as <span class="math notranslate nohighlight">\(&lt;A,B&gt; := \text{tr}(A \, B) = \sum_{i,j} \, A_{i,j} \, B_{i,j}\)</span> are created as follows:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>(((sq(x_0)+sq(x_1))+sq(x_2))+sq(x_3))
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="nb">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>(((sq(x_0)+sq(x_1))+sq(x_2))+sq(x_3))
</pre></div>
</div>
</div>
</div>
<p>Many of the above operations are also defined for the <code class="xref py py-class docutils literal notranslate"><span class="pre">Sparsity</span></code> class (<a class="reference internal" href="#sec-sparsity-class"><span class="std std-numref">Section 3.5</span></a>), e.g. <code class="docutils literal notranslate"><span class="pre">vertcat</span></code>, <code class="docutils literal notranslate"><span class="pre">horzsplit</span></code>, transposing, addition (which returns the <em>union</em> of two sparsity patterns) and multiplication (which returns the <em>intersection</em> of two sparsity patterns).</p>
</div>
<div class="section" id="querying-properties">
<h3>3.7. Querying properties<a class="headerlink" href="#querying-properties" title="Permalink to this headline">¶</a></h3>
<p>You can check if a matrix or sparsity pattern has a certain property by calling an appropriate member function. e.g.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>(10, 1)
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =

   10    1

</pre></div>
</div>
</div>
</div>
<p>Note that in MATLAB, <code class="docutils literal notranslate"><span class="pre">obj.myfcn(arg)</span></code> and <code class="docutils literal notranslate"><span class="pre">myfcn(obj,</span> <span class="pre">arg)</span></code> are both valid ways of calling a member function <code class="docutils literal notranslate"><span class="pre">myfcn</span></code>. The latter variant is probably preferable from a style viewpoint.</p>
<p>Some commonly used properties for a matrix <code class="docutils literal notranslate"><span class="pre">A</span></code> are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">A.size1()</span></code> The number of rows</li>
<li><code class="docutils literal notranslate"><span class="pre">A.size2()</span></code> The number of columns</li>
<li><code class="docutils literal notranslate"><span class="pre">A.shape</span></code> (in MATLAB “size”) The shape, i.e. the pair (<em>nrow</em>,*ncol*)</li>
<li><code class="docutils literal notranslate"><span class="pre">A.numel()</span></code> The number of elements, i.e <span class="math notranslate nohighlight">\(\textit{nrow} * \textit{ncol}\)</span></li>
<li><code class="docutils literal notranslate"><span class="pre">A.nnz()</span></code> The number of structurally nonzero elements, equal to <code class="docutils literal notranslate"><span class="pre">A.numel()</span></code> if <em>dense</em>.</li>
<li><code class="docutils literal notranslate"><span class="pre">A.sparsity()</span></code> Retrieve a reference to the sparsity pattern</li>
<li><code class="docutils literal notranslate"><span class="pre">A.is_dense()</span></code> Is a matrix dense, i.e. having no structural zeros</li>
<li><code class="docutils literal notranslate"><span class="pre">A.is_scalar()</span></code> Is the matrix a scalar, i.e. having dimensions 1-by-1?</li>
<li><code class="docutils literal notranslate"><span class="pre">A.is_column()</span></code> Is the matrix a vector, i.e. having dimensions <span class="math notranslate nohighlight">\(n\)</span>-by-1?</li>
<li><code class="docutils literal notranslate"><span class="pre">A.is_square()</span></code> Is the matrix square?</li>
<li><code class="docutils literal notranslate"><span class="pre">A.is_triu()</span></code> Is the matrix upper triangular?</li>
<li><code class="docutils literal notranslate"><span class="pre">A.is_constant()</span></code> Are the matrix entries all constant?</li>
<li><code class="docutils literal notranslate"><span class="pre">A.is_integer()</span></code> Are the matrix entries all integer-valued?</li>
</ul>
</div></blockquote>
<p>The last queries are examples of queries for which <em>false negative</em> returns are allowed. A matrix for which <code class="docutils literal notranslate"><span class="pre">A.is_constant()</span></code> is <em>true</em> is guaranteed to be constant, but is <em>not</em> guaranteed to be non-constant if <code class="docutils literal notranslate"><span class="pre">A.is_constant()</span></code> is <em>false</em>. We recommend you to check the API documentation for a particular function before using it for the first time.</p>
</div>
<div class="section" id="linear-algebra">
<h3>3.8. Linear algebra<a class="headerlink" href="#linear-algebra" title="Permalink to this headline">¶</a></h3>
<p>CasADi supports a limited number of linear algebra operations, e.g. for solution of linear systems of equations:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>(A\b)
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">b</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">A</span><span class="o">\</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>(A\b)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculus-algorithmic-differentiation">
<h3>3.9. Calculus – algorithmic differentiation<a class="headerlink" href="#calculus-algorithmic-differentiation" title="Permalink to this headline">¶</a></h3>
<p>The single most central functionality of CasADi is <em>algorithmic (or automatic) differentiation</em> (AD).
For a function <span class="math notranslate nohighlight">\(f: \mathbb{R}^N \rightarrow \mathbb{R}^M\)</span>:</p>
<div class="math notranslate nohighlight">
\[y = f(x),\]</div>
<p><em>forward mode</em> directional derivatives can be used to calculate Jacobian-times-vector products:</p>
<div class="math notranslate nohighlight">
\[\hat{y} = \frac{\partial f}{\partial x} \, \hat{x}.\]</div>
<p>Similarly, <em>reverse mode</em> directional derivatives can be used to calculate Jacobian-transposed-times-vector products:</p>
<div class="math notranslate nohighlight">
\[\bar{x} = \left(\frac{\partial f}{\partial x}\right)^{\text{T}} \, \bar{y}.\]</div>
<p>Both forward and reverse mode directional derivatives are calculated at a cost proportional to evaluating <span class="math notranslate nohighlight">\(f(x)\)</span>, <em>regardless of the dimension</em> of <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>CasADi is also able to generate complete, <em>sparse</em> Jacobians efficiently. The algorithm for this is very complex, but essentially consists of the following steps:</p>
<ul class="simple">
<li>Automatically detect the sparsity pattern of the Jacobian</li>
<li>Use graph coloring techniques to find a few forward and/or directional derivatives needed to construct the complete Jacobian</li>
<li>Calculate the directional derivatives numerically or symbolically</li>
<li>Assemble the complete Jacobian</li>
</ul>
<p>Hessians are calculated by first calculating the gradient and then performing the same steps as above to calculate the Jacobian of the gradient in the same way as above, while exploiting symmetry.</p>
<div class="section" id="syntax">
<h4>3.9.1. Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h4>
<p>An expression for a Jacobian is obtained using the syntax:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">jacobian</span><span class="p">(</span><span class="n">A</span><span class="nd">@x</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[A_0, A_3],
 [A_1, A_4],
 [A_2, A_5]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">jacobian</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =


[[A_0, A_3],
 [A_1, A_4],
 [A_2, A_5]]

</pre></div>
</div>
</div>
</div>
<p>When the differentiated expression is a scalar, you can also calculate the gradient in the matrix sense:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">gradient</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p">),</span><span class="n">A</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
[[(A_0+A_0), (A_3+A_3)],
 [(A_1+A_1), (A_4+A_4)],
 [(A_2+A_2), (A_5+A_5)]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">gradient</span><span class="p">(</span><span class="nb">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p">),</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =


[[(A_0+A_0), (A_3+A_3)],
 [(A_1+A_1), (A_4+A_4)],
 [(A_2+A_2), (A_5+A_5)]]

</pre></div>
</div>
</div>
</div>
<p>Note that, unlike <code class="docutils literal notranslate"><span class="pre">jacobian</span></code>, <code class="docutils literal notranslate"><span class="pre">gradient</span></code> always returns a dense vector.</p>
<p>Hessians, and as a by-product gradients, are obtained as follows:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">H</span><span class="p">,</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">hessian</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;H:&#39;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>H: @1=2,
[[@1, 00],
 [00, @1]]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">H</span><span class="p">,</span><span class="n">g</span><span class="p">]</span> <span class="p">=</span> <span class="n">hessian</span><span class="p">(</span><span class="nb">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">);</span>
<span class="nb">display</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>H =

@1=2,
[[@1, 00],
 [00, @1]]

</pre></div>
</div>
</div>
</div>
<p>For calculating a Jacobian-times-vector product, the <code class="docutils literal notranslate"><span class="pre">jtimes</span></code> function – performing forward mode AD – is often more efficient than creating the full Jacobian and performing a matrix-vector multiplication:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">DM</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">]])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">mtimes</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">jtimes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[(v_0+(3*v_1)), ((4*v_0)+(7*v_1)), ((2*v_0)+(8*v_1))]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">3</span><span class="p">;</span><span class="mi">4</span> <span class="mi">7</span><span class="p">;</span><span class="mi">2</span> <span class="mi">8</span><span class="p">];</span>
<span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">v</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">f</span> <span class="p">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
<span class="n">jtimes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =

[(v_0+(3*v_1)), ((4*v_0)+(7*v_1)), ((2*v_0)+(8*v_1))]

</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">jtimes</span></code> function optionally calculates the transposed-Jacobian-times-vector product, i.e. reverse mode AD:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">mtimes</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">jtimes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[(((2*w_2)+(4*w_1))+w_0), (((8*w_2)+(7*w_1))+(3*w_0))]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">f</span> <span class="p">=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
<span class="n">jtimes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="nb">true</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =

[(((2*w_2)+(4*w_1))+w_0), (((8*w_2)+(7*w_1))+(3*w_0))]

</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-function"></span><div class="section" id="function-objects">
<span id="sec-function"></span><h2>4. Function objects<a class="headerlink" href="#function-objects" title="Permalink to this headline">¶</a></h2>
<p>CasADi allows the user to create function objects, in C++ terminology often referred to as <em>functors</em>. This includes functions that are defined by a symbolic expression, ODE/DAE integrators, QP solvers, NLP solvers etc.</p>
<p>Function objects are typically created with the syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>f = functionname(name, arguments, ..., [options])
</pre></div>
</div>
<p>The name is mainly a display name that will show up in e.g. error messages or as comments in generated C code. This is followed by a set of arguments, which is class dependent. Finally, the user can pass an options structure for customizing the behavior of the class. The options structure is a dictionary type in Python, a struct in MATLAB or CasADi’s <code class="docutils literal notranslate"><span class="pre">Dict</span></code> type in C++.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Function</span></code> can be constructed by passing a list of input expressions and a list of output expressions:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">],</span>\
           <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(i0[2],i1)-&gt;(o0[2],o1[2]) SXFunction
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span>
<span class="n">f</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">},...</span>
           <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="nb">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">});</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(i0[2],i1)-&gt;(o0[2],o1[2]) SXFunction
</pre></div>
</div>
</div>
</div>
<p>which defines a function
<span class="math notranslate nohighlight">\(f : \mathbb{R}^{2} \times \mathbb{R} \rightarrow \mathbb{R}^{2} \times \mathbb{R}^{2}, \quad (x,y) \mapsto (x,\sin(y) x)\)</span>.
Note that all function objects in CasADi, including the above, are multiple matrix-valued input, multiple, matrix-valued output.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> expression graphs work the same way:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">],</span>\
           <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(i0[2],i1)-&gt;(o0[2],o1[2]) MXFunction
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span>
<span class="n">f</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">},...</span>
           <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="nb">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">});</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(i0[2],i1)-&gt;(o0[2],o1[2]) MXFunction
</pre></div>
</div>
</div>
</div>
<p>When creating a <code class="docutils literal notranslate"><span class="pre">Function</span></code> from expressions like that, it is always advisory to <em>name</em> the inputs and outputs as follows:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">],</span>\
      <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">],</span>\
      <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">],[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(x[2],y)-&gt;(r[2],q[2]) MXFunction
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">},...</span>
      <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="nb">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">},...</span>
      <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">},{</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;q&#39;</span><span class="p">});</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(x[2],y)-&gt;(r[2],q[2]) MXFunction
</pre></div>
</div>
</div>
</div>
<p>Naming inputs and outputs is preferred for a number of reasons:</p>
<ul class="simple">
<li>No need to remember the number or order of arguments</li>
<li>Inputs or outputs that are absent can be left unset</li>
<li>More readable and less error prone syntax. E.g. <code class="docutils literal notranslate"><span class="pre">f.jacobian('x','q')</span></code> instead of <code class="docutils literal notranslate"><span class="pre">f.jacobian(0,1)</span></code>.</li>
</ul>
<p>For <code class="docutils literal notranslate"><span class="pre">Function</span></code> instances – to be encountered later – that are <em>not</em> created directly from expressions,
the inputs and outputs are named automatically.</p>
<div class="section" id="calling-function-objects">
<h3>4.1. Calling function objects<a class="headerlink" href="#calling-function-objects" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> expressions may contain calls to <code class="docutils literal notranslate"><span class="pre">Function</span></code>-derived functions. Calling a function object is both done for the numerical evaluation and, by passing symbolic arguments, for embedding a <em>call</em> to the function object into an expression graph (cf. also <a class="reference internal" href="#sec-integrator"><span class="std std-numref">Section 4.4</span></a>).</p>
<p>To call a function object, you either pass the argument in the correct order:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r0</span><span class="p">,</span> <span class="n">q0</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">3.3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;r0:&#39;</span><span class="p">,</span><span class="n">r0</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;q0:&#39;</span><span class="p">,</span><span class="n">q0</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>r0: [1.1, 1.1]
q0: [-0.17352, -0.17352]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="n">q0</span><span class="p">]</span> <span class="p">=</span> <span class="n">f</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">3.3</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">r0</span><span class="p">)</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">q0</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>[1.1, 1.1]
[-0.17352, -0.17352]
</pre></div>
</div>
</div>
</div>
<p>or the arguments and their names as follows, which will result in a dictionary (<code class="docutils literal notranslate"><span class="pre">dict</span></code> in Python, <code class="docutils literal notranslate"><span class="pre">struct</span></code> in MATLAB and <code class="docutils literal notranslate"><span class="pre">std::map&lt;std::string,</span> <span class="pre">MatrixType&gt;</span></code> in C++):</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">3.3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;res:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>res: {&#39;q&#39;: DM([-0.17352, -0.17352]), &#39;r&#39;: DM([1.1, 1.1])}
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="p">=</span> <span class="n">f</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="mf">3.3</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
  scalar structure containing the fields:

    q =

    [-0.17352, -0.17352]

    r =

    [1.1, 1.1]

</pre></div>
</div>
</div>
</div>
<p>When calling a function object, the dimensions (but not necessarily the sparsity patterns) of the evaluation arguments have to match those of the function inputs, with two exceptions:</p>
<ul class="simple">
<li>A row vector can be passed instead of a column vector and vice versa.</li>
<li>A scalar argument can always be passed, regardless of the input dimension. This has the meaning of setting all elements of the input matrix to that value.</li>
</ul>
<p>When the number of inputs to a function object is large or changing, an alternative syntax to the above is to use the <em>call</em> function which takes a Python list / MATLAB cell array or, alternatively, a Python dict / MATLAB struct. The return value will have the same type:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">3.3</span><span class="p">]</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;res:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
<span class="n">arg</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="mf">1.1</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="mf">3.3</span><span class="p">}</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;res:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>res: [DM([1.1, 1.1]), DM([-0.17352, -0.17352])]
res: {&#39;q&#39;: DM([-0.17352, -0.17352]), &#39;r&#39;: DM([1.1, 1.1])}
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">arg</span> <span class="p">=</span> <span class="p">{</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">3.3</span><span class="p">};</span>
<span class="n">res</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="nb">arg</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="nb">arg</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="mf">3.3</span><span class="p">);</span>
<span class="n">res</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="nb">arg</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
{
  [1,1] =

  [1.1, 1.1]

  [1,2] =

  [-0.17352, -0.17352]

}

  scalar structure containing the fields:

    q =

    [-0.17352, -0.17352]

    r =

    [1.1, 1.1]

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="converting-mx-to-sx">
<h3>4.2. Converting <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> to <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code><a class="headerlink" href="#converting-mx-to-sx" title="Permalink to this headline">¶</a></h3>
<p>A function object defined by an <code class="xref py py-class docutils literal notranslate"><span class="pre">MX</span></code> graph that only contains built-in operations (e.g. element-wise operations such as addition, square root, matrix multiplications and calls to <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> functions, can be converted into a function defined purely by an <code class="xref py py-class docutils literal notranslate"><span class="pre">SX</span></code> graph using the syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sx_function</span> <span class="o">=</span> <span class="n">mx_function</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>
</pre></div>
</div>
<p>This might speed up the calculations significantly, but might also cause extra memory overhead.</p>
</div>
<div class="section" id="nonlinear-root-finding-problems">
<span id="sec-rootfinder"></span><h3>4.3. Nonlinear root-finding problems<a class="headerlink" href="#nonlinear-root-finding-problems" title="Permalink to this headline">¶</a></h3>
<p>Consider the following system of equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
&amp;g_0(z, x_1, x_2, \ldots, x_n) &amp;&amp;= 0 \\
&amp;g_1(z, x_1, x_2, \ldots, x_n) &amp;&amp;= y_1 \\
&amp;g_2(z, x_1, x_2, \ldots, x_n) &amp;&amp;= y_2 \\
&amp;\qquad \vdots \qquad &amp;&amp;\qquad \\
&amp;g_m(z, x_1, x_2, \ldots, x_n) &amp;&amp;= y_m,
\end{aligned}\end{split}\]</div>
<p>where the first equation uniquely defines <span class="math notranslate nohighlight">\(z\)</span> as a function of <span class="math notranslate nohighlight">\(x_1\)</span>, ldots, <span class="math notranslate nohighlight">\(x_n\)</span> by the <em>implicit function theorem</em>
and the remaining equations define the auxiliary outputs <span class="math notranslate nohighlight">\(y_1\)</span>, ldots, <span class="math notranslate nohighlight">\(y_m\)</span>.</p>
<p>Given a function <span class="math notranslate nohighlight">\(g\)</span> for evaluating <span class="math notranslate nohighlight">\(g_0\)</span>, ldots, <span class="math notranslate nohighlight">\(g_m\)</span>, we can use CasADi to automatically formulate a function
<span class="math notranslate nohighlight">\(G: \{z_{\text{guess}}, x_1, x_2, \ldots, x_n\} \rightarrow \{z, y_1, y_2, \ldots, y_m\}\)</span>.
This function includes a guess for <span class="math notranslate nohighlight">\(z\)</span> to handle the case when the solution is non-unique.
The syntax for this, assuming <span class="math notranslate nohighlight">\(n=m=1\)</span> for simplicity, is:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">nz</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>
<span class="n">g0</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">z</span><span class="p">)</span>
<span class="n">g1</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">z</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,[</span><span class="n">z</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="n">g0</span><span class="p">,</span><span class="n">g1</span><span class="p">])</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">rootfinder</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>G:(i0,i1)-&gt;(o0,o1) Newton
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">nz</span><span class="p">);</span>
<span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">nx</span><span class="p">);</span>
<span class="n">g0</span> <span class="p">=</span> <span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">z</span><span class="p">);</span>
<span class="n">g1</span> <span class="p">=</span> <span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">z</span><span class="p">);</span>
<span class="n">g</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,{</span><span class="n">z</span><span class="p">,</span><span class="n">x</span><span class="p">},{</span><span class="n">g0</span><span class="p">,</span><span class="n">g1</span><span class="p">});</span>
<span class="n">G</span> <span class="p">=</span> <span class="n">rootfinder</span><span class="p">(</span><span class="s">&#39;G&#39;</span><span class="p">,</span><span class="s">&#39;newton&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>G:(i0,i1)-&gt;(o0,o1) Newton
</pre></div>
</div>
</div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">rootfinder</span></code> function expects a display name, the name of a solver plugin
(here a simple full-step Newton method) and the residual function.</p>
<p>Rootfinding objects in CasADi are differential objects and derivatives can be calculated exactly to arbitrary order.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://casadi.org/python-api/#rootfinding">API of rootfinder</a></p>
</div>
</div>
<div class="section" id="initial-value-problems-and-sensitivity-analysis">
<span id="sec-integrator"></span><h3>4.4. Initial-value problems and sensitivity analysis<a class="headerlink" href="#initial-value-problems-and-sensitivity-analysis" title="Permalink to this headline">¶</a></h3>
<p>CasADi can be used to solve initial-value problems in ODE or DAE. The problem formulation used
is a DAE of semi-explicit form with quadratures:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
 \dot{x} &amp;= f_{\text{ode}}(t,x,z,p), \qquad x(0) = x_0 \\
      0  &amp;= f_{\text{alg}}(t,x,z,p) \\
 \dot{q} &amp;= f_{\text{quad}}(t,x,z,p), \qquad q(0) = 0
\end{aligned}\end{split}\]</div>
<p>For solvers of <em>ordinary</em> differential equations, the second equation and the algebraic variables <span class="math notranslate nohighlight">\(z\)</span> must be absent.</p>
<p>An integrator in CasADi is a function that takes the state at the initial time <code class="docutils literal notranslate"><span class="pre">x0</span></code>, a set of parameters <code class="docutils literal notranslate"><span class="pre">p</span></code>, and a guess for the algebraic variables (only for DAEs) <code class="docutils literal notranslate"><span class="pre">z0</span></code> and returns the state vector <code class="docutils literal notranslate"><span class="pre">xf</span></code>, algebraic variables <code class="docutils literal notranslate"><span class="pre">zf</span></code> and the quadrature state <code class="docutils literal notranslate"><span class="pre">qf</span></code>, all at the final time.</p>
<p>The freely available <a class="reference external" href="https://computation.llnl.gov/casc/sundials/description/description.html">SUNDIALS suite</a> (distributed along with CasADi) contains the two popular integrators CVodes and IDAS for ODEs and DAEs respectively. These integrators have support for forward and adjoint sensitivity analysis and when used via CasADi’s Sundials interface, CasADi will automatically formulate the Jacobian information, which is needed by the backward differentiation formula (BDF) that CVodes and IDAS use. Also automatically formulated will be the forward and adjoint sensitivity equations.</p>
<div class="section" id="creating-integrators">
<h4>4.4.1. Creating integrators<a class="headerlink" href="#creating-integrators" title="Permalink to this headline">¶</a></h4>
<p>Integrators are created using CasADi’s <code class="docutils literal notranslate"><span class="pre">integrator</span></code> function. Different integrators schemes and interfaces are implemented as <em>plugins</em>, essentially shared libraries that are loaded at runtime.</p>
<p>Consider for example the DAE:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
 \dot{x} &amp;= z+p, \\
      0  &amp;= z \, \cos(z)-x
\end{aligned}\end{split}\]</div>
<p>An integrator, using the “idas” plugin, can be created using the syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span> <span class="n">z</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">);</span> <span class="n">p</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">dae</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;ode&#39;</span><span class="p">:</span><span class="n">z</span><span class="o">+</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;alg&#39;</span><span class="p">:</span><span class="n">z</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">}</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">integrator</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;idas&#39;</span><span class="p">,</span> <span class="n">dae</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>F:(x0,p,z0,rx0[0],rp[0],rz0[0])-&gt;(xf,qf[0],zf,rxf[0],rqf[0],rzf[0]) IdasInterface
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">);</span> <span class="n">z</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">);</span> <span class="n">p</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">);</span>
<span class="n">dae</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;ode&#39;</span><span class="p">,</span><span class="n">z</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;alg&#39;</span><span class="p">,</span><span class="n">z</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">);</span>
<span class="n">F</span> <span class="p">=</span> <span class="n">integrator</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;idas&#39;</span><span class="p">,</span> <span class="n">dae</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>F:(x0,p,z0,rx0[0],rp[0],rz0[0])-&gt;(xf,qf[0],zf,rxf[0],rqf[0],rzf[0]) IdasInterface
</pre></div>
</div>
<p>Integrating this DAE from 0 to 1 with <span class="math notranslate nohighlight">\(x(0)=0\)</span>, <span class="math notranslate nohighlight">\(p=0.1\)</span> and using the guess <span class="math notranslate nohighlight">\(z(0)=0\)</span>, can
be done by evaluating the created function object:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;xf&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>0.1724
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;x0&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;z0&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="mf">0.1</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">xf</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>0.1724
</pre></div>
</div>
</div>
</div>
<p>The time horizon is assumed to be fixed <a class="footnote-reference" href="#f1" id="id1">[1]</a> and can be changed from its default [0, 1] by setting the options “t0” and “tf”.</p>
</div>
<div class="section" id="sensitivity-analysis">
<h4>4.4.2. Sensitivity analysis<a class="headerlink" href="#sensitivity-analysis" title="Permalink to this headline">¶</a></h4>
<p>From a usage point of view, an integrator behaves just like the function objects created from expressions earlier in the chapter.
You can use member functions in the Function class to generate new function objects corresponding to directional derivatives (forward or reverse mode) or complete Jacobians. Then evaluate these function objects numerically to obtain sensitivity information. The documented example “sensitivity_analysis” (available in CasADi’s example collection for Python, MATLAB and C++) demonstrate how CasADi can be used to calculate first and second order derivative information (forward-over-forward, forward-over-adjoint, adjoint-over-adjoint) for a simple DAE.</p>
</div>
</div>
<div class="section" id="nonlinear-programming">
<span id="sec-nlpsol"></span><h3>4.5. Nonlinear programming<a class="headerlink" href="#nonlinear-programming" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section assumes familiarity with much of the material that comes above.
There is also a higher-level interface in <a class="reference internal" href="index.html#sec-opti"><span class="std std-numref">Chapter 9</span></a>. That interface can be learned stand-alone.</p>
</div>
<p>The NLP solvers distributed with or interfaced to CasADi solves parametric NLPs of the following form:</p>
<div class="math notranslate nohighlight" id="equation-nlp">
<span class="eqno">(4.5.1)<a class="headerlink" href="#equation-nlp" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{array}{cc}
\begin{array}{c}
\text{minimize:} \\
x
\end{array}
&amp;
f(x,p)
\\
\begin{array}{c}
\text{subject to:}
\end{array}
&amp;
\begin{array}{rcl}
  x_{\textrm{lb}} \le &amp;  x   &amp; \le x_{\textrm{ub}} \\
  g_{\textrm{lb}} \le &amp;g(x,p)&amp; \le g_{\textrm{ub}}
\end{array}
\end{array}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(x \in \mathbb{R}^{nx}\)</span> is the decision variable and <span class="math notranslate nohighlight">\(p \in \mathbb{R}^{np}\)</span> is a known parameter vector.</p>
<p>An NLP solver in CasADi is a function that takes the parameter value (<code class="docutils literal notranslate"><span class="pre">p</span></code>), the bounds (<code class="docutils literal notranslate"><span class="pre">lbx</span></code>, <code class="docutils literal notranslate"><span class="pre">ubx</span></code>, <code class="docutils literal notranslate"><span class="pre">lbg</span></code>, <code class="docutils literal notranslate"><span class="pre">ubg</span></code>) and a guess for the primal-dual solution (<code class="docutils literal notranslate"><span class="pre">x0</span></code>, <code class="docutils literal notranslate"><span class="pre">lam_x0</span></code>, <code class="docutils literal notranslate"><span class="pre">lam_g0</span></code>) and returns the optimal solution. Unlike integrator objects, NLP solver functions are currently not differentiable functions in CasADi.</p>
<p>There are several NLP solvers interfaced with CasADi. The most popular one is IPOPT, an open-source primal-dual interior point method which is included in CasADi installations. Others, that require the installation of third-party software, include SNOPT, WORHP and KNITRO. Whatever the NLP solver used, the interface will automatically generate the information that it needs to solve the NLP, which may be solver and option dependent. Typically an NLP solver will need a function that gives the Jacobian of the constraint function and a Hessian of the Lagrangian function (<span class="math notranslate nohighlight">\(L(x,\lambda) = f(x) + \lambda^{\text{T}} \, g(x))\)</span> with respect to <span class="math notranslate nohighlight">\(x\)</span>.</p>
<div class="section" id="creating-nlp-solvers">
<h4>4.5.1. Creating NLP solvers<a class="headerlink" href="#creating-nlp-solvers" title="Permalink to this headline">¶</a></h4>
<p>NLP solvers are created using CasADi’s <code class="docutils literal notranslate"><span class="pre">nlpsol</span></code> function. Different solvers and interfaces are implemented as <em>plugins</em>.
Consider the following form of the so-called Rosenbrock problem:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{cc}
\begin{array}{c}
\text{minimize:} \\
x,y,z
\end{array}
&amp;
x^2 + 100 \, z^2  \\
\begin{array}{c}
\text{subject to:}
\end{array}
&amp;  z+(1-x)^2-y = 0
\end{array}\end{split}\]</div>
<p>A solver for this problem, using the “ipopt” plugin, can be created using the syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">);</span> <span class="n">z</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">vertcat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">100</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span><span class="n">z</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">y</span><span class="p">}</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">nlpsol</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;ipopt&#39;</span><span class="p">,</span> <span class="n">nlp</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>S:(x0[3],p[],lbx[3],ubx[3],lbg,ubg,lam_x0[3],lam_g0)-&gt;(x[3],f,g,lam_x[3],lam_g,lam_p[]) IpoptInterface
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">);</span> <span class="n">y</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span> <span class="n">z</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">);</span>
<span class="n">nlp</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">;</span><span class="n">y</span><span class="p">;</span><span class="n">z</span><span class="p">],</span> <span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">x</span>^<span class="mi">2</span><span class="o">+</span><span class="mi">100</span><span class="o">*</span><span class="n">z</span>^<span class="mi">2</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">z</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>^<span class="mi">2</span><span class="o">-</span><span class="n">y</span><span class="p">);</span>
<span class="n">S</span> <span class="p">=</span> <span class="n">nlpsol</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;ipopt&#39;</span><span class="p">,</span> <span class="n">nlp</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>S:(x0[3],p[],lbx[3],ubx[3],lbg,ubg,lam_x0[3],lam_g0)-&gt;(x[3],f,g,lam_x[3],lam_g,lam_p[]) IpoptInterface
</pre></div>
</div>
<p>Once the solver has been created, we can solve the NLP, using <code class="docutils literal notranslate"><span class="pre">[2.5,3.0,0.75]</span></code> as an initial guess, by evaluating the
function <code class="docutils literal notranslate"><span class="pre">S</span></code>:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">0.75</span><span class="p">],</span>\
      <span class="n">lbg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ubg</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x_opt</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;x_opt: &#39;</span><span class="p">,</span> <span class="n">x_opt</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

This is Ipopt version 3.12.3, running with linear solver mumps.
NOTE: Other linear solvers might be more efficient (see Ipopt documentation).

Number of nonzeros in equality constraint Jacobian...:        3
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:        2

Total number of variables............................:        3
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        0
                     variables with only upper bounds:        0
Total number of equality constraints.................:        1
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  6.2500000e+01 0.00e+00 9.00e+01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  1.8457621e+01 1.48e-02 4.10e+01  -1.0 4.10e-01   2.0 1.00e+00 1.00e+00f  1
   2  7.8031530e+00 3.84e-03 8.76e+00  -1.0 2.63e-01   1.5 1.00e+00 1.00e+00f  1
   3  7.1678278e+00 9.42e-05 1.04e+00  -1.0 9.32e-02   1.0 1.00e+00 1.00e+00f  1
   4  6.7419924e+00 6.18e-03 9.95e-01  -1.0 2.69e-01   0.6 1.00e+00 1.00e+00f  1
   5  5.4363330e+00 7.03e-02 1.04e+00  -1.7 8.40e-01   0.1 1.00e+00 1.00e+00f  1
   6  1.2144815e+00 1.52e+00 1.32e+00  -1.7 3.21e+00  -0.4 1.00e+00 1.00e+00f  1
   7  1.0214718e+00 2.51e-01 1.17e+01  -1.7 1.33e+00   0.9 1.00e+00 1.00e+00h  1
   8  3.1864085e-01 1.04e-03 7.53e-01  -1.7 3.58e-01    -  1.00e+00 1.00e+00f  1
   9  0.0000000e+00 3.19e-01 0.00e+00  -1.7 5.64e-01    -  1.00e+00 1.00e+00f  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  0.0000000e+00 0.00e+00 0.00e+00  -1.7 3.19e-01    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 10

                                   (scaled)                 (unscaled)
Objective...............:   0.0000000000000000e+00    0.0000000000000000e+00
Dual infeasibility......:   0.0000000000000000e+00    0.0000000000000000e+00
Constraint violation....:   0.0000000000000000e+00    0.0000000000000000e+00
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   0.0000000000000000e+00    0.0000000000000000e+00


Number of objective function evaluations             = 11
Number of objective gradient evaluations             = 11
Number of equality constraint evaluations            = 11
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 11
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 10
Total CPU secs in IPOPT (w/o function evaluations)   =      0.003
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.
               t_proc [s]   t_wall [s]    n_eval
           S      0.00467      0.00467         1
       nlp_f      1.2e-05     1.19e-05        11
       nlp_g      2.7e-05     2.43e-05        11
  nlp_grad_f        2e-05     1.86e-05        12
  nlp_hess_l      1.2e-05     1.39e-05        10
   nlp_jac_g      1.4e-05     1.39e-05        12
x_opt:  [0, 1, 0]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="p">=</span> <span class="n">S</span><span class="p">(</span><span class="s">&#39;x0&#39;</span><span class="p">,[</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">0.75</span><span class="p">],...</span>
      <span class="s">&#39;lbg&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;ubg&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">x_opt</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">x_opt</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

This is Ipopt version 3.12.3, running with linear solver mumps.
NOTE: Other linear solvers might be more efficient (see Ipopt documentation).

Number of nonzeros in equality constraint Jacobian...:        3
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:        2

Total number of variables............................:        3
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        0
                     variables with only upper bounds:        0
Total number of equality constraints.................:        1
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  6.2500000e+01 0.00e+00 9.00e+01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  1.8457621e+01 1.48e-02 4.10e+01  -1.0 4.10e-01   2.0 1.00e+00 1.00e+00f  1
   2  7.8031530e+00 3.84e-03 8.76e+00  -1.0 2.63e-01   1.5 1.00e+00 1.00e+00f  1
   3  7.1678278e+00 9.42e-05 1.04e+00  -1.0 9.32e-02   1.0 1.00e+00 1.00e+00f  1
   4  6.7419924e+00 6.18e-03 9.95e-01  -1.0 2.69e-01   0.6 1.00e+00 1.00e+00f  1
   5  5.4363330e+00 7.03e-02 1.04e+00  -1.7 8.40e-01   0.1 1.00e+00 1.00e+00f  1
   6  1.2144815e+00 1.52e+00 1.32e+00  -1.7 3.21e+00  -0.4 1.00e+00 1.00e+00f  1
   7  1.0214718e+00 2.51e-01 1.17e+01  -1.7 1.33e+00   0.9 1.00e+00 1.00e+00h  1
   8  3.1864085e-01 1.04e-03 7.53e-01  -1.7 3.58e-01    -  1.00e+00 1.00e+00f  1
   9  0.0000000e+00 3.19e-01 0.00e+00  -1.7 5.64e-01    -  1.00e+00 1.00e+00f  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  0.0000000e+00 0.00e+00 0.00e+00  -1.7 3.19e-01    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 10

                                   (scaled)                 (unscaled)
Objective...............:   0.0000000000000000e+00    0.0000000000000000e+00
Dual infeasibility......:   0.0000000000000000e+00    0.0000000000000000e+00
Constraint violation....:   0.0000000000000000e+00    0.0000000000000000e+00
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   0.0000000000000000e+00    0.0000000000000000e+00


Number of objective function evaluations             = 11
Number of objective gradient evaluations             = 11
Number of equality constraint evaluations            = 11
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 11
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 10
Total CPU secs in IPOPT (w/o function evaluations)   =      0.005
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.
               t_proc [s]   t_wall [s]    n_eval
           S      0.00972      0.00975         1
       nlp_f      1.8e-05      1.8e-05        11
       nlp_g      7.5e-05      6.8e-05        11
  nlp_grad_f      3.8e-05     3.76e-05        12
  nlp_hess_l      2.7e-05      2.6e-05        10
   nlp_jac_g      2.3e-05     2.32e-05        12
[0, 1, 0]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="quadratic-programming">
<span id="sec-qpsol"></span><h3>4.6. Quadratic programming<a class="headerlink" href="#quadratic-programming" title="Permalink to this headline">¶</a></h3>
<p>CasADi provides interfaces to solve quadratic programs (QPs). Supported solvers are the open-source solvers qpOASES (distributed with CasADi) and
OOQP as well as the commercial solvers CPLEX and GUROBI.</p>
<p>There are two different ways to solve QPs in CasADi, using a high-level interface and a low-level interface. They are described in the following.</p>
<div class="section" id="high-level-interface">
<h4>4.6.1. High-level interface<a class="headerlink" href="#high-level-interface" title="Permalink to this headline">¶</a></h4>
<p>The high-level interface for quadratic programming mirrors that of nonlinear programming, i.e. expects a problem of the form <a class="reference internal" href="#equation-nlp">(4.5.1)</a>,
with the restriction that objective function <span class="math notranslate nohighlight">\(f(x,p)\)</span> must be a convex quadratic function in <span class="math notranslate nohighlight">\(x\)</span> and the constraint function <span class="math notranslate nohighlight">\(g(x,p)\)</span> must be linear in <span class="math notranslate nohighlight">\(x\)</span>.
If the functions are not quadratic and linear, respectively, the solution is done at the current linearization point, given by the “initial guess” for <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>If the objective function is not convex, the solver may or may not fail to find a solution or the solution may not be unique.</p>
<p>To illustrate the syntax, we consider the following convex QP:</p>
<div class="math notranslate nohighlight" id="equation-simple-qp">
<span class="eqno">(4.6.1)<a class="headerlink" href="#equation-simple-qp" title="Permalink to this equation">¶</a></span>\[\begin{split}  \begin{array}{cc}
  \begin{array}{c}
  \text{minimize:} \\
  x,y
  \end{array}
  &amp;
  x^2 + y^2  \\
  \begin{array}{c}
  \text{subject to:}
  \end{array}
  &amp; x+y-10 \ge 0
  \end{array}\end{split}\]</div>
<p>To solve this problem with the high-level interface, we simply replace <code class="docutils literal notranslate"><span class="pre">nlpsol</span></code> with <code class="docutils literal notranslate"><span class="pre">qpsol</span></code> and use a QP solver plugin such as the with CasADi distributed qpOASES:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">SX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">qp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">vertcat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">-</span><span class="mi">10</span><span class="p">}</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">qpsol</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;qpoases&#39;</span><span class="p">,</span> <span class="n">qp</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>S:(x0[2],p[],lbx[2],ubx[2],lbg,ubg,lam_x0[2],lam_g0)-&gt;(x[2],f,g,lam_x[2],lam_g,lam_p[]) MXFunction
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">);</span> <span class="n">y</span> <span class="p">=</span> <span class="n">SX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span>
<span class="nb">qp</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">;</span><span class="n">y</span><span class="p">],</span> <span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">x</span>^<span class="mi">2</span><span class="o">+</span><span class="n">y</span>^<span class="mi">2</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">-</span><span class="mi">10</span><span class="p">);</span>
<span class="n">S</span> <span class="p">=</span> <span class="n">qpsol</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;qpoases&#39;</span><span class="p">,</span> <span class="nb">qp</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>S:(x0[2],p[],lbx[2],ubx[2],lbg,ubg,lam_x0[2],lam_g0)-&gt;(x[2],f,g,lam_x[2],lam_g,lam_p[]) MXFunction
</pre></div>
</div>
<p>The created solver object <code class="docutils literal notranslate"><span class="pre">S</span></code> will have the same input and output signature as the solver objects
created with <code class="docutils literal notranslate"><span class="pre">nlpsol</span></code>. Since the solution is unique, it is less important to provide an initial guess:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">lbg</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x_opt</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;x_opt: &#39;</span><span class="p">,</span> <span class="n">x_opt</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>

####################   qpOASES  --  QP NO.   1   #####################

    Iter   |    StepLength    |       Info       |   nFX   |   nAC
 ----------+------------------+------------------+---------+---------
       0   |   1.866661e-07   |   ADD CON    0   |     1   |     1
       1   |   8.333622e-10   |   REM BND    1   |     0   |     1
       2   |   1.000000e+00   |    QP SOLVED     |     0   |     1
x_opt:  [5, 5]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="p">=</span> <span class="n">S</span><span class="p">(</span><span class="s">&#39;lbg&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">x_opt</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">x_opt</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>

####################   qpOASES  --  QP NO.   1   #####################

    Iter   |    StepLength    |       Info       |   nFX   |   nAC
 ----------+------------------+------------------+---------+---------
       0   |   1.866661e-07   |   ADD CON    0   |     1   |     1
       1   |   8.333622e-10   |   REM BND    1   |     0   |     1
       2   |   1.000000e+00   |    QP SOLVED     |     0   |     1
[5, 5]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="low-level-interface">
<h4>4.6.2. Low-level interface<a class="headerlink" href="#low-level-interface" title="Permalink to this headline">¶</a></h4>
<p>The low-level interface, on the other hand, solves QPs of the following form:</p>
<div class="math notranslate nohighlight" id="equation-qp">
<span class="eqno">(4.6.2)<a class="headerlink" href="#equation-qp" title="Permalink to this equation">¶</a></span>\[\begin{split}  \begin{array}{cc}
  \begin{array}{c}
  \text{minimize:} \\
  x
  \end{array}
  &amp;
  \frac{1}{2} x^T \, H \, x + g^T \, x
  \\
  \begin{array}{c}
  \text{subject to:}
  \end{array}
  &amp;
  \begin{array}{rcl}
    x_{\textrm{lb}} \le &amp;  x   &amp; \le x_{\textrm{ub}} \\
    a_{\textrm{lb}} \le &amp; A \, x&amp; \le a_{\textrm{ub}}
  \end{array}
  \end{array}\end{split}\]</div>
<p>Encoding problem <a class="reference internal" href="#equation-simple-qp">(4.6.1)</a> in this form, omitting bounds that are infinite, is straightforward:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">DM</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">DM</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">DM</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lba</span> <span class="o">=</span> <span class="mf">10.</span>
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">H</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">DM</span><span class="p">.</span><span class="nb">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">A</span> <span class="p">=</span> <span class="n">DM</span><span class="p">.</span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">g</span> <span class="p">=</span> <span class="n">DM</span><span class="p">.</span><span class="nb">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">lba</span> <span class="p">=</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>To create a solver instance, instead of passing symbolic expressions for the QP, we now pass the sparsity patterns of the matrices <span class="math notranslate nohighlight">\(H\)</span> and <span class="math notranslate nohighlight">\(A\)</span>.
Since we used CasADi’s <code class="xref py py-class docutils literal notranslate"><span class="pre">DM</span></code>-type above, we can simply query the sparsity patterns:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">qp</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">qp</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">sparsity</span><span class="p">()</span>
<span class="n">qp</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">sparsity</span><span class="p">()</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">conic</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;qpoases&#39;</span><span class="p">,</span><span class="n">qp</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>S:(h[2x2,2nz],g[2],a[1x2],lba,uba,lbx[2],ubx[2],x0[2],lam_x0[2],lam_a0,q[],p[])-&gt;(x[2],cost,lam_a,lam_x[2]) QpoasesInterface
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">qp</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">;</span>
<span class="nb">qp</span><span class="p">.</span><span class="n">h</span> <span class="p">=</span> <span class="n">H</span><span class="p">.</span><span class="n">sparsity</span><span class="p">();</span>
<span class="nb">qp</span><span class="p">.</span><span class="n">a</span> <span class="p">=</span> <span class="n">A</span><span class="p">.</span><span class="n">sparsity</span><span class="p">();</span>
<span class="n">S</span> <span class="p">=</span> <span class="n">conic</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;qpoases&#39;</span><span class="p">,</span><span class="nb">qp</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>S:(h[2x2,2nz],g[2],a[1x2],lba,uba,lbx[2],ubx[2],x0[2],lam_x0[2],lam_a0,q[],p[])-&gt;(x[2],cost,lam_a,lam_x[2]) QpoasesInterface
</pre></div>
</div>
</div>
</div>
<p>The returned <code class="docutils literal notranslate"><span class="pre">Function</span></code> instance will have a <em>different</em> input/output signature compared to the high-level interface, one that includes the matrices <span class="math notranslate nohighlight">\(H\)</span> and <span class="math notranslate nohighlight">\(A\)</span>:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> \
      <span class="n">a</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">lba</span><span class="o">=</span><span class="n">lba</span><span class="p">)</span>
<span class="n">x_opt</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;x_opt: &#39;</span><span class="p">,</span> <span class="n">x_opt</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>

####################   qpOASES  --  QP NO.   1   #####################

    Iter   |    StepLength    |       Info       |   nFX   |   nAC
 ----------+------------------+------------------+---------+---------
       0   |   1.866661e-07   |   ADD CON    0   |     1   |     1
       1   |   8.333622e-10   |   REM BND    1   |     0   |     1
       2   |   1.000000e+00   |    QP SOLVED     |     0   |     1
x_opt:  [5, 5]
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="p">=</span> <span class="n">S</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,...</span>
      <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="s">&#39;lba&#39;</span><span class="p">,</span> <span class="n">lba</span><span class="p">);</span>
<span class="n">x_opt</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">x_opt</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>

####################   qpOASES  --  QP NO.   1   #####################

    Iter   |    StepLength    |       Info       |   nFX   |   nAC
 ----------+------------------+------------------+---------+---------
       0   |   1.866661e-07   |   ADD CON    0   |     1   |     1
       1   |   8.333622e-10   |   REM BND    1   |     0   |     1
       2   |   1.000000e+00   |    QP SOLVED     |     0   |     1
[5, 5]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="for-loop-equivalents">
<h3>4.7. For-loop equivalents<a class="headerlink" href="#for-loop-equivalents" title="Permalink to this headline">¶</a></h3>
<p>When modeling using expression graphs in CasADi, it is a common pattern to use of for-loop constructs of the host language (C++/Python/Matlab).</p>
<p>The graph size will grow linearly with the loop size <span class="math notranslate nohighlight">\(n\)</span>, and so will the construction time of the expression graph and the initialization time of functions using that expression.</p>
<p>We offer some special constructs that improve on this complexity.</p>
<div class="section" id="map">
<h4>4.7.1. Map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h4>
<p>Suppose you are interested in computing a function <span class="math notranslate nohighlight">\(f : \mathbb{R}^{n} \rightarrow \mathbb{R}^{m}\)</span> repeatedly on all columns of a matrix <span class="math notranslate nohighlight">\(X \in \mathbb{R}^{n \times N}\)</span>, and aggregating all results in a result matrix <span class="math notranslate nohighlight">\(Y \in \mathbb{R}^{m \times N}\)</span>:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
  <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="n">i</span><span class="p">]))</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">hcat</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,[</span><span class="n">X</span><span class="p">],[</span><span class="n">Y</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(i0)-&gt;(o0) SXFunction
F:(i0[1x4])-&gt;(o0[1x4]) MXFunction
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="n">X</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>

<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">ys</span> <span class="p">=</span> <span class="p">{};</span>
<span class="k">for</span> <span class="n">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
  <span class="n">ys</span><span class="p">{</span><span class="k">end</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">(:,</span><span class="n">i</span><span class="p">));</span>
<span class="k">end</span>
<span class="n">Y</span> <span class="p">=</span> <span class="p">[</span><span class="n">ys</span><span class="p">{:}];</span>
<span class="n">F</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,{</span><span class="n">X</span><span class="p">},{</span><span class="n">Y</span><span class="p">});</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(i0)-&gt;(o0) SXFunction
F:(i0[1x4])-&gt;(o0[1x4]) MXFunction
</pre></div>
</div>
</div>
</div>
<p>The aggregate function <span class="math notranslate nohighlight">\(F : \mathbb{R}^{n \times N} \rightarrow \mathbb{R}^{m \times N}\)</span> can be obtained with the <code class="docutils literal notranslate"><span class="pre">map</span></code> construct:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>map4_f:(i0[1x4])-&gt;(o0[1x4]) Map
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>map4_f:(i0[1x4])-&gt;(o0[1x4]) Map
</pre></div>
</div>
</div>
</div>
<p>CasADi can be instructed to parallelize when <span class="math notranslate nohighlight">\(F\)</span> gets evaluated. In the following example, we dedicate 2 threads for the <code class="docutils literal notranslate"><span class="pre">map</span></code> task.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="s2">&quot;thread&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>threadmap2_map2_f:(i0[1x4])-&gt;(o0[1x4]) ThreadMap
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="s">&#39;thread&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>threadmap2_map2_f:(i0[1x4])-&gt;(o0[1x4]) ThreadMap
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">map</span></code> operation supports primitive functions <span class="math notranslate nohighlight">\(f\)</span> with multiple inputs/outputs which can also be matrices. Aggregation will always happen horizontally.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">map</span></code> operation exhibits constant graph size and initialization time.</p>
</div>
<div class="section" id="fold">
<h4>4.7.2. Fold<a class="headerlink" href="#fold" title="Permalink to this headline">¶</a></h4>
<p>In case each for-loop iteration depends on the result from the previous iteration, the <code class="docutils literal notranslate"><span class="pre">fold</span></code> construct applies. In the following, the <code class="docutils literal notranslate"><span class="pre">x</span></code> variable acts as an accumulater that is initialized by <span class="math notranslate nohighlight">\(x_0 \in \mathbb{R}^{n}\)</span>:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,[</span><span class="n">x0</span><span class="p">],[</span><span class="n">x</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>F:(i0)-&gt;(o0) MXFunction
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">x0</span><span class="p">;</span>
<span class="k">for</span> <span class="n">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span>
  <span class="n">x</span> <span class="p">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="k">end</span>

<span class="n">F</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,{</span><span class="n">x0</span><span class="p">},{</span><span class="n">x</span><span class="p">});</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>F:(i0)-&gt;(o0) MXFunction
</pre></div>
</div>
</div>
</div>
<p>For a given function <span class="math notranslate nohighlight">\(f : \mathbb{R}^{n} \rightarrow \mathbb{R}^{n}\)</span>, the result function <span class="math notranslate nohighlight">\(F : \mathbb{R}^{n} \rightarrow \mathbb{R}^{n}\)</span> can be obtained with the <code class="docutils literal notranslate"><span class="pre">fold</span></code> construct:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">fold</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>fold_f:(i0)-&gt;(o0) MXFunction
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">fold</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>fold_f:(i0)-&gt;(o0) MXFunction
</pre></div>
</div>
</div>
</div>
<p>In case intermediate accumulator values are desired as output (<span class="math notranslate nohighlight">\(\mathbb{R}^{n} \rightarrow \mathbb{R}^{n \times N}\)</span>), use <code class="docutils literal notranslate"><span class="pre">mapaccum</span></code> instead of <code class="docutils literal notranslate"><span class="pre">fold</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">fold</span></code>/<code class="docutils literal notranslate"><span class="pre">mapaccum</span></code> operation supports primitive functions <span class="math notranslate nohighlight">\(f\)</span> with multiple inputs/outputs which can also be matrices.
The first input and output are used for accumulating, while the remainder inputs are read column-wise over the iterations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">map</span></code>/<code class="docutils literal notranslate"><span class="pre">mapaccum</span></code> operation exhibits a graph size and initialization time that scales logarithmically with <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>for problems with free end time, you can always scale time by introducing an extra parameter and substitute <span class="math notranslate nohighlight">\(t\)</span> for a dimensionless time variable that goes from 0 to 1</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-ccode"></span><div class="section" id="generating-c-code">
<span id="sec-ccode"></span><h2>5. Generating C-code<a class="headerlink" href="#generating-c-code" title="Permalink to this headline">¶</a></h2>
<p>The numerical evaluation of function objects in CasADi normally takes place in <em>virtual machines</em>,
implemented as part of CasADi’s symbolic framework. But CasADi also supports the generation of
self-contained C-code for a large subset of function objects.</p>
<p>C-code generation is interesting for a number of reasons:</p>
<ul class="simple">
<li>Speeding up the evaluation time. As a rule of thumb, the numerical evaluation of autogenerated code, compiled with code optimization flags, can be between 4 and 10 times faster than the same code executed in CasADi’s virtual machines.</li>
<li>Allowing code to be compiled on a system where CasADi is not installed, such as an embedded system. All that is needed to compile the generated code is a C compiler.</li>
<li>Debugging and profiling functions. The generated code is essentially a mirror of the evaluation that takes place in the virtual machines and if a particular operation is slow, this is likely to show up when analyzing the generated code with a profiling tool such as <code class="docutils literal notranslate"><span class="pre">gprof</span></code>. By looking at the code, it is also possible to detect what is potentially done in a suboptimal way. If the code is very long and takes a long time to compile, it is an indication that some functions need to be broken up in smaller, but nested functions.</li>
</ul>
<div class="section" id="syntax-for-generating-code">
<span id="sec-codegen-syntax"></span><h3>5.1. Syntax for generating code<a class="headerlink" href="#syntax-for-generating-code" title="Permalink to this headline">¶</a></h3>
<p>Generated C code can be as simple as calling the <code class="docutils literal notranslate"><span class="pre">generate</span></code> member function for a <code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code> instance.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">],</span>\
      <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">],</span>\
      <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">],[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="s1">&#39;gen.c&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;gen.c&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>/* This file was automatically generated by CasADi.
   The CasADi copyright holders make no ownership claim of its contents. */
#ifdef __cplusplus
extern &quot;C&quot; {
#endif

/* How to prefix internal symbols */
#ifdef CODEGEN_PREFIX
  #define NAMESPACE_CONCAT(NS, ID) _NAMESPACE_CONCAT(NS, ID)
  #define _NAMESPACE_CONCAT(NS, ID) NS ## ID
  #define CASADI_PREFIX(ID) NAMESPACE_CONCAT(CODEGEN_PREFIX, ID)
#else
  #define CASADI_PREFIX(ID) gen_ ## ID
#endif

#include &lt;math.h&gt;

#ifndef casadi_real
#define casadi_real double
#endif

#ifndef casadi_int
#define casadi_int long long int
#endif

/* Add prefix to internal symbols */
#define casadi_copy CASADI_PREFIX(copy)
#define casadi_f0 CASADI_PREFIX(f0)
#define casadi_s0 CASADI_PREFIX(s0)
#define casadi_s1 CASADI_PREFIX(s1)

/* Symbol visibility in DLLs */
#ifndef CASADI_SYMBOL_EXPORT
  #if defined(_WIN32) || defined(__WIN32__) || defined(__CYGWIN__)
    #if defined(STATIC_LINKED)
      #define CASADI_SYMBOL_EXPORT
    #else
      #define CASADI_SYMBOL_EXPORT __declspec(dllexport)
    #endif
  #elif defined(__GNUC__) &amp;&amp; defined(GCC_HASCLASSVISIBILITY)
    #define CASADI_SYMBOL_EXPORT __attribute__ ((visibility (&quot;default&quot;)))
  #else
    #define CASADI_SYMBOL_EXPORT
  #endif
#endif

static const casadi_int casadi_s0[6] = {2, 1, 0, 2, 0, 1};
static const casadi_int casadi_s1[5] = {1, 1, 0, 1, 0};

void casadi_copy(const casadi_real* x, casadi_int n, casadi_real* y) {
  casadi_int i;
  if (y) {
    if (x) {
      for (i=0; i&lt;n; ++i) *y++ = *x++;
    } else {
      for (i=0; i&lt;n; ++i) *y++ = 0.;
    }
  }
}

/* f:(x[2],y)-&gt;(r[2],q[2]) */
static int casadi_f0(const casadi_real** arg, casadi_real** res, casadi_int* iw, casadi_real* w, void* mem) {
  casadi_int i;
  casadi_real *rr;
  const casadi_real *cs;
  casadi_real *w0=w+0, w1;
  /* #0: @0 = input[0][0] */
  casadi_copy(arg[0], 2, w0);
  /* #1: output[0][0] = @0 */
  casadi_copy(w0, 2, res[0]);
  /* #2: @1 = input[1][0] */
  w1 = arg[1] ? arg[1][0] : 0;
  /* #3: @1 = sin(@1) */
  w1 = sin( w1 );
  /* #4: @0 = (@1*@0) */
  for (i=0, rr=w0, cs=w0; i&lt;2; ++i) (*rr++)  = (w1*(*cs++));
  /* #5: output[1][0] = @0 */
  casadi_copy(w0, 2, res[1]);
  return 0;
}

CASADI_SYMBOL_EXPORT int f(const casadi_real** arg, casadi_real** res, casadi_int* iw, casadi_real* w, void* mem){
  return casadi_f0(arg, res, iw, w, mem);
}

CASADI_SYMBOL_EXPORT void f_incref(void) {
}

CASADI_SYMBOL_EXPORT void f_decref(void) {
}

CASADI_SYMBOL_EXPORT casadi_int f_n_in(void) { return 2;}

CASADI_SYMBOL_EXPORT casadi_int f_n_out(void) { return 2;}

CASADI_SYMBOL_EXPORT const char* f_name_in(casadi_int i){
  switch (i) {
    case 0: return &quot;x&quot;;
    case 1: return &quot;y&quot;;
    default: return 0;
  }
}

CASADI_SYMBOL_EXPORT const char* f_name_out(casadi_int i){
  switch (i) {
    case 0: return &quot;r&quot;;
    case 1: return &quot;q&quot;;
    default: return 0;
  }
}

CASADI_SYMBOL_EXPORT const casadi_int* f_sparsity_in(casadi_int i) {
  switch (i) {
    case 0: return casadi_s0;
    case 1: return casadi_s1;
    default: return 0;
  }
}

CASADI_SYMBOL_EXPORT const casadi_int* f_sparsity_out(casadi_int i) {
  switch (i) {
    case 0: return casadi_s0;
    case 1: return casadi_s0;
    default: return 0;
  }
}

CASADI_SYMBOL_EXPORT int f_work(casadi_int *sz_arg, casadi_int* sz_res, casadi_int *sz_iw, casadi_int *sz_w) {
  if (sz_arg) *sz_arg = 4;
  if (sz_res) *sz_res = 3;
  if (sz_iw) *sz_iw = 0;
  if (sz_w) *sz_w = 3;
  return 0;
}


#ifdef __cplusplus
} /* extern &quot;C&quot; */
#endif

</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span>
<span class="n">f</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">},...</span>
      <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="nb">sin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">},...</span>
      <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">},{</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;q&#39;</span><span class="p">});</span>
<span class="n">f</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="s">&#39;gen.c&#39;</span><span class="p">);</span>
<span class="nb">type</span><span class="p">(</span><span class="s">&#39;gen.c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>/* This file was automatically generated by CasADi.
   The CasADi copyright holders make no ownership claim of its contents. */
#ifdef __cplusplus
extern &quot;C&quot; {
#endif

/* How to prefix internal symbols */
#ifdef CODEGEN_PREFIX
  #define NAMESPACE_CONCAT(NS, ID) _NAMESPACE_CONCAT(NS, ID)
  #define _NAMESPACE_CONCAT(NS, ID) NS ## ID
  #define CASADI_PREFIX(ID) NAMESPACE_CONCAT(CODEGEN_PREFIX, ID)
#else
  #define CASADI_PREFIX(ID) gen_ ## ID
#endif

#include &lt;math.h&gt;

#ifndef casadi_real
#define casadi_real double
#endif

#ifndef casadi_int
#define casadi_int long long int
#endif

/* Add prefix to internal symbols */
#define casadi_copy CASADI_PREFIX(copy)
#define casadi_f0 CASADI_PREFIX(f0)
#define casadi_s0 CASADI_PREFIX(s0)
#define casadi_s1 CASADI_PREFIX(s1)

/* Symbol visibility in DLLs */
#ifndef CASADI_SYMBOL_EXPORT
  #if defined(_WIN32) || defined(__WIN32__) || defined(__CYGWIN__)
    #if defined(STATIC_LINKED)
      #define CASADI_SYMBOL_EXPORT
    #else
      #define CASADI_SYMBOL_EXPORT __declspec(dllexport)
    #endif
  #elif defined(__GNUC__) &amp;&amp; defined(GCC_HASCLASSVISIBILITY)
    #define CASADI_SYMBOL_EXPORT __attribute__ ((visibility (&quot;default&quot;)))
  #else
    #define CASADI_SYMBOL_EXPORT
  #endif
#endif

static const casadi_int casadi_s0[6] = {2, 1, 0, 2, 0, 1};
static const casadi_int casadi_s1[5] = {1, 1, 0, 1, 0};

void casadi_copy(const casadi_real* x, casadi_int n, casadi_real* y) {
  casadi_int i;
  if (y) {
    if (x) {
      for (i=0; i&lt;n; ++i) *y++ = *x++;
    } else {
      for (i=0; i&lt;n; ++i) *y++ = 0.;
    }
  }
}

/* f:(x[2],y)-&gt;(r[2],q[2]) */
static int casadi_f0(const casadi_real** arg, casadi_real** res, casadi_int* iw, casadi_real* w, void* mem) {
  casadi_int i;
  casadi_real *rr;
  const casadi_real *cs;
  casadi_real *w0=w+0, w1;
  /* #0: @0 = input[0][0] */
  casadi_copy(arg[0], 2, w0);
  /* #1: output[0][0] = @0 */
  casadi_copy(w0, 2, res[0]);
  /* #2: @1 = input[1][0] */
  w1 = arg[1] ? arg[1][0] : 0;
  /* #3: @1 = sin(@1) */
  w1 = sin( w1 );
  /* #4: @0 = (@1*@0) */
  for (i=0, rr=w0, cs=w0; i&lt;2; ++i) (*rr++)  = (w1*(*cs++));
  /* #5: output[1][0] = @0 */
  casadi_copy(w0, 2, res[1]);
  return 0;
}

CASADI_SYMBOL_EXPORT int f(const casadi_real** arg, casadi_real** res, casadi_int* iw, casadi_real* w, void* mem){
  return casadi_f0(arg, res, iw, w, mem);
}

CASADI_SYMBOL_EXPORT void f_incref(void) {
}

CASADI_SYMBOL_EXPORT void f_decref(void) {
}

CASADI_SYMBOL_EXPORT casadi_int f_n_in(void) { return 2;}

CASADI_SYMBOL_EXPORT casadi_int f_n_out(void) { return 2;}

CASADI_SYMBOL_EXPORT const char* f_name_in(casadi_int i){
  switch (i) {
    case 0: return &quot;x&quot;;
    case 1: return &quot;y&quot;;
    default: return 0;
  }
}

CASADI_SYMBOL_EXPORT const char* f_name_out(casadi_int i){
  switch (i) {
    case 0: return &quot;r&quot;;
    case 1: return &quot;q&quot;;
    default: return 0;
  }
}

CASADI_SYMBOL_EXPORT const casadi_int* f_sparsity_in(casadi_int i) {
  switch (i) {
    case 0: return casadi_s0;
    case 1: return casadi_s1;
    default: return 0;
  }
}

CASADI_SYMBOL_EXPORT const casadi_int* f_sparsity_out(casadi_int i) {
  switch (i) {
    case 0: return casadi_s0;
    case 1: return casadi_s0;
    default: return 0;
  }
}

CASADI_SYMBOL_EXPORT int f_work(casadi_int *sz_arg, casadi_int* sz_res, casadi_int *sz_iw, casadi_int *sz_w) {
  if (sz_arg) *sz_arg = 4;
  if (sz_res) *sz_res = 3;
  if (sz_iw) *sz_iw = 0;
  if (sz_w) *sz_w = 3;
  return 0;
}


#ifdef __cplusplus
} /* extern &quot;C&quot; */
#endif

</pre></div>
</div>
</div>
</div>
<p>This will create a C file <code class="docutils literal notranslate"><span class="pre">gen.c</span></code> containing the function <code class="docutils literal notranslate"><span class="pre">f</span></code> and all its dependencies and required helper functions.
We will return to how this file can be used in <a class="reference internal" href="#sec-codegen-syntax"><span class="std std-numref">Section 5.1</span></a> and the structure of the generated code is
described in <a class="reference internal" href="#sec-c-api"><span class="std std-numref">Section 5.3</span></a> below.</p>
<p>You can generate a C file containing multiple CasADi functions by working with CasADi’s <code class="xref py py-class docutils literal notranslate"><span class="pre">CodeGenerator</span></code> class:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">],[</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">],[</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">CodeGenerator</span><span class="p">(</span><span class="s1">&#39;gen.c&#39;</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">},{</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)});</span>
<span class="n">g</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">},{</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)});</span>
<span class="n">C</span> <span class="p">=</span> <span class="n">CodeGenerator</span><span class="p">(</span><span class="s">&#39;gen.c&#39;</span><span class="p">);</span>
<span class="n">C</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="n">C</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>
<span class="n">C</span><span class="p">.</span><span class="n">generate</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>Both the <code class="docutils literal notranslate"><span class="pre">generate</span></code> function and the <code class="xref py py-class docutils literal notranslate"><span class="pre">CodeGenerator</span></code> constructor take an optional
options dictionary as an argument, allowing customization of the code generation. Two useful
options are <code class="docutils literal notranslate"><span class="pre">main</span></code>, which generates a <em>main</em> entry point, and <code class="docutils literal notranslate"><span class="pre">mex</span></code>,
which generates a <em>mexFunction</em> entry point:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">],[</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span>
<span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
            <span class="n">mex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="s1">&#39;gen.c&#39;</span><span class="p">,</span><span class="n">opts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">},{</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)});</span>
<span class="n">opts</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">,</span> <span class="nb">true</span><span class="p">,...</span>
              <span class="s">&#39;mex&#39;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="n">f</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="s">&#39;gen.c&#39;</span><span class="p">,</span><span class="n">opts</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>This enables executing the function from the command line and MATLAB, respectively,
as described in <a class="reference internal" href="#sec-using-codegen"><span class="std std-numref">Section 5.2</span></a> below.</p>
<p>If you plan to link directly against the generated code in some C/C++ application,
a useful option is <code class="docutils literal notranslate"><span class="pre">with_header</span></code>, which controls the creation of a header file
containing declarations of the functions with external linkage, i.e. the API of
the generated code, described in <a class="reference internal" href="#sec-c-api"><span class="std std-numref">Section 5.3</span></a> below.</p>
<p>Here is a list of available options for the <code class="xref py py-class docutils literal notranslate"><span class="pre">CodeGenerator</span></code> class:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="25%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Default value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">verbose</span></code></td>
<td>true</td>
<td>Include comments in generated code</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">mex</span></code></td>
<td>false</td>
<td>Generate an MATLAB/Octave MEX entry point</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cpp</span></code></td>
<td>false</td>
<td>Generated code is C++ instead of C</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">main</span></code></td>
<td>false</td>
<td>Generate a command line interface</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">casadi_real</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">double</span></code></td>
<td>Floating point type</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">casadi_int</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span> <span class="pre">int</span></code></td>
<td>Integer type</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">with_header</span></code></td>
<td>false</td>
<td>Generate a header file</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">with_mem</span></code></td>
<td>false</td>
<td>Generate a simplified C API</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">indent</span></code></td>
<td>2</td>
<td>Number of spaces per indentation level</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="using-the-generated-code">
<span id="sec-using-codegen"></span><h3>5.2. Using the generated code<a class="headerlink" href="#using-the-generated-code" title="Permalink to this headline">¶</a></h3>
<p>The generated C code can be used in a number of different ways:</p>
<ul class="simple">
<li>The code can be compiled into a dynamically linked library (DLL), from which a <code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code> instance can be created using CasADi’s <code class="docutils literal notranslate"><span class="pre">external</span></code> function. Optionally, the user can rely on CasADi to carry out the compilation <em>just-in-time</em>.</li>
<li>The generated code can be compiled into MEX function and executed from MATLAB.</li>
<li>The generated code can be executed from the command line.</li>
<li>The user can link, statically or dynamically, the generated code to his or her C/C++ application, accessing the C API of the generated code.</li>
<li>The code can be compiled into a dynamically linked library and the user can then manually access the C API using <code class="docutils literal notranslate"><span class="pre">dlopen</span></code> on Linux/OS X or <code class="docutils literal notranslate"><span class="pre">LoadLibrary</span></code> on Windows.</li>
</ul>
<p>This is elaborated in the following.</p>
<div class="section" id="casadi-s-external-function">
<h4>5.2.1. CasADi’s <code class="docutils literal notranslate"><span class="pre">external</span></code> function<a class="headerlink" href="#casadi-s-external-function" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">external</span></code> command allows the user to create a <code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code> instance
from a dynamically linked library with the entry points described by the
C API described in <a class="reference internal" href="#sec-c-api"><span class="std std-numref">Section 5.3</span></a>. Since the autogenerated files are
self-contained <a class="footnote-reference" href="#f2" id="id1">[1]</a>, the compilation – on Linux/OSX – can be as easy as issuing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gcc -fPIC -shared gen.c -o gen.so
</pre></div>
</div>
<p>from the command line. Or, equivalently using MATLAB’s <code class="docutils literal notranslate"><span class="pre">system</span></code> command
or Python’s <code class="docutils literal notranslate"><span class="pre">os.system</span></code> command. Assuming <code class="docutils literal notranslate"><span class="pre">gen.c</span></code> was created as
described in the previous section, we can then create a <code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code>
<code class="docutils literal notranslate"><span class="pre">f</span></code> as follows:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">external</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;./gen.so&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mf">3.14</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>0.00159265
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="p">=</span> <span class="n">external</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;./gen.so&#39;</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mf">3.14</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>0.00159265
</pre></div>
</div>
</div>
</div>
<p>We can also rely on CasADi performing the compilation <em>just-in-time</em>
using CasADi’s <code class="xref py py-class docutils literal notranslate"><span class="pre">Importer</span></code> class. This is a plugin class, which at the
time of writing had two supported plugins, namely <code class="docutils literal notranslate"><span class="pre">'clang'</span></code>, which invokes
the <em>LLVM/Clang</em> compiler framework (distributed with CasADi), and <code class="docutils literal notranslate"><span class="pre">'shell'</span></code>,
which invokes the system compiler via the command line:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">Importer</span><span class="p">(</span><span class="s1">&#39;gen.c&#39;</span><span class="p">,</span><span class="s1">&#39;clang&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">external</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mf">3.14</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>0.00159265
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="p">=</span> <span class="n">Importer</span><span class="p">(</span><span class="s">&#39;gen.c&#39;</span><span class="p">,</span><span class="s">&#39;clang&#39;</span><span class="p">);</span>
<span class="n">f</span> <span class="p">=</span> <span class="n">external</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">C</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mf">3.14</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>0.00159265
</pre></div>
</div>
</div>
</div>
<p>We will return to the <code class="docutils literal notranslate"><span class="pre">external</span></code> function in <a class="reference internal" href="index.html#sec-external"><span class="std std-numref">Section 6.3</span></a>.</p>
</div>
<div class="section" id="calling-generated-code-from-matlab">
<h4>5.2.2. Calling generated code from MATLAB<a class="headerlink" href="#calling-generated-code-from-matlab" title="Permalink to this headline">¶</a></h4>
<p>An alternative way of executing generated code is to compile the code into a
MATLAB MEX function and call from MATLAB. This assumes that the <code class="docutils literal notranslate"><span class="pre">mex</span></code> option
was set to “true” during the code generation, cf. <a class="reference internal" href="#sec-codegen-syntax"><span class="std std-numref">Section 5.1</span></a>.
The generated MEX function takes the function name as its first argument,
followed by the function inputs:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%mex gen.c -largeArrayDims  % Matlab</span>
<span class="n">mex</span> <span class="n">gen</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">DMATLAB_MEX_FILE</span> <span class="c">% Octave</span>

<span class="nb">disp</span><span class="p">(</span><span class="n">gen</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span> 0.0015927
</pre></div>
</div>
<p>Note that the result of the execution is always a MATLAB sparse matrix by default. Compiler flags <code class="docutils literal notranslate"><span class="pre">-DCASASI_MEX_ALWAYS_DENSE</span></code> and <code class="docutils literal notranslate"><span class="pre">-DCASASI_MEX_ALLOW_DENSE</span></code> may be set to influence this behaviour.</p>
</div>
<div class="section" id="calling-generated-code-from-the-command-line">
<h4>5.2.3. Calling generated code from the command line<a class="headerlink" href="#calling-generated-code-from-the-command-line" title="Permalink to this headline">¶</a></h4>
<p>Another option is to execute the generated code from the Linux/OSX command line.
This is possible if the <code class="docutils literal notranslate"><span class="pre">main</span></code> option was set to “true” during the code
generation, cf. <a class="reference internal" href="#sec-codegen-syntax"><span class="std std-numref">Section 5.1</span></a>. This is useful if you e.g. want
to profile the generated with a tool such as <code class="docutils literal notranslate"><span class="pre">gprof</span></code>.</p>
<p>When executing the generated code, the function name is passed
as a command line argument. The nonzero entries of all the inputs
need to be passed via standard input and the function will return the output
nonzeros for all the outputs via standard output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Command line
echo 3.14 3.14 &gt; gen_in.txt
gcc gen.c -o gen
./gen f &lt; gen_in.txt &gt; gen_out.txt
cat gen_out.txt # returns 0.00159265 0.00159265
</pre></div>
</div>
</div>
<div class="section" id="linking-against-generated-code-from-a-c-c-application">
<h4>5.2.4. Linking against generated code from a C/C++ application<a class="headerlink" href="#linking-against-generated-code-from-a-c-c-application" title="Permalink to this headline">¶</a></h4>
<p>The generated code is written so that it can be linked with directly from a C/C++
application. If the <code class="docutils literal notranslate"><span class="pre">with_header</span></code> option was set to “true” during the
code generation, a header file with declarations of all the exposed entry points
of the file. Using this header file requires an understanding of CasADi’s
codegen API, as described in <a class="reference internal" href="#sec-c-api"><span class="std std-numref">Section 5.3</span></a> below. Symbols that are
<em>not</em> exposed are prefixed with a file-specific prefix, allowing an
application to link against multiple generated functions without risking
symbol conflicts.</p>
</div>
<div class="section" id="dynamically-loading-generated-code-from-a-c-c-application">
<h4>5.2.5. Dynamically loading generated code from a C/C++ application<a class="headerlink" href="#dynamically-loading-generated-code-from-a-c-c-application" title="Permalink to this headline">¶</a></h4>
<p>A variant of above is to compile the generated code into a shared library,
but directly accessing the exposed symbols rather than relying on CasADi’s
<code class="docutils literal notranslate"><span class="pre">external</span></code> function. This also requires an understanding of the structure
of the generated code.</p>
<p>In CasADi’s example collection, <code class="docutils literal notranslate"><span class="pre">codegen_usage.cpp</span></code> demonstrates how this
can be done.</p>
</div>
</div>
<div class="section" id="api-of-the-generated-code">
<span id="sec-c-api"></span><h3>5.3. API of the generated code<a class="headerlink" href="#api-of-the-generated-code" title="Permalink to this headline">¶</a></h3>
<p>The API of the generated code consists of a number of functions with external
linkage. In addition to the actual execution, there are functions for memory
management as well as meta information about the inputs and outputs.
These functions are described in the following. Below, assume that the name of
function we want to access is <code class="docutils literal notranslate"><span class="pre">fname</span></code>. To see what these functions actually
look like in code and when they are called, we refer to the
<code class="docutils literal notranslate"><span class="pre">codegen_usage.cpp</span></code> example.</p>
<div class="section" id="reference-counting">
<h4>5.3.1. Reference counting<a class="headerlink" href="#reference-counting" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">fname_incref</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">fname_decref</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>A generated function may need to e.g. read in some data or initialize some data
structures before first call. This is typically not needed for functions generated
from CasADi expressions, but may be required e.g. when the generated code contains
calls to external functions. Similarly, memory might need to be deallocated
after usage.</p>
<p>To keep track of the ownership, the generated code contains two functions for
increasing and decreasing a reference counter.
They are named <code class="docutils literal notranslate"><span class="pre">fname_incref</span></code> and <code class="docutils literal notranslate"><span class="pre">fname_decref</span></code>, respectively. These
functions have no input argument and return void.</p>
<p>Typically, some initialization may take place upon the first call to
<code class="docutils literal notranslate"><span class="pre">fname_incref</span></code> and subsequent calls will only increase some internal counter.
The <code class="docutils literal notranslate"><span class="pre">fname_decref</span></code>, on the other hand, decreases the internal counter and
when the counter hits zero, a deallocation – if any – takes place.</p>
</div>
<div class="section" id="number-of-inputs-and-outputs">
<h4>5.3.2. Number of inputs and outputs<a class="headerlink" href="#number-of-inputs-and-outputs" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">casadi_int</span> <span class="nf">fname_n_in</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="n">casadi_int</span> <span class="nf">fname_n_out</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>The number of function inputs and outputs can be obtained by calling the
<code class="docutils literal notranslate"><span class="pre">fname_n_in</span></code> and <code class="docutils literal notranslate"><span class="pre">fname_n_out</span></code> functions, respectively. These functions
take no inputs and return the number of input or outputs (<code class="docutils literal notranslate"><span class="pre">casadi_int</span></code> is an alias for <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span> <span class="pre">int</span></code>).</p>
</div>
<div class="section" id="names-of-inputs-and-outputs">
<h4>5.3.3. Names of inputs and outputs<a class="headerlink" href="#names-of-inputs-and-outputs" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">fname_name_in</span><span class="p">(</span><span class="n">casadi_int</span> <span class="n">ind</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">fname_name_out</span><span class="p">(</span><span class="n">casadi_int</span> <span class="n">ind</span><span class="p">);</span>
</pre></div>
</div>
<p>The functions <code class="docutils literal notranslate"><span class="pre">fname_name_in</span></code> and <code class="docutils literal notranslate"><span class="pre">fname_name_out</span></code> return the name
of a particular input or output. They take the index of the input or output,
starting with index 0, and return a <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char*</span></code> with the name as a
null-terminated C string. Upon failure, these functions will return a null
pointer.</p>
</div>
<div class="section" id="sparsity-patterns-of-inputs-and-outputs">
<h4>5.3.4. Sparsity patterns of inputs and outputs<a class="headerlink" href="#sparsity-patterns-of-inputs-and-outputs" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">casadi_int</span><span class="o">*</span> <span class="nf">fname_sparsity_in</span><span class="p">(</span><span class="n">casadi_int</span> <span class="n">ind</span><span class="p">);</span>
<span class="k">const</span> <span class="n">casadi_int</span><span class="o">*</span> <span class="nf">fname_sparsity_out</span><span class="p">(</span><span class="n">casadi_int</span> <span class="n">ind</span><span class="p">);</span>
</pre></div>
</div>
<p>The sparsity pattern for a given input or output is obtained by calling
<code class="docutils literal notranslate"><span class="pre">fname_sparsity_in</span></code> and <code class="docutils literal notranslate"><span class="pre">fname_sparsity_out</span></code>, respectively.
These functions take the input or output index and return a pointer to a field
of constant integers (<code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">casadi_int*</span></code>). This is a compact representation
of the <em>compressed column storage</em> (CCS) format that CasADi uses,
cf. <a class="reference internal" href="index.html#sec-sparsity-class"><span class="std std-numref">Section 3.5</span></a>.
The integer field pointed to is structured as follows:</p>
<ul class="simple">
<li>The first two entries are the number of rows and columns, respectively. In the following referred to as <code class="docutils literal notranslate"><span class="pre">nrow</span></code> and <code class="docutils literal notranslate"><span class="pre">ncol</span></code>.</li>
<li>If the third entry is <code class="docutils literal notranslate"><span class="pre">1</span></code>, the pattern is dense and any remaining entries are discarded.</li>
<li>If the third entry is <code class="docutils literal notranslate"><span class="pre">0</span></code>, that entry plus subsequent <code class="docutils literal notranslate"><span class="pre">ncol</span></code> entries form the nonzero offsets for each column, <code class="docutils literal notranslate"><span class="pre">colind</span></code> in the following. E.g. column <span class="math notranslate nohighlight">\(i\)</span> will consist of the nonzero indices ranging from <code class="docutils literal notranslate"><span class="pre">colind[i]</span></code> to <code class="docutils literal notranslate"><span class="pre">colind[i+1]</span></code>. The last entry, <code class="docutils literal notranslate"><span class="pre">colind[ncol]</span></code>, will be equal to the number of nonzeros, <code class="docutils literal notranslate"><span class="pre">nnz</span></code>.</li>
<li>Finally, <em>if</em> the sparsity pattern is <em>not dense</em>, i.e. if <code class="docutils literal notranslate"><span class="pre">nnz</span></code> <span class="math notranslate nohighlight">\(\ne\)</span> <code class="docutils literal notranslate"><span class="pre">nrow</span></code> * <code class="docutils literal notranslate"><span class="pre">ncol</span></code>, then the last <code class="docutils literal notranslate"><span class="pre">nnz</span></code> entries will contain the row indices.</li>
</ul>
<p>Upon failure, these functions will return a null pointer.</p>
</div>
<div class="section" id="memory-objects">
<h4>5.3.5. Memory objects<a class="headerlink" href="#memory-objects" title="Permalink to this headline">¶</a></h4>
<p>A function may contain some mutable memory, e.g. for caching the latest
factorization or keeping track of evaluation statistics. When multiple functions
need to call the same function without conflicting, they each need to work with
a different memory object. This is especially important for evaluation in
parallel on a shared memory architecture, in which case each thread should access
a different memory object.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="o">*</span> <span class="nf">fname_alloc_mem</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>Allocates a memory object which will be passed to the numerical evaluation.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">fname_init_mem</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">mem</span><span class="p">);</span>
</pre></div>
</div>
<p>(Re)initializes a memory object. Returns 0 upon successful return;</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">fname_free_mem</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">mem</span><span class="p">);</span>
</pre></div>
</div>
<p>Frees a memory object. Returns 0 upon successful return;</p>
</div>
<div class="section" id="work-vectors">
<h4>5.3.6. Work vectors<a class="headerlink" href="#work-vectors" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">fname_work</span><span class="p">(</span><span class="n">casadi_int</span><span class="o">*</span> <span class="n">sz_arg</span><span class="p">,</span> <span class="n">casadi_int</span><span class="o">*</span> <span class="n">sz_res</span><span class="p">,</span> <span class="n">casadi_int</span><span class="o">*</span> <span class="n">sz_iw</span><span class="p">,</span> <span class="n">casadi_int</span><span class="o">*</span> <span class="n">sz_w</span><span class="p">);</span>
</pre></div>
</div>
<p>To allow the evaluation to be performed efficiently with a small memory
footprint, the user is expected to pass four work arrays. The function
<code class="docutils literal notranslate"><span class="pre">fname_work</span></code> returns the length of these arrays, which have entries
of type <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">double*</span></code>, <code class="docutils literal notranslate"><span class="pre">double*</span></code>, <code class="docutils literal notranslate"><span class="pre">casadi_int</span></code> and <code class="docutils literal notranslate"><span class="pre">double</span></code>,
respectively.</p>
<p>The return value of the function is nonzero upon failure.</p>
</div>
<div class="section" id="numerical-evaluation">
<h4>5.3.7. Numerical evaluation<a class="headerlink" href="#numerical-evaluation" title="Permalink to this headline">¶</a></h4>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">fname</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="o">**</span> <span class="n">arg</span><span class="p">,</span> <span class="kt">double</span><span class="o">**</span> <span class="n">res</span><span class="p">,</span>
          <span class="n">casadi_int</span><span class="o">*</span> <span class="n">iw</span><span class="p">,</span> <span class="kt">double</span><span class="o">*</span> <span class="n">w</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">mem</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, the function <code class="docutils literal notranslate"><span class="pre">fname</span></code>, performs the actual evaluation. It takes
as input arguments the four work vectors and a memory object created using <code class="docutils literal notranslate"><span class="pre">fname_alloc_mem</span></code>
(or NULL if absent).
The length of the work vectors must be at least the lengths provided
by the <code class="docutils literal notranslate"><span class="pre">fname_work</span></code> command and the index of the memory object must be strictly
smaller than the value returned by <code class="docutils literal notranslate"><span class="pre">fname_n_mem</span></code>.</p>
<p>The nonzeros of the function inputs are pointed to by the
first entries of the <code class="docutils literal notranslate"><span class="pre">arg</span></code> work vector and are unchanged by the evaluation.
Similarly, the output nonzeros are pointed to by the first entries of the
<code class="docutils literal notranslate"><span class="pre">res</span></code> work vector and are also unchanged (i.e. the pointers are unchanged,
not the actual values).</p>
<p>The return value of the function is nonzero upon failure.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>An exception is when code is generated for a function that in turn contains calls to external functions.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-custom"></span><div class="section" id="user-defined-function-objects">
<span id="sec-user-defined"></span><h2>6. User-defined function objects<a class="headerlink" href="#user-defined-function-objects" title="Permalink to this headline">¶</a></h2>
<p>There are situations when rewriting user-functions using CasADi symbolics is not
possible or practical. To tackle this, CasADi provides a number of ways to
embed a call to a “black box” function defined in the language CasADi is being
used from (C++, MATLAB or Python) or in C.
That being said, the recommendation is always to try to avoid this when possible,
even if it means investing a lot of time reimplementing existing code.
Functions defined using CasADi symbolics are almost always more
efficient, especially when derivative calculation is involved, since a lot more
structure can typically be exploited.</p>
<p>Depending on the circumstances, the user can implement custom <code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code>
objects in a number of different ways, which will be elaborated on in the following sections:</p>
<ul class="simple">
<li>Subclassing <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionInternal</span></code>: <a class="reference internal" href="#sec-function-internal"><span class="std std-numref">Section 6.1</span></a></li>
<li>Subclassing <code class="xref py py-class docutils literal notranslate"><span class="pre">Callback</span></code>: <a class="reference internal" href="#sec-callback"><span class="std std-numref">Section 6.2</span></a></li>
<li>Importing a function with <code class="docutils literal notranslate"><span class="pre">external</span></code>: <a class="reference internal" href="#sec-external"><span class="std std-numref">Section 6.3</span></a></li>
<li>Just-in-time compile a C language string: <a class="reference internal" href="#sec-jit-function"><span class="std std-numref">Section 6.4</span></a></li>
<li>Replace the function call with a lookup table: <a class="reference internal" href="#sec-lookup"><span class="std std-numref">Section 6.5</span></a></li>
</ul>
<div class="section" id="subclassing-functioninternal">
<span id="sec-function-internal"></span><h3>6.1. Subclassing <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionInternal</span></code><a class="headerlink" href="#subclassing-functioninternal" title="Permalink to this headline">¶</a></h3>
<p>All function objects presented in <a class="reference internal" href="index.html#sec-function"><span class="std std-numref">Chapter 4</span></a> are implemented
in CasADi as C++ classes inheriting from the <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionInternal</span></code> abstract
base class. In principle, a user with familiarity with C++ programming, can
implement a class inheriting from <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionInternal</span></code>,
overloading the virtual methods of this class. The best reference for doing so
is the C++ API documentation, choosing “switch to internal” to expose the internal
API.</p>
<p>Since <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionInternal</span></code> is not considered part of the stable, public API,
we advice against this in general, unless the plan is to contribution to CasADi’s
source.</p>
</div>
<div class="section" id="subclassing-callback">
<span id="sec-callback"></span><h3>6.2. Subclassing <code class="xref py py-class docutils literal notranslate"><span class="pre">Callback</span></code><a class="headerlink" href="#subclassing-callback" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Callback</span></code> class provides a public API to <code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionInternal</span></code>
and inheriting from this class has the same effect as inheriting directly from
<code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionInternal</span></code>. Thanks to <em>cross-language polymorphism</em>, it
is possible to implement the exposed methods of <code class="xref py py-class docutils literal notranslate"><span class="pre">Callback</span></code> from either
Python, MATLAB/Octave or C++.</p>
<p>The derived class consists of the following parts:</p>
<ul class="simple">
<li>A constructor or a static function replacing the constructor</li>
<li>A number of <em>virtual</em> functions, all optional, that can be overloaded in order to get the desired behavior. This includes the number of inputs and outputs using <code class="docutils literal notranslate"><span class="pre">get_n_in</span></code> and <code class="docutils literal notranslate"><span class="pre">get_n_out</span></code>, their names using <code class="docutils literal notranslate"><span class="pre">get_name_in</span></code> and <code class="docutils literal notranslate"><span class="pre">get_name_out</span></code> and their sparsity patterns <code class="docutils literal notranslate"><span class="pre">get_sparsity_in</span></code> and <code class="docutils literal notranslate"><span class="pre">get_sparsity_out</span></code>.</li>
<li>An optional <code class="docutils literal notranslate"><span class="pre">init</span></code> function called duing the object construction.</li>
<li>A function for numerical evaluation.</li>
<li>Optional functions for derivatives. You can choose to supply a full Jacobian (<code class="docutils literal notranslate"><span class="pre">has_jacobian</span></code>, <code class="docutils literal notranslate"><span class="pre">get_jacobian</span></code>), or choose to supply forward/reverse sensitivities (<code class="docutils literal notranslate"><span class="pre">has_forward</span></code>, <code class="docutils literal notranslate"><span class="pre">get_forward</span></code>,  <code class="docutils literal notranslate"><span class="pre">has_reverse</span></code>, <code class="docutils literal notranslate"><span class="pre">get_reverse</span></code>).</li>
</ul>
<p>For a complete list of functions, see the C++ API documentation for <code class="xref py py-class docutils literal notranslate"><span class="pre">Callback</span></code>.</p>
<p>The usage from the different languages are described in the following.</p>
<div class="section" id="python">
<h4>6.2.1. Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCallback</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="p">{}):</span>
    <span class="n">Callback</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>

  <span class="c1"># Number of inputs and outputs</span>
  <span class="k">def</span> <span class="nf">get_n_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span>
  <span class="k">def</span> <span class="nf">get_n_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span>

  <span class="c1"># Initialize the object</span>
  <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="k">print</span><span class="p">(</span><span class="s1">&#39;initializing object&#39;</span><span class="p">)</span>

  <span class="c1"># Evaluate numerically</span>
  <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
</pre></div>
</div>
<p>The implementation should include a constructor, which should begin with a call to
the base class constructor using
<code class="docutils literal notranslate"><span class="pre">Callback.__init__(self)</span></code> and end with a call to
initialize object construction using <code class="docutils literal notranslate"><span class="pre">self.construct(name,</span> <span class="pre">opts)</span></code>.</p>
<p>This function can be used as any built-in CasADi function with the important
caveat that when embedded in graphs, the ownership of the class will <em>not</em>
be shared between all references. So it is important that the user does not
allow the Python class to go out of scope while it is still needed in
calculations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the function</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">MyCallback</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>initializing object
0.841471
f(x){0}
</pre></div>
</div>
</div>
<div class="section" id="matlab">
<h4>6.2.2. MATLAB<a class="headerlink" href="#matlab" title="Permalink to this headline">¶</a></h4>
<p>In MATLAB, a custom function class can be defined as follows, in a file
<code class="docutils literal notranslate"><span class="pre">MyCallback.m</span></code>:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span> <span class="n">MyCallback</span> <span class="o">&lt;</span> <span class="n">casadi</span><span class="p">.</span><span class="n">Callback</span>
  <span class="k">properties</span>
    <span class="n">d</span>
  <span class="k">end</span>
  <span class="k">methods</span>
<span class="k">    function</span><span class="w"> </span>self <span class="p">=</span><span class="w"> </span><span class="nf">MyCallback</span><span class="p">(</span>name, d<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">self</span><span class="p">@</span><span class="n">casadi</span><span class="p">.</span><span class="n">Callback</span><span class="p">();</span>
      <span class="n">self</span><span class="p">.</span><span class="n">d</span> <span class="p">=</span> <span class="n">d</span><span class="p">;</span>
      <span class="n">construct</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
    <span class="k">end</span>

    <span class="c">% Number of inputs and outputs</span>
<span class="k">    function</span><span class="w"> </span>v<span class="p">=</span><span class="nf">get_n_in</span><span class="p">(</span>self<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">v</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">    function</span><span class="w"> </span>v<span class="p">=</span><span class="nf">get_n_out</span><span class="p">(</span>self<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">v</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>

    <span class="c">% Initialize the object</span>
<span class="k">    function</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span>self<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;initializing object&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c">% Evaluate numerically</span>
<span class="k">    function</span><span class="w"> </span>arg <span class="p">=</span><span class="w"> </span><span class="nf">eval</span><span class="p">(</span>self, arg<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">x</span> <span class="p">=</span> <span class="nb">arg</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
      <span class="n">f</span> <span class="p">=</span> <span class="nb">sin</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">x</span><span class="p">);</span>
      <span class="nb">arg</span> <span class="p">=</span> <span class="p">{</span><span class="n">f</span><span class="p">};</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This function can be used as any built-in CasADi function, but as for Python,
the ownership of the class will <em>not</em> be shared between all references.
So the user must not allow a class instance to get deleted while it is still
in use, e.g. by making it <code class="docutils literal notranslate"><span class="pre">persistent</span></code>.</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">% Use the function</span>
<span class="n">f</span> <span class="p">=</span> <span class="n">MyCallback</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
<span class="n">res</span> <span class="p">=</span> <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

<span class="n">x</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">);</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="c">
<h4>6.2.3. C++<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h4>
<p>In C++, the syntax is as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;casadi/casadi.hpp&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">casadi</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">MyCallback</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Callback</span> <span class="p">{</span>
  <span class="c1">// Data members</span>
  <span class="kt">double</span> <span class="n">d</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor</span>
  <span class="n">MyCallback</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="kt">double</span> <span class="n">d</span><span class="p">,</span>
             <span class="k">const</span> <span class="n">Dict</span><span class="o">&amp;</span> <span class="n">opts</span><span class="o">=</span><span class="n">Dict</span><span class="p">())</span> <span class="o">:</span> <span class="n">d</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">construct</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">opts</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Destructor</span>
  <span class="o">~</span><span class="n">MyCallback</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>

  <span class="c1">// Number of inputs and outputs</span>
  <span class="n">casadi_int</span> <span class="n">get_n_in</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;}</span>
  <span class="n">casadi_int</span> <span class="n">get_n_out</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;}</span>

  <span class="c1">// Initialize the object</span>
  <span class="kt">void</span> <span class="n">init</span> <span class="k">override</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;initializing object&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Evaluate numerically</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">DM</span><span class="o">&gt;</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">DM</span><span class="o">&gt;&amp;</span> <span class="n">arg</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">DM</span> <span class="n">x</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">DM</span> <span class="n">f</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>A class created this way can be used as any other <code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code> instance,
but with the important difference that the user is responsible to managing
the memory of this class.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">MyCallback</span> <span class="n">f</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">DM</span><span class="o">&gt;</span> <span class="n">arg</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">};</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">DM</span><span class="o">&gt;</span> <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="importing-a-function-with-external">
<span id="sec-external"></span><h3>6.3. Importing a function with <code class="docutils literal notranslate"><span class="pre">external</span></code><a class="headerlink" href="#importing-a-function-with-external" title="Permalink to this headline">¶</a></h3>
<p>The basic usage of CasADi’s <code class="docutils literal notranslate"><span class="pre">external</span></code> function was demonstrated in
<a class="reference internal" href="index.html#sec-using-codegen"><span class="std std-numref">Section 5.2</span></a> in the context of using autogenerated code. The
same function can also be used for importing a user-defined function, as long as
it also uses the C API described in <a class="reference internal" href="index.html#sec-c-api"><span class="std std-numref">Section 5.3</span></a>.</p>
<p>The following sections expands on this.</p>
<div class="section" id="default-functions">
<h4>6.3.1. Default functions<a class="headerlink" href="#default-functions" title="Permalink to this headline">¶</a></h4>
<p>It is usually <em>not</em> necessary to define all the functions defined in
<a class="reference internal" href="index.html#sec-c-api"><span class="std std-numref">Section 5.3</span></a>. If <code class="docutils literal notranslate"><span class="pre">fname_incref</span></code> and <code class="docutils literal notranslate"><span class="pre">fname_decref</span></code>
are absent, it is assumed that no memory management is needed. If no
names of inputs and outputs are provided, they will be given default names.
Sparsity patterns are in general assumed to be scalar by default, unless the
function corresponds to a derivative of another function (see below), in which
case they are assumed to be dense and of the correct dimension.</p>
<p>Furthermore, work vectors are assumed not to be needed if <code class="docutils literal notranslate"><span class="pre">fname_work</span></code> has
not been implemented.</p>
</div>
<div class="section" id="meta-information-as-comments">
<h4>6.3.2. Meta information as comments<a class="headerlink" href="#meta-information-as-comments" title="Permalink to this headline">¶</a></h4>
<p>If you rely on CasADi’s just-in-time compiler, you can provide meta information
as a comment in the C code instead of implementing the actual callback function.</p>
<p>The structure of such meta information should be as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*CASADIMETA</span>
<span class="cm">:fname_N_IN 1</span>
<span class="cm">:fname_N_OUT 2</span>
<span class="cm">:fname_NAME_IN[0] x</span>
<span class="cm">:fname_NAME_OUT[0] r</span>
<span class="cm">:fname_NAME_OUT[1] s</span>
<span class="cm">:fname_SPARSITY_IN[0] 2 1 0 2</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="derivatives">
<h4>6.3.3. Derivatives<a class="headerlink" href="#derivatives" title="Permalink to this headline">¶</a></h4>
<p>The external function can be made differentiable by providing functions for
calculating derivatives. During derivative calculations, CasADi will look for
symbols in the same file/shared library that follows a certain
<em>naming convention</em>. For example, you can specify a Jacobian for all the
outputs with respect to all inputs for a function named <code class="docutils literal notranslate"><span class="pre">fname</span></code> by
implementing a function named <code class="docutils literal notranslate"><span class="pre">jac_fname</span></code>. Similary, you can specify
a function for calculating one forward directional derivative by providing a
function named <code class="docutils literal notranslate"><span class="pre">fwd1_fname</span></code>, where 1 can be replaced by 2, 4, 8, 16,
32 or 64 for calculating multiple forward directional derivatives at once.
For reverse mode directional derivatives, replace <code class="docutils literal notranslate"><span class="pre">fwd</span></code> with <code class="docutils literal notranslate"><span class="pre">adj</span></code>.</p>
<p>This is an experimental feature.</p>
</div>
</div>
<div class="section" id="just-in-time-compile-a-c-language-string">
<span id="sec-jit-function"></span><h3>6.4. Just-in-time compile a C language string<a class="headerlink" href="#just-in-time-compile-a-c-language-string" title="Permalink to this headline">¶</a></h3>
<p>In the previous section we showed how to specify a C file with functions for numerical
evaluation and meta information. As was shown, this file can be just-in-time
compiled by CasADi’s interface to Clang. There exists a shorthand for this approach,
where the user simply specifies the source code as a C language string.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span>\
<span class="s1">&#39;r[0] = x[0];&#39;</span><span class="o">+</span>\
<span class="s1">&#39;while (r[0]&lt;s[0]) {&#39;</span><span class="o">+</span>\
<span class="s1">&#39; r[0] *= r[0];&#39;</span><span class="o">+</span>\
<span class="s1">&#39;}&#39;</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">body</span><span class="p">,</span>\
      <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">],[</span><span class="s1">&#39;r&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(x,s)-&gt;(r) JitFunction
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="p">=[...</span>
<span class="s">&#39;r[0] = x[0];&#39;</span><span class="p">,...</span>
<span class="s">&#39;while (r[0]&lt;s[0]) {&#39;</span><span class="p">,...</span>
<span class="s">&#39; r[0] *= r[0];&#39;</span><span class="p">,...</span>
<span class="s">&#39;}&#39;</span><span class="p">];</span>

<span class="n">f</span> <span class="p">=</span> <span class="n">Function</span><span class="p">.</span><span class="n">jit</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">body</span><span class="p">,...</span>
      <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;s&#39;</span><span class="p">},{</span><span class="s">&#39;r&#39;</span><span class="p">});</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(x,s)-&gt;(r) JitFunction
</pre></div>
</div>
</div>
</div>
<p>These four arguments of <code class="docutils literal notranslate"><span class="pre">Function.jit</span></code> are mandatory:
The function name, the C source as a string and the names of inputs and outputs.
In the C source, the input/output names correspond to arrays of type <code class="docutils literal notranslate"><span class="pre">casadi_real_t</span></code>
containing the nonzero elements of the function inputs and outputs. By default,
all inputs and outputs are scalars (i.e. 1-by-1 and dense). To specify a different sparsity pattern, provide two additional function arguments containing vectors/lists
of the sparsity patterns:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sp</span> <span class="o">=</span> <span class="n">Sparsity</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Function</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">body</span><span class="p">,</span>\
     <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">],</span>\
     <span class="p">[</span><span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">],</span> <span class="p">[</span><span class="n">sp</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(x,s)-&gt;(r) JitFunction
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">sp</span> <span class="p">=</span> <span class="n">Sparsity</span><span class="p">.</span><span class="n">scalar</span><span class="p">();</span>
<span class="n">f</span> <span class="p">=</span> <span class="n">Function</span><span class="p">.</span><span class="n">jit</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">body</span><span class="p">,...</span>
     <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;s&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;r&#39;</span><span class="p">},...</span>
     <span class="p">{</span><span class="n">sp</span><span class="p">,</span><span class="n">sp</span><span class="p">},</span> <span class="p">{</span><span class="n">sp</span><span class="p">});</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>f:(x,s)-&gt;(r) JitFunction
</pre></div>
</div>
</div>
</div>
<p>Both variants accept an optional 5th (or 7th) argument in the form of an
options dictionary.</p>
</div>
<div class="section" id="using-lookup-tables">
<span id="sec-lookup"></span><h3>6.5. Using lookup-tables<a class="headerlink" href="#using-lookup-tables" title="Permalink to this headline">¶</a></h3>
<p>Lookup-tables can be created using CasADi’s <code class="docutils literal notranslate"><span class="pre">interpolant</span></code> function. Different interpolating schemes are implemented as <em>plugins</em>, similar to <code class="docutils literal notranslate"><span class="pre">nlpsol</span></code> or <code class="docutils literal notranslate"><span class="pre">integrator</span></code> objects. In addition to the identifier name and plugin, the <code class="docutils literal notranslate"><span class="pre">interpolant</span></code> function expects a set of grid points with the corresponding numerical values.</p>
<p>The result of an <code class="docutils literal notranslate"><span class="pre">interpolant</span></code> call is a CasADi Function object that is differentiable, and can be embedded into CasADi computational graphs by calling with MX arguments. Furthermore, C code generation is fully supported for such graphs.</p>
<p>Currently, two plugins exist for <code class="docutils literal notranslate"><span class="pre">interpolant</span></code>: <code class="docutils literal notranslate"><span class="pre">'linear'</span></code> and <code class="docutils literal notranslate"><span class="pre">'bspline'</span></code>. They are intended to behave simiarly to MATLAB/Octave’s <code class="docutils literal notranslate"><span class="pre">interpn</span></code> with the method set to <code class="docutils literal notranslate"><span class="pre">'linear'</span></code> or <code class="docutils literal notranslate"><span class="pre">'spline'</span></code> – corresponding to a multilinear interpolation and a (by default cubic) spline interpolation with
not-a-knot boundary conditions.</p>
<p>In the case of <code class="docutils literal notranslate"><span class="pre">bspline</span></code>, coefficients will be sought at construction time that fit the provided data. Alternatively, you may also use the more low-level <code class="docutils literal notranslate"><span class="pre">Function.bspline</span></code> to supply the coefficients yourself. The default degree of the bspline is 3 in each dimension. You may deviate from this default by passing a <code class="docutils literal notranslate"><span class="pre">degree</span></code> option.</p>
<p>We will walk through the syntax of <code class="docutils literal notranslate"><span class="pre">interpolant</span></code> for the 1D and 2D versions, but the syntax in fact generalizes to an arbitrary number of dimensions.</p>
<div class="section" id="d-lookup-tables">
<h4>6.5.1. 1D lookup tables<a class="headerlink" href="#d-lookup-tables" title="Permalink to this headline">¶</a></h4>
<p>A 1D spline fit can be done in CasADi/Python as follows, compared with the corresponding method in SciPy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">casadi</span> <span class="kn">as</span> <span class="nn">ca</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">xgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">lut</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">interpolant</span><span class="p">(</span><span class="s1">&#39;LUT&#39;</span><span class="p">,</span><span class="s1">&#39;bspline&#39;</span><span class="p">,[</span><span class="n">xgrid</span><span class="p">],</span><span class="n">V</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">lut</span><span class="p">(</span><span class="mf">2.5</span><span class="p">))</span>
<span class="c1"># Using SciPy</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="kn">as</span> <span class="nn">ip</span>
<span class="n">interp</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="mf">2.5</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>-1.35
-1.3500000000000005
</pre></div>
</div>
<p>In MATLAB/Octave, the corresponding code reads:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">xgrid</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">;</span>
<span class="n">V</span> <span class="p">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">2</span> <span class="o">-</span><span class="mi">3</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">];</span>
<span class="n">lut</span> <span class="p">=</span> <span class="n">casadi</span><span class="p">.</span><span class="n">interpolant</span><span class="p">(</span><span class="s">&#39;LUT&#39;</span><span class="p">,</span><span class="s">&#39;bspline&#39;</span><span class="p">,{</span><span class="n">xgrid</span><span class="p">},</span><span class="n">V</span><span class="p">);</span>
<span class="n">lut</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
<span class="c">% Using MATLAB/Octave builtin</span>
<span class="n">interp1</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="s">&#39;spline&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =

-1.35

ans = -1.3500
</pre></div>
</div>
<p>Note in particular that the <code class="docutils literal notranslate"><span class="pre">grid</span></code> and <code class="docutils literal notranslate"><span class="pre">values</span></code> arguments to <code class="docutils literal notranslate"><span class="pre">interpolant</span></code> must be numerical in nature.</p>
</div>
<div class="section" id="id1">
<h4>6.5.2. 2D lookup tables<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>In two dimensions, we get the following in Python, also compared to SciPy for reference:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ygrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span><span class="n">ygrid</span><span class="p">,</span><span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span> <span class="mi">1</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">/</span><span class="n">R</span>
<span class="n">data_flat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">lut</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">interpolant</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;bspline&#39;</span><span class="p">,[</span><span class="n">xgrid</span><span class="p">,</span><span class="n">ygrid</span><span class="p">],</span><span class="n">data_flat</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">lut</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1"># Using Scipy</span>

<span class="n">interp</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">interp</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>0.245507
0.24550661674668917
</pre></div>
</div>
<p>or, in MATLAB/Octave compared to the built-in functions:</p>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">xgrid</span> <span class="p">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">;</span>
<span class="n">ygrid</span> <span class="p">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">;</span>
<span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]</span> <span class="p">=</span> <span class="nb">ndgrid</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">);</span>
<span class="n">R</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">X</span><span class="o">.^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">.^</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">V</span> <span class="p">=</span> <span class="nb">sin</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">./</span><span class="n">R</span><span class="p">;</span>
<span class="n">lut</span> <span class="p">=</span> <span class="n">interpolant</span><span class="p">(</span><span class="s">&#39;LUT&#39;</span><span class="p">,</span><span class="s">&#39;bspline&#39;</span><span class="p">,{</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span><span class="p">},</span><span class="n">V</span><span class="p">(:));</span>
<span class="n">lut</span><span class="p">([</span><span class="mf">0.5</span> <span class="mi">1</span><span class="p">])</span>
<span class="c">% Using Matlab builtin</span>
<span class="nb">interpn</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;spline&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>ans =

0.245507

ans =  0.24551
</pre></div>
</div>
<p>In particular note how the <code class="docutils literal notranslate"><span class="pre">values</span></code> argument had to be flatten to a one-dimensional array.</p>
</div>
</div>
<div class="section" id="derivative-calculation-using-finite-differences">
<span id="sec-fd"></span><h3>6.6. Derivative calculation using finite differences<a class="headerlink" href="#derivative-calculation-using-finite-differences" title="Permalink to this headline">¶</a></h3>
<p>CasADi 3.3 introduced support for finite difference calculation for all function
objects, in particular including external functions defined as outlined in <a class="reference internal" href="#sec-callback"><span class="std std-numref">Section 6.2</span></a>, <a class="reference internal" href="#sec-external"><span class="std std-numref">Section 6.3</span></a> or <a class="reference internal" href="#sec-jit-function"><span class="std std-numref">Section 6.4</span></a>
(for lookup tables, <a class="reference internal" href="#sec-lookup"><span class="std std-numref">Section 6.5</span></a>, analytical derivatives are available).</p>
<p>Finite difference derivative are disabled by default, with the exception of <code class="docutils literal notranslate"><span class="pre">Function.jit</span></code>, and to enable it, you must set the option <code class="docutils literal notranslate"><span class="pre">'enable_fd'</span></code>
to <code class="docutils literal notranslate"><span class="pre">True</span></code>/<code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">external</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;./gen.so&#39;</span><span class="p">,</span>\
   <span class="nb">dict</span><span class="p">(</span><span class="n">enable_fd</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">)</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,[</span><span class="n">x</span><span class="p">],[</span><span class="n">e</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="p">=</span> <span class="n">external</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;./gen.so&#39;</span><span class="p">,...</span>
    <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;enable_fd&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">));</span>

<span class="nb">e</span> <span class="p">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">);</span>
<span class="n">D</span> <span class="p">=</span> <span class="n">Function</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">},{</span><span class="nb">e</span><span class="p">});</span>
<span class="nb">disp</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
<p>cf. <a class="reference internal" href="index.html#sec-codegen-syntax"><span class="std std-numref">Section 5.1</span></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">'enable_fd'</span></code> options enables CasADi to use finite differences, <em>if</em>
analytical derivatives are not available. To force CasADi to use finite differences,
you can set <code class="docutils literal notranslate"><span class="pre">'enable_forward'</span></code>, <code class="docutils literal notranslate"><span class="pre">'enable_reverse'</span></code> and <code class="docutils literal notranslate"><span class="pre">'enable_jacobian'</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>/<code class="docutils literal notranslate"><span class="pre">false</span></code>, corresponding to the three types of analytical derivative information that CasADi works with.</p>
<p>The default method is central differences with a step size determined by estimates of roundoff errors and truncation errors of the function. You can change the method by setting the option <code class="docutils literal notranslate"><span class="pre">'fd_method'</span></code> to <code class="docutils literal notranslate"><span class="pre">'forward'</span></code> (corresponding to first order forward differences), <code class="docutils literal notranslate"><span class="pre">'backward'</span></code> (corresponding to first order backward differences) and <code class="docutils literal notranslate"><span class="pre">'smoothing'</span></code> for a second-order accurate discontinuity avoiding scheme, suitable when derivatives need to be calculated at the edges of a domain. Additional algorithmic options for the finite differences are available by setting <code class="docutils literal notranslate"><span class="pre">'fd_options'</span></code> option.</p>
</div>
</div>
<span id="document-daebuilder"></span><div class="section" id="the-daebuilder-class">
<h2>7. The <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> class<a class="headerlink" href="#the-daebuilder-class" title="Permalink to this headline">¶</a></h2>
<p id="sec-daebuilder">The <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> class in CasADi is an auxiliary class intended to
facilitate the modeling complex dynamical systems for later use with optimal
control algorithms. This class can be seen as a low-level alternative to
a physical modeling language such as Modelica (cf. <a class="reference internal" href="#sec-modelica"><span class="std std-numref">Section 7.3</span></a>),
while still being higher level than working directly with CasADi symbolic
expressions. Another important usage it to provide an interface to
physical modeling languages and software and be a building blocks for
developing domain specific modeling environments.</p>
<p>Using the <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> class consists of the following steps:</p>
<ul class="simple">
<li>Step-by-step constructing a structured system of differential-algebraic equations (DAE) or, alternatively, importing an existing model from Modelica</li>
<li>Symbolically reformulate the DAE</li>
<li>Generate a chosen set of CasADi functions to be used for e.g. optimal control or C code generation</li>
</ul>
<p>In the following sections, we describe the mathematical formulation of the class
and its intended usage.</p>
<div class="section" id="mathematical-formulation">
<span id="sec-daebuilder-io"></span><h3>7.1. Mathematical formulation<a class="headerlink" href="#mathematical-formulation" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> class uses a relatively rich problem formulation that
consists of a set of input expressions and a set of output expressions, each
defined by a string identifier. The choice of expressions was inspired by the
<em>functional mock-up interface</em> (FMI) version 2.0
<a class="footnote-reference" href="#f3" id="id1">[1]</a></p>
<div class="section" id="input-expressions">
<h4>7.1.1. Input expressions<a class="headerlink" href="#input-expressions" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>‘t’</dt>
<dd>Time <span class="math notranslate nohighlight">\(t\)</span></dd>
<dt>‘c’</dt>
<dd>Named constants <span class="math notranslate nohighlight">\(c\)</span></dd>
<dt>‘p’</dt>
<dd>Independent parameters <span class="math notranslate nohighlight">\(p\)</span></dd>
<dt>‘d’</dt>
<dd>Dependent parameters <span class="math notranslate nohighlight">\(d\)</span>, depends only on <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(c\)</span> and,
acyclically, on other <span class="math notranslate nohighlight">\(d\)</span></dd>
<dt>‘x’</dt>
<dd>Differential state <span class="math notranslate nohighlight">\(x\)</span>, defined by an explicit ODE</dd>
<dt>‘s’</dt>
<dd>Differential state <span class="math notranslate nohighlight">\(s\)</span>, defined by an implicit ODE</dd>
<dt>‘sdot’</dt>
<dd>Time derivatives implicitly defined differential state <span class="math notranslate nohighlight">\(\dot{s}\)</span></dd>
<dt>‘z’</dt>
<dd>Algebraic variable, defined by an algebraic equation</dd>
<dt>‘q’</dt>
<dd>Quadrature state <span class="math notranslate nohighlight">\(q\)</span>. A differential state that may not appear in
the right-hand-side and hence can be calculated by quadrature formulas.</dd>
<dt>‘w’</dt>
<dd>Local variables <span class="math notranslate nohighlight">\(w\)</span>. Calculated from time and time dependent
variables. They may also depend, acyclically, on other <span class="math notranslate nohighlight">\(w\)</span>.</dd>
<dt>‘y’</dt>
<dd>Output variables <span class="math notranslate nohighlight">\(y\)</span></dd>
</dl>
</div>
<div class="section" id="output-expressions">
<h4>7.1.2. Output expressions<a class="headerlink" href="#output-expressions" title="Permalink to this headline">¶</a></h4>
<p>The above input expressions are used to define the following output expressions:</p>
<dl class="docutils">
<dt>‘ddef’</dt>
<dd>Explicit expression for calculating <span class="math notranslate nohighlight">\(d\)</span></dd>
<dt>‘wdef’</dt>
<dd>Explicit expression for calculating <span class="math notranslate nohighlight">\(w\)</span></dd>
<dt>‘ode’</dt>
<dd><dl class="first last docutils">
<dt>The explicit ODE right-hand-side:</dt>
<dd><span class="math notranslate nohighlight">\(\dot{x} = \text{ode}(t,w,x,s,z,u,p,d)\)</span></dd>
</dl>
</dd>
<dt>‘dae’</dt>
<dd>The implicit ODE right-hand-side:
<span class="math notranslate nohighlight">\(\text{dae}(t,w,x,s,z,u,p,d,\dot{s}) =0\)</span></dd>
<dt>‘alg’</dt>
<dd><dl class="first last docutils">
<dt>The algebraic equations:</dt>
<dd><span class="math notranslate nohighlight">\(\text{alg}(t,w,x,s,z,u,p,d) = 0\)</span></dd>
</dl>
</dd>
<dt>‘quad’</dt>
<dd>The quadrature equations:
<span class="math notranslate nohighlight">\(\dot{q} = \text{quad}(t,w,x,s,z,u,p,d)\)</span></dd>
<dt>‘ydef’</dt>
<dd>Explicit expressions for calculating <span class="math notranslate nohighlight">\(y\)</span></dd>
</dl>
</div>
</div>
<div class="section" id="constructing-a-daebuilder-instance">
<span id="sec-daebuilder-syntax"></span><h3>7.2. Constructing a <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> instance<a class="headerlink" href="#constructing-a-daebuilder-instance" title="Permalink to this headline">¶</a></h3>
<p>Consider the following simple DAE corresponding to a controlled rocket subject to
quadratic air friction term and gravity, which loses mass as it uses up fuel:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
 \dot{h} &amp;= v,                    \qquad &amp;h(0) = 0 \\
 \dot{v} &amp;= (u - a \, v^2)/m - g, \qquad &amp;v(0) = 0 \\
 \dot{m} &amp;= -b \, u^2,            \qquad &amp;m(0) = 1
\end{aligned}\end{split}\]</div>
<p>where the three states correspond to height, velocity and mass, respectively.
<span class="math notranslate nohighlight">\(u\)</span> is the thrust of the rocket and <span class="math notranslate nohighlight">\((a,b)\)</span> are parameters.</p>
<p>To construct a DAE formulation for this problem, start with an empty
<code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> instance and add the input and output expressions step-by-step
as follows.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dae</span> <span class="o">=</span> <span class="n">DaeBuilder</span><span class="p">()</span>
<span class="c1"># Add input expressions</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">add_p</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">add_p</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">add_u</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">add_x</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">add_x</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">add_x</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="c1"># Add output expressions</span>
<span class="n">hdot</span> <span class="o">=</span> <span class="n">v</span>
<span class="n">vdot</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">m</span><span class="o">-</span><span class="n">g</span>
<span class="n">mdot</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span>
<span class="n">dae</span><span class="o">.</span><span class="n">add_ode</span><span class="p">(</span><span class="s1">&#39;hdot&#39;</span><span class="p">,</span> <span class="n">hdot</span><span class="p">)</span>
<span class="n">dae</span><span class="o">.</span><span class="n">add_ode</span><span class="p">(</span><span class="s1">&#39;vdot&#39;</span><span class="p">,</span> <span class="n">vdot</span><span class="p">)</span>
<span class="n">dae</span><span class="o">.</span><span class="n">add_ode</span><span class="p">(</span><span class="s1">&#39;mdot&#39;</span><span class="p">,</span> <span class="n">mdot</span><span class="p">)</span>
<span class="c1"># Specify initial conditions</span>
<span class="n">dae</span><span class="o">.</span><span class="n">set_start</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dae</span><span class="o">.</span><span class="n">set_start</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">dae</span><span class="o">.</span><span class="n">set_start</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add meta information</span>
<span class="n">dae</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">dae</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
<span class="n">dae</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">dae</span> <span class="p">=</span> <span class="n">DaeBuilder</span><span class="p">;</span>
<span class="c">% Add input expressions</span>
<span class="n">a</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">add_p</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">);</span>
<span class="n">b</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">add_p</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">u</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">add_u</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">);</span>
<span class="n">h</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">add_x</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">);</span>
<span class="n">v</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">add_x</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">);</span>
<span class="n">m</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">add_x</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">);</span>
<span class="c">% Add output expressions</span>
<span class="n">hdot</span> <span class="p">=</span> <span class="n">v</span><span class="p">;</span>
<span class="n">vdot</span> <span class="p">=</span> <span class="p">(</span><span class="n">u</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">v</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">m</span><span class="o">-</span><span class="n">g</span><span class="p">;</span>
<span class="n">mdot</span> <span class="p">=</span> <span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">u</span>^<span class="mi">2</span><span class="p">;</span>
<span class="n">dae</span><span class="p">.</span><span class="n">add_ode</span><span class="p">(</span><span class="s">&#39;hdot&#39;</span><span class="p">,</span> <span class="n">hdot</span><span class="p">);</span>
<span class="n">dae</span><span class="p">.</span><span class="n">add_ode</span><span class="p">(</span><span class="s">&#39;vdot&#39;</span><span class="p">,</span> <span class="n">vdot</span><span class="p">);</span>
<span class="n">dae</span><span class="p">.</span><span class="n">add_ode</span><span class="p">(</span><span class="s">&#39;mdot&#39;</span><span class="p">,</span> <span class="n">mdot</span><span class="p">);</span>
<span class="c">% Specify initial conditions</span>
<span class="n">dae</span><span class="p">.</span><span class="n">set_start</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">dae</span><span class="p">.</span><span class="n">set_start</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">dae</span><span class="p">.</span><span class="n">set_start</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c">% Add meta information</span>
<span class="n">dae</span><span class="p">.</span><span class="n">set_unit</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">,</span><span class="s">&#39;m&#39;</span><span class="p">);</span>
<span class="n">dae</span><span class="p">.</span><span class="n">set_unit</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="s">&#39;m/s&#39;</span><span class="p">);</span>
<span class="n">dae</span><span class="p">.</span><span class="n">set_unit</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span><span class="s">&#39;kg&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Other input and output expressions can be added in an analogous way. For a full
list of functions, see the C++ API documentation for <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code>.</p>
</div>
<div class="section" id="import-of-ocps-from-modelica">
<span id="sec-modelica"></span><h3>7.3. Import of OCPs from Modelica<a class="headerlink" href="#import-of-ocps-from-modelica" title="Permalink to this headline">¶</a></h3>
<p>An alternative to model directly in CasADi, as above, is to use an advanced
physical modeling language such as Modelica to specify the model. For this,
CasADi offers interoperability with the open-source <a class="reference external" href="http://www.jmodelica.org/}">JModelica.org</a> compiler, which
is written specifically with optimal control in mind. Model import from
JModelica.org is possible in two different ways; using the JModelica.org’s
<code class="docutils literal notranslate"><span class="pre">CasadiInterface</span></code> or via <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code>’s
<code class="docutils literal notranslate"><span class="pre">parse_fmi</span></code> command.</p>
<p>We recommend the former approach, since it is being actively maintained and
refer to JModelica.org’s user guide for details on how to extract CasADi
expressions.</p>
<p>In the following, we will outline the legacy approach, using
<code class="docutils literal notranslate"><span class="pre">parse_fmi</span></code>.</p>
<div class="section" id="legacy-import-of-a-modeldescription-xml-file">
<h4>7.3.1. Legacy import of a <code class="docutils literal notranslate"><span class="pre">modelDescription.xml</span></code> file<a class="headerlink" href="#legacy-import-of-a-modeldescription-xml-file" title="Permalink to this headline">¶</a></h4>
<p>To see how to use the Modelica import, look at <a class="reference external" href="https://github.com/casadi/casadi/blob/master/docs/examples/python/modelica/fritzson_application_examples/thermodynamics_example.py">thermodynamics_example.py</a> in CasADi’s example collection.</p>
<p>Assuming that the Modelica/Optimica model <code class="docutils literal notranslate"><span class="pre">ModelicaClass.ModelicaModel</span></code> is defined in the files <code class="docutils literal notranslate"><span class="pre">file1.mo</span></code> and <code class="docutils literal notranslate"><span class="pre">file2.mop</span></code>, the Python compile command is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymodelica</span> <span class="kn">import</span> <span class="n">compile_jmu</span>
<span class="n">jmu_name</span><span class="o">=</span><span class="n">compile_jmu</span><span class="p">(</span><span class="s1">&#39;ModelicaClass.ModelicaModel&#39;</span><span class="p">,</span> \
  <span class="p">[</span><span class="s1">&#39;file1.mo&#39;</span><span class="p">,</span><span class="s1">&#39;file2.mop&#39;</span><span class="p">],</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="s1">&#39;ipopt&#39;</span><span class="p">,</span>\
  <span class="p">{</span><span class="s1">&#39;generate_xml_equations&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s1">&#39;generate_fmi_me_xml&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">})</span>
</pre></div>
</div>
<p>This will generate a <code class="docutils literal notranslate"><span class="pre">jmu</span></code>-file, which is essentially a zip file containing, among other things, the file <code class="docutils literal notranslate"><span class="pre">modelDescription.xml</span></code>. This XML-file contains a symbolic representation of the optimal control problem and can be inspected in a standard XML editor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
<span class="n">sfile</span> <span class="o">=</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">jmu_name</span><span class="s1">&#39;,&#39;</span><span class="sa">r</span><span class="s1">&#39;)</span>
<span class="n">mfile</span> <span class="o">=</span> <span class="n">sfile</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s1">&#39;modelDescription.xml&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Once a <code class="docutils literal notranslate"><span class="pre">modelDescription.xml</span></code> file is available, it can be imported
using the <code class="docutils literal notranslate"><span class="pre">parse_fmi</span></code> command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dae</span> <span class="o">=</span> <span class="n">DaeBuilder</span><span class="p">()</span>
<span class="n">ocp</span><span class="o">.</span><span class="n">parse_fmi</span><span class="p">(</span><span class="s1">&#39;modelDescription.xml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="symbolic-reformulation">
<h3>7.4. Symbolic reformulation<a class="headerlink" href="#symbolic-reformulation" title="Permalink to this headline">¶</a></h3>
<p>One of the original purposes of the <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> class was to reformulate
a <em>fully-implicit DAE</em>, typically coming from Modelica, to a semi-explicit
DAE that can be used more readily in optimal control algorithms.</p>
<p>This can be done by the python{make_implicit} command:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ocp</span><span class="o">.</span><span class="n">make_explicit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">ocp</span><span class="p">.</span><span class="n">make_explicit</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<p>Other useful commands available for an instance <code class="docutils literal notranslate"><span class="pre">ocp</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> include:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">print</span> <span class="pre">ocp</span></code> Print the optimal optimal control problem to screen</li>
<li><code class="docutils literal notranslate"><span class="pre">ocp.scale_variables()</span></code> Scale all variables using the <em>nominal</em> attribute for each variable</li>
<li><code class="docutils literal notranslate"><span class="pre">ocp.eliminate_d()</span></code> Eliminate all independent parameters from the symbolic expressions</li>
</ul>
<p>For a more detailed description of this class and its functionalities, we again
refer to the API documentation.</p>
</div>
<div class="section" id="function-factory">
<h3>7.5. Function factory<a class="headerlink" href="#function-factory" title="Permalink to this headline">¶</a></h3>
<p>Once a <code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> has been formulated and possibly reformulated to
a satisfactory form, we can generate CasADi functions corresponding to the
input and output expressions outlined in <a class="reference internal" href="#sec-daebuilder-io"><span class="std std-numref">Section 7.1</span></a>.
For example, to create a function for the ODE right-hand-side for the rocket
model in <a class="reference internal" href="#sec-daebuilder-syntax"><span class="std std-numref">Section 7.2</span></a>, simply provide a display
name of the function being created, a list of input expressions
and a list of output expressions:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span>\
     <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">],[</span><span class="s1">&#39;ode&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,...</span>
     <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;u&#39;</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">},{</span><span class="s">&#39;ode&#39;</span><span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<p>Using a naming convention, we can also create Jacobians, e.g. for the ‘ode’
output with respect to ‘x’:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span>\
     <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">],</span>\
     <span class="p">[</span><span class="s1">&#39;jac_ode_x&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,...</span>
     <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;u&#39;</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">},</span>
     <span class="p">{</span><span class="s">&#39;jac_ode_x&#39;</span><span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<p>Functions with second order information can be extracted by first creating
a named linear combination of the output expressions using <code class="docutils literal notranslate"><span class="pre">add_lc</span></code>
and then requesting its Hessian:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dae</span><span class="o">.</span><span class="n">add_lc</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,[</span><span class="s1">&#39;ode&#39;</span><span class="p">])</span>
<span class="n">hes</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;hes&#39;</span><span class="p">,</span>\
  <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;lam_ode&#39;</span><span class="p">],</span>\
  <span class="p">[</span><span class="s1">&#39;hes_gamma_x_x&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">dae</span><span class="p">.</span><span class="n">add_lc</span><span class="p">(</span><span class="s">&#39;gamma&#39;</span><span class="p">,{</span><span class="s">&#39;ode&#39;</span><span class="p">});</span>
<span class="n">hes</span> <span class="p">=</span> <span class="n">dae</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;hes&#39;</span><span class="p">,...</span>
  <span class="p">{</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;u&#39;</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="s">&#39;lam_ode&#39;</span><span class="p">},...</span>
  <span class="p">{</span><span class="s">&#39;hes_gamma_x_x&#39;</span><span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<p>It is also possible to simply extract the symbolic expressions from the
<code class="xref py py-class docutils literal notranslate"><span class="pre">DaeBuilder</span></code> instance and manually create CasADi functions.
For example, <code class="docutils literal notranslate"><span class="pre">dae.x</span></code> contains all the expressions corresponding to ‘x’,
<code class="docutils literal notranslate"><span class="pre">dae.ode</span></code> contains the expressions corresponding to ‘ode’, etc.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>FMI development group. Functional Mock-up Interface for Model Exchange and Co-Simulation. <a class="reference external" href="https://www.fmi-standard.org/">https://www.fmi-standard.org/</a>, July 2014. Specification, FMI 2.0. Section 3.1, pp. 71–72</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-ocp"></span><div class="section" id="optimal-control-with-casadi">
<h2>8. Optimal control with CasADi<a class="headerlink" href="#optimal-control-with-casadi" title="Permalink to this headline">¶</a></h2>
<p>CasADi can be used to solve <em>optimal control problems</em> (OCP) using a variety of methods, including direct (a.k.a. <em>discretize-then-optimize</em>) and indirect (a.k.a. <em>optimize-then-discretize</em>) methods, all-at-once (e.g. collocation) methods and shooting-methods requiring embedded solvers of initial value problems in ODE or DAE. As a user, you are in general expected to <em>write your own OCP solver</em> and CasADi aims as making this as easy as possible by providing powerful high-level building blocks. Since you are writing the solver yourself (rather than calling an existing “black-box” solver), a basic understanding of how to solve OCPs is indispensable. Good, self-contained introductions to numerical optimal control can be found in the recent textbooks by Biegler <a class="footnote-reference" href="#f4" id="id1">[1]</a> or Betts <a class="footnote-reference" href="#f5" id="id2">[2]</a> or Moritz Diehl’s <a class="reference external" href="https://www.syscop.de/files/2015ws/numopt/numopt_0.pdf">lecture notes on numerical optimal control</a>.</p>
<div class="section" id="a-simple-test-problem">
<h3>8.1. A simple test problem<a class="headerlink" href="#a-simple-test-problem" title="Permalink to this headline">¶</a></h3>
<p>To illustrate some of the methods, we will consider the following test problem,
namely driving a <em>Van der Pol</em> oscillator to the origin, while trying to
minimize a quadratic cost:</p>
<div class="math notranslate nohighlight" id="equation-vdp">
<span class="eqno">(8.1.1)<a class="headerlink" href="#equation-vdp" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{array}{lc}
\begin{array}{l}
\text{minimize:} \\
x(\cdot) \in \mathbb{R}^2, \, u(\cdot) \in \mathbb{R}
\end{array}
\quad \displaystyle \int_{t=0}^{T}{(x_0^2 + x_1^2 + u^2) \, dt}
\\
\\
\text{subject to:} \\
\\
\begin{array}{ll}
\left\{
\begin{array}{l}
\dot{x}_0 = (1-x_1^2) \, x_0 - x_1 + u \\
\dot{x}_1 = x_0 \\
-1.0 \le u \le 1.0, \quad x_1 \ge -0.25
\end{array} \right. &amp; \text{for} \, 0 \le t \le T \\
x_0(0)=0, \quad x_1(0)=1,
\end{array}
\end{array}\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(T=10\)</span>.</p>
<p>In CasADi’s examples collection <a class="footnote-reference" href="#f6" id="id3">[3]</a>, you find codes for solving optimal control problems using a variety of different methods.</p>
<p>In the following, we will discuss three of the most important methods, namely
<em>direct single shooting</em>, <em>direct multiple shooting</em> and <em>direct collocation</em>.</p>
<div class="section" id="direct-single-shooting">
<h4>8.1.1. Direct single-shooting<a class="headerlink" href="#direct-single-shooting" title="Permalink to this headline">¶</a></h4>
<p>In the direct single shooting method, the control trajectory is parameterized
using some piecewise smooth approximation, typically piecewise constant.</p>
<p>Using an explicit expression for the controls, we can then eliminate the whole
state trajectory from the optimization problem, ending up with an NLP in only
the discretized controls.</p>
<p>In CasADi’s examples collection, you will find the codes
<code class="docutils literal notranslate"><span class="pre">direct_single_shooting.py</span></code> and <code class="docutils literal notranslate"><span class="pre">direct_single_shooting.m</span></code>
for Python and MATLAB/Octave, respectively. These codes implement the direct single
shooting method and solves it with IPOPT, relying on CasADi to calculate derivatives.
To obtain the discrete time dynamics from the continuous time dynamics, a
simple fixed-step Runge-Kutta 4 (RK4) integrator is implemented using CasADi symbolics.
Simple integrator codes like these are often useful in the context of optimal control,
but care must be taken so that they accurately solve the initial-value
problem.</p>
<p>The code also shows how the RK4 scheme can be replaced by a
more advanced integrator, namely the CVODES integrator from the SUNDIALS suite,
which implements a variable stepsize, variable order backward differentiation formula
(BDF) scheme. An advanced integrator like this is useful for larger systems,
systems with stiff dynamics, for DAEs and for checking a simpler scheme for
consistency.</p>
</div>
<div class="section" id="direct-multiple-shooting">
<h4>8.1.2. Direct multiple-shooting<a class="headerlink" href="#direct-multiple-shooting" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">direct_multiple_shooting.py</span></code> and <code class="docutils literal notranslate"><span class="pre">direct_multiple_shooting.m</span></code>
codes, also in CasADi’s examples collection, implement the direct multiple
shooting method. This is very similar to the direct single shooting method,
but includes the state at certain <em>shooting nodes</em> as decision variables in
the NLP and includes equality constraints to ensure continuity of the trajectory.</p>
<p>The direct multiple shooting method is often superior to the direct single
shooting method, since “lifting” the problem to a higher dimension is known
to often improve convergence. The user is also able to initialize with
a known guess for the state trajectory.</p>
<p>The drawback is that the NLP solved gets much larger, although this is often
compensated by the fact that it is also much sparser.</p>
</div>
<div class="section" id="direct-collocation">
<h4>8.1.3. Direct collocation<a class="headerlink" href="#direct-collocation" title="Permalink to this headline">¶</a></h4>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">direct_collocation.py</span></code> and <code class="docutils literal notranslate"><span class="pre">direct_collocation.m</span></code>
codes implement the direct collocation method. In this case, a parameterization
of the entire state trajectory, as piecewise low-order polynomials, are included
as decision variables in the NLP. This removes the need for the formulation
of the discrete time dynamics completely.</p>
<p>The NLP in direct collocation is even larger than that in direct multiple shooting,
but is also even sparser.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Lorenz T. Biegler, <a class="reference external" href="http://books.google.es/books/about/Nonlinear_Programming.html?id=VdB1wJQu0sgC&amp;redir_esc=y">Nonlinear Programming: Concepts, Algorithms, and Applications to Chemical Processes</a> , SIAM 2010</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>John T. Betts, <a class="reference external" href="http://books.google.es/books/about/Practical_Methods_for_Optimal_Control_Us.html?id=Yn53JcYAeaoC&amp;redir_esc=y">Practical Methods for Optimal Control Using Nonlinear Programming</a> , SIAM 2001</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>You can obtain this collection as an archive named <code class="docutils literal notranslate"><span class="pre">examples_pack.zip</span></code> in CasADi’s <a class="reference external" href="http://files.casadi.org">download area</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-opti"></span><div class="section" id="opti-stack">
<span id="sec-opti"></span><h2>9. Opti stack<a class="headerlink" href="#opti-stack" title="Permalink to this headline">¶</a></h2>
<p>The Opti stack is a collection of CasADi helper classes that provides a close correspondence between mathematical NLP notation, e.g.</p>
<div class="math notranslate nohighlight" id="equation-simple-nlp">
<span class="eqno">(9.1)<a class="headerlink" href="#equation-simple-nlp" title="Permalink to this equation">¶</a></span>\[\begin{split}  \begin{array}{cc}
  \begin{array}{c}
  \text{minimize} \\
  x,y
  \end{array}
  &amp;
  (y-x^2)^2  \\
  \begin{array}{c}
  \text{subject to}
  \end{array}
  &amp; x^2+y^2=1 \\
  &amp; x+y \ge 1,
  \end{array}\end{split}\]</div>
<p>and computer code:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span> <span class="o">=</span> <span class="n">casadi</span><span class="o">.</span><span class="n">Opti</span><span class="p">()</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">variable</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">variable</span><span class="p">()</span>

<span class="n">opti</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>  <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>   <span class="p">)</span>
<span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">(</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="o">==</span><span class="mi">1</span> <span class="p">)</span>
<span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">(</span>       <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="p">)</span>

<span class="n">opti</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span>


<span class="n">sol</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

0.7861513776531158
0.6180339888825889
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span> <span class="p">=</span> <span class="n">casadi</span><span class="p">.</span><span class="n">Opti</span><span class="p">();</span>

<span class="n">x</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">variable</span><span class="p">();</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">variable</span><span class="p">();</span>

<span class="n">opti</span><span class="p">.</span><span class="n">minimize</span><span class="p">(</span>  <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span>^<span class="mi">2</span><span class="p">)</span>^<span class="mi">2</span>   <span class="p">);</span>
<span class="n">opti</span><span class="p">.</span><span class="n">subject_to</span><span class="p">(</span> <span class="n">x</span>^<span class="mi">2</span><span class="o">+</span><span class="n">y</span>^<span class="mi">2</span><span class="o">==</span><span class="mi">1</span> <span class="p">);</span>
<span class="n">opti</span><span class="p">.</span><span class="n">subject_to</span><span class="p">(</span>     <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">1</span> <span class="p">);</span>

<span class="n">opti</span><span class="p">.</span><span class="n">solver</span><span class="p">(</span><span class="s">&#39;ipopt&#39;</span><span class="p">);</span>

<span class="n">sol</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">solve</span><span class="p">();</span>

<span class="n">sol</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sol</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

ans =  0.78615
ans =  0.61803
</pre></div>
</div>
</div>
</div>
<p>The main characteristics of the Opti stack are:</p>
<ul class="simple">
<li>Allows <em>natural</em> syntax for constraints.</li>
<li>Indexing/bookkeeping of decision variables is hidden.</li>
<li>Closer mapping of numerical data-type to the host language: no encounter with <code class="xref py py-class docutils literal notranslate"><span class="pre">DM</span></code>.</li>
</ul>
<div class="section" id="problem-specification">
<h3>9.1. Problem specification<a class="headerlink" href="#problem-specification" title="Permalink to this headline">¶</a></h3>
<p><strong>Variables</strong>: Declare any amount of decision variables:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">opti.variable()</span></code>: scalar</li>
<li><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">opti.variable(5)</span></code>: column vector</li>
<li><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">opti.variable(5,3)</span></code>: matrix</li>
<li><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">opti.variable(5,5,'symmetric')</span></code>: symmetric matrix</li>
</ul>
<p>The order in which you declare the variables is respected by the solver.
Note that the variables are in fact plain MX symbols.
You may perform any CasADi MX operations on them, e.g. embedding integrator calls.</p>
<p><strong>Parameters</strong>: Declare any amount of parameters. You must fix them to a specific numerical value before solving, and you may overwrite this value at any time.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">parameter</span><span class="p">()</span>
<span class="n">opti</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">parameter</span><span class="p">();</span>
<span class="n">opti</span><span class="p">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Objective</strong>: Declare an objective using an expression that may involve all variables or parameters. Calling the command again discards the old objective.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>   <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>   <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="p">.</span><span class="n">minimize</span><span class="p">(</span>   <span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>   <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Constraints</strong>: Declare any amount of equality/inequality constraints:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">opti.subject_to(</span> <span class="pre">sqrt(x+y)</span> <span class="pre">&gt;=</span> <span class="pre">1)</span></code>: inequality</li>
<li><code class="docutils literal notranslate"><span class="pre">opti.subject_to(</span> <span class="pre">sqrt(x+y)</span> <span class="pre">&gt;</span> <span class="pre">1)</span></code>: same as above</li>
<li><code class="docutils literal notranslate"><span class="pre">opti.subject_to(</span> <span class="pre">1&lt;=</span> <span class="pre">sqrt(x+y)</span> <span class="pre">)</span></code>: same as above</li>
<li><code class="docutils literal notranslate"><span class="pre">opti.subject_to(</span> <span class="pre">5*x+y==1</span> <span class="pre">)</span></code>: equality</li>
</ul>
<p>You may also throw in several constraints at once:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="p">.</span><span class="n">subject_to</span><span class="p">({</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span><span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<p>You may declare double inequalities:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">(</span> <span class="n">opti</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="p">.</span><span class="n">subject_to</span><span class="p">(</span> <span class="mi">0</span><span class="o">&lt;</span><span class="p">=</span><span class="n">x</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">1</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>When the bounds of the double inequalities are free of variables, the constraint will be passed on efficiently to solvers that support them (notably IPOPT).</p>
<p>You may make element-wise (in)equalities with vectors:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">(</span> <span class="n">x</span><span class="o">*</span><span class="n">p</span><span class="o">&lt;=</span><span class="mi">3</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">variable</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="n">opti</span><span class="p">.</span><span class="n">subject_to</span><span class="p">(</span> <span class="n">x</span><span class="o">*</span><span class="n">p</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">3</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Elementwise (in)equalities for matrices are not supported with a natural syntax,
since there is an ambiguity with semi-definiteness constraints.
The workaround is to vectorize first:</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">(</span> <span class="n">vec</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">3</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">variable</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="n">opti</span><span class="p">.</span><span class="n">subject_to</span><span class="p">(</span> <span class="n">A</span><span class="p">(:)</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">3</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Each <code class="docutils literal notranslate"><span class="pre">subject_to</span></code> command adds to the set of constraints in the problem specification.
Use <code class="docutils literal notranslate"><span class="pre">subject_to()</span></code> to empty this set and start over.</p>
<p><strong>Solver</strong>:
You must always declare the <code class="docutils literal notranslate"><span class="pre">solver</span></code> (numerical back-end).
An optional dictionary of CasADi plugin options can be given as second argument.
An optional dictionary of <code class="docutils literal notranslate"><span class="pre">solver</span></code> options can be given as third argument.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;expand&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
<span class="n">s_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_iter&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
<span class="n">opti</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="s2">&quot;ipopt&quot;</span><span class="p">,</span><span class="n">p_opts</span><span class="p">,</span>
                    <span class="n">s_opts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">p_opts</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;expand&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
<span class="n">s_opts</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;max_iter&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="n">opti</span><span class="p">.</span><span class="n">solver</span><span class="p">(</span><span class="s">&#39;ipopt&#39;</span><span class="p">,</span><span class="n">p_opts</span><span class="p">,</span>
                    <span class="n">s_opts</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Initial guess</strong>:
You may provide initial guesses for decision variables (or simple mappings of decision variables). When no initial guess is provided, numerical zero is assumed.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">opti</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="p">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">opti</span><span class="p">.</span><span class="n">set_initial</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="problem-solving-and-retrieving">
<h3>9.2. Problem solving and retrieving<a class="headerlink" href="#problem-solving-and-retrieving" title="Permalink to this headline">¶</a></h3>
<div class="section" id="solving">
<h4>9.2.1. Solving<a class="headerlink" href="#solving" title="Permalink to this headline">¶</a></h4>
<p>After setting up the problem, you may call the solve method, which constructs a CasADi <code class="docutils literal notranslate"><span class="pre">nlpsol</span></code> and calls it.</p>
<div class="sidebyside-master docutils container">
<div class="sidebyside docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

This is Ipopt version 3.12.3, running with linear solver mumps.
NOTE: Other linear solvers might be more efficient (see Ipopt documentation).

Number of nonzeros in equality constraint Jacobian...:        2
Number of nonzeros in inequality constraint Jacobian.:        2
Number of nonzeros in Lagrangian Hessian.............:        3

Total number of variables............................:        2
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        0
                     variables with only upper bounds:        0
Total number of equality constraints.................:        1
Total number of inequality constraints...............:        1
        inequality constraints with only lower bounds:        1
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  0.0000000e+00 1.00e+00 1.00e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  1.5180703e+00 2.32e-01 3.95e+08  -1.0 1.11e+00    -  9.90e-01 1.00e+00h  1
   2  9.1720733e-01 1.38e-02 8.65e+08  -1.0 1.05e-01  10.0 1.00e+00 1.00e+00f  1
   3  8.9187743e-01 4.67e-05 9.29e+06  -1.0 7.19e-03    -  1.00e+00 1.00e+00h  1
   4  8.9179090e-01 5.46e-10 2.17e+02  -1.0 2.42e-05    -  1.00e+00 1.00e+00h  1
   5  8.5961118e-01 2.43e-04 3.39e+00  -1.0 1.56e-02    -  1.00e+00 1.00e+00f  1
   6  5.0768568e-01 3.58e-02 2.18e+00  -1.0 1.89e-01    -  3.86e-01 1.00e+00f  1
   7  4.4751644e-01 4.12e-04 6.30e+07  -1.0 1.96e-02   9.5 1.00e+00 1.00e+00h  1
   8  4.4707538e-01 4.25e-08 2.27e+04  -1.0 2.53e-04    -  1.00e+00 1.00e+00h  1
   9  4.4688522e-01 9.34e-09 2.20e+00  -1.0 9.32e-05    -  1.00e+00 1.00e+00h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  2.9995484e-02 3.46e-01 1.19e+00  -1.0 5.68e-01    -  5.45e-01 1.00e+00f  1
  11  3.9964883e-04 3.56e-02 5.81e-02  -1.0 2.09e-01    -  1.00e+00 1.00e+00h  1
  12  3.7581923e-06 5.63e-04 5.70e-03  -2.5 2.69e-02    -  1.00e+00 1.00e+00h  1
  13  7.6573980e-10 1.48e-06 3.13e-05  -3.8 1.11e-03    -  1.00e+00 1.00e+00h  1
  14  4.8778322e-14 2.53e-10 7.52e-09  -5.7 1.29e-05    -  1.00e+00 1.00e+00h  1
  15  8.8029044e-20 1.60e-14 6.47e-13  -8.6 9.88e-08    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 15

                                   (scaled)                 (unscaled)
Objective...............:   8.8029044107981477e-20    8.8029044107981477e-20
Dual infeasibility......:   6.4749359007033628e-13    6.4749359007033628e-13
Constraint violation....:   1.5987211554602254e-14    1.5987211554602254e-14
Complementarity.........:   2.5060006300474834e-09    2.5060006300474834e-09
Overall NLP error.......:   2.5060006300474834e-09    2.5060006300474834e-09


Number of objective function evaluations             = 16
Number of objective gradient evaluations             = 16
Number of equality constraint evaluations            = 16
Number of inequality constraint evaluations          = 16
Number of equality constraint Jacobian evaluations   = 16
Number of inequality constraint Jacobian evaluations = 16
Number of Lagrangian Hessian evaluations             = 15
Total CPU secs in IPOPT (w/o function evaluations)   =      0.005
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.
               t_proc [s]   t_wall [s]    n_eval
       nlp_f      2.6e-05      2.3e-05        16
       nlp_g      5.3e-05     4.74e-05        16
  nlp_grad_f      3.7e-05     3.64e-05        17
  nlp_hess_l      6.2e-05     5.95e-05        15
   nlp_jac_g        5e-05      4.9e-05        17
      solver      0.00608      0.00608         1
</pre></div>
</div>
</div>
<div class="sidebyside docutils container">
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">solve</span><span class="p">();</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

This is Ipopt version 3.12.3, running with linear solver mumps.
NOTE: Other linear solvers might be more efficient (see Ipopt documentation).

Number of nonzeros in equality constraint Jacobian...:        2
Number of nonzeros in inequality constraint Jacobian.:        2
Number of nonzeros in Lagrangian Hessian.............:        3

Total number of variables............................:        2
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        0
                     variables with only upper bounds:        0
Total number of equality constraints.................:        1
Total number of inequality constraints...............:        1
        inequality constraints with only lower bounds:        1
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  0.0000000e+00 1.00e+00 1.00e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  1.5180703e+00 2.32e-01 3.95e+08  -1.0 1.11e+00    -  9.90e-01 1.00e+00h  1
   2  9.1720733e-01 1.38e-02 8.65e+08  -1.0 1.05e-01  10.0 1.00e+00 1.00e+00f  1
   3  8.9187743e-01 4.67e-05 9.29e+06  -1.0 7.19e-03    -  1.00e+00 1.00e+00h  1
   4  8.9179090e-01 5.46e-10 2.17e+02  -1.0 2.42e-05    -  1.00e+00 1.00e+00h  1
   5  8.5961118e-01 2.43e-04 3.39e+00  -1.0 1.56e-02    -  1.00e+00 1.00e+00f  1
   6  5.0768568e-01 3.58e-02 2.18e+00  -1.0 1.89e-01    -  3.86e-01 1.00e+00f  1
   7  4.4751644e-01 4.12e-04 6.30e+07  -1.0 1.96e-02   9.5 1.00e+00 1.00e+00h  1
   8  4.4707538e-01 4.25e-08 2.27e+04  -1.0 2.53e-04    -  1.00e+00 1.00e+00h  1
   9  4.4688522e-01 9.34e-09 2.20e+00  -1.0 9.32e-05    -  1.00e+00 1.00e+00h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  2.9995484e-02 3.46e-01 1.19e+00  -1.0 5.68e-01    -  5.45e-01 1.00e+00f  1
  11  3.9964883e-04 3.56e-02 5.81e-02  -1.0 2.09e-01    -  1.00e+00 1.00e+00h  1
  12  3.7581923e-06 5.63e-04 5.70e-03  -2.5 2.69e-02    -  1.00e+00 1.00e+00h  1
  13  7.6573980e-10 1.48e-06 3.13e-05  -3.8 1.11e-03    -  1.00e+00 1.00e+00h  1
  14  4.8778322e-14 2.53e-10 7.52e-09  -5.7 1.29e-05    -  1.00e+00 1.00e+00h  1
  15  8.8029044e-20 1.60e-14 6.47e-13  -8.6 9.88e-08    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 15

                                   (scaled)                 (unscaled)
Objective...............:   8.8029044107981477e-20    8.8029044107981477e-20
Dual infeasibility......:   6.4749359007033628e-13    6.4749359007033628e-13
Constraint violation....:   1.5987211554602254e-14    1.5987211554602254e-14
Complementarity.........:   2.5060006300474834e-09    2.5060006300474834e-09
Overall NLP error.......:   2.5060006300474834e-09    2.5060006300474834e-09


Number of objective function evaluations             = 16
Number of objective gradient evaluations             = 16
Number of equality constraint evaluations            = 16
Number of inequality constraint evaluations          = 16
Number of equality constraint Jacobian evaluations   = 16
Number of inequality constraint Jacobian evaluations = 16
Number of Lagrangian Hessian evaluations             = 15
Total CPU secs in IPOPT (w/o function evaluations)   =      0.005
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.
               t_proc [s]   t_wall [s]    n_eval
       nlp_f      2.3e-05     2.12e-05        16
       nlp_g      5.9e-05     5.44e-05        16
  nlp_grad_f      4.2e-05     3.99e-05        17
  nlp_hess_l      6.7e-05     6.59e-05        15
   nlp_jac_g      5.5e-05     5.68e-05        17
      solver      0.00718      0.00718         1
</pre></div>
</div>
</div>
</div>
<p>The call will fail with an error if the solver fails to convergence. You may still inspect the non-converged solution (see <a class="reference internal" href="#sec-opti-extra"><span class="std std-numref">Section 9.3</span></a>).</p>
<p>You may call <code class="docutils literal notranslate"><span class="pre">solve</span></code> any number of times. You will always get an immutable copy of the problem specification and its solution.
Consecutively calling <code class="docutils literal notranslate"><span class="pre">solve</span></code> will not help the convergence of the problem.</p>
<p>To warm start a solver, you need to explicitly transfer the solution of one problem to the initial value of the next.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sol1</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">sol1</span><span class="o">.</span><span class="n">stats</span><span class="p">()[</span><span class="s2">&quot;iter_count&quot;</span><span class="p">])</span>

<span class="c1"># Solving again makes no difference</span>
<span class="n">sol1</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">sol1</span><span class="o">.</span><span class="n">stats</span><span class="p">()[</span><span class="s2">&quot;iter_count&quot;</span><span class="p">])</span>

<span class="c1"># Passing initial makes a difference</span>
<span class="n">opti</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">sol1</span><span class="o">.</span><span class="n">value_variables</span><span class="p">())</span>
<span class="n">sol2</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">sol2</span><span class="o">.</span><span class="n">stats</span><span class="p">()[</span><span class="s2">&quot;iter_count&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

15
15
4
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">sol1</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">solve</span><span class="p">();</span>
<span class="n">sol1</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">iter_count</span>

<span class="c">% Solving again makes no difference</span>
<span class="n">sol1</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">solve</span><span class="p">();</span>
<span class="n">sol1</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">iter_count</span>

<span class="c">% Passing initial makes a difference</span>
<span class="n">opti</span><span class="p">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">sol1</span><span class="p">.</span><span class="n">value_variables</span><span class="p">());</span>
<span class="n">sol2</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">solve</span><span class="p">();</span>
<span class="n">sol2</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">iter_count</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

ans =  15
ans =  15
ans =  4
</pre></div>
</div>
<p>In order to initialize the dual variables, e.g. when solving a set of similar optimization problems, you can use the following syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">lam_g0</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">opti</span><span class="o">.</span><span class="n">lam_g</span><span class="p">)</span>
<span class="n">opti</span><span class="o">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">opti</span><span class="o">.</span><span class="n">lam_g</span><span class="p">,</span> <span class="n">lam_g0</span><span class="p">)</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">solve</span><span class="p">();</span>
<span class="n">lam_g0</span> <span class="p">=</span> <span class="n">sol</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">opti</span><span class="p">.</span><span class="n">lam_g</span><span class="p">);</span>
<span class="n">opti</span><span class="p">.</span><span class="n">set_initial</span><span class="p">(</span><span class="n">opti</span><span class="p">.</span><span class="n">lam_g</span><span class="p">,</span> <span class="n">lam_g0</span><span class="p">);</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

</pre></div>
</div>
</div>
<div class="section" id="numerical-value-at-the-solution">
<h4>9.2.2. Numerical value at the solution<a class="headerlink" href="#numerical-value-at-the-solution" title="Permalink to this headline">¶</a></h4>
<p>Afterwards, you may retrieve the numerical values of variables (or expressions of those variables) at the solution:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">sol.value(x)</span></code>: value of a decision variable</li>
<li><code class="docutils literal notranslate"><span class="pre">sol.value(p)</span></code>: value of a parameter</li>
<li><code class="docutils literal notranslate"><span class="pre">sol.value(sin(x+p))</span></code>: value of an expression</li>
<li><code class="docutils literal notranslate"><span class="pre">sol.value(jacobian(opti.g,opti.x))</span></code>: value of constraint jacobian</li>
</ul>
<p>Note that the return type of <code class="docutils literal notranslate"><span class="pre">value</span></code> is sparse when applicable.</p>
</div>
<div class="section" id="numerical-value-at-other-points">
<h4>9.2.3. Numerical value at other points<a class="headerlink" href="#numerical-value-at-other-points" title="Permalink to this headline">¶</a></h4>
<p>You may pass a list of overruling assignment expressions to <code class="docutils literal notranslate"><span class="pre">value</span></code>.
In the following code, we are asking for the value of the objective,
using all optimal values at the solution, except for <code class="docutils literal notranslate"><span class="pre">y</span></code>, which we set equal to 2.
Note that such statement does not modify the actual optimal value of <code class="docutils literal notranslate"><span class="pre">y</span></code> in a permanent way.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">opti</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">obj</span><span class="p">,[</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

1.909830056703819
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="p">=</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span>^<span class="mi">2</span><span class="p">)</span>^<span class="mi">2</span><span class="p">;</span>

<span class="n">opti</span><span class="p">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>



<span class="n">sol</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">obj</span><span class="p">,{</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

ans =  1.9098
</pre></div>
</div>
<p>A related usage pattern is to evaluate an expression at the initial guess:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="p">,</span><span class="n">opti</span><span class="o">.</span><span class="n">initial</span><span class="p">()))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

0.0
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="p">,</span><span class="n">opti</span><span class="p">.</span><span class="n">initial</span><span class="p">())</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

ans = 0
</pre></div>
</div>
</div>
<div class="section" id="dual-variables">
<h4>9.2.4. Dual variables<a class="headerlink" href="#dual-variables" title="Permalink to this headline">¶</a></h4>
<p>In order to obtain dual variables (Lagrange multipliers) of constraints, make sure you save the constraint expression first:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">con</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">1</span>
<span class="n">opti</span><span class="o">.</span><span class="n">subject_to</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">opti</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">opti</span><span class="o">.</span><span class="n">dual</span><span class="p">(</span><span class="n">con</span><span class="p">)))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

0.258679501736367
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">con</span> <span class="p">=</span> <span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">opti</span><span class="p">.</span><span class="n">subject_to</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
<span class="n">sol</span> <span class="p">=</span> <span class="n">opti</span><span class="p">.</span><span class="n">solve</span><span class="p">();</span>

<span class="n">sol</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">opti</span><span class="p">.</span><span class="n">dual</span><span class="p">(</span><span class="n">con</span><span class="p">))</span>
</pre></div>
</div>
<div class="exec-block-output highlight-none notranslate"><div class="highlight"><pre><span></span>
******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************

ans =  0.25868
</pre></div>
</div>
</div>
</div>
<div class="section" id="extras">
<span id="sec-opti-extra"></span><h3>9.3. Extras<a class="headerlink" href="#extras" title="Permalink to this headline">¶</a></h3>
<p>It may well happen that the solver does not find an optimal solution.
In such cases, you may still access the non-converged solution through debug mode:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Related, you may inspect the value of an expression, at the initial guess that you supplied to the solver:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">opti</span><span class="o">.</span><span class="n">initial</span><span class="p">())</span>
</pre></div>
</div>
<p>In case the solver stops due to problem infeasibility, you may identify the problematic constraints with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">show_infeasibilities</span><span class="p">()</span>
</pre></div>
</div>
<p>In case the solver reports NaN/Inf at a certain location, you may find out which constraint or variable is to blame by looking at its description:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">x_describe</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">opti</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">g_describe</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
<p>You may specify a callback function; it will be called at each iteration of the solver, with the current iteration number as argument.
To plot the progress of the solver, you may access the non-converged solution through debug mode:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">plot</span><span class="p">(</span><span class="n">opti</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">opti</span><span class="p">.</span><span class="n">callback</span><span class="p">(@(</span><span class="n">i</span><span class="p">)</span> <span class="nb">plot</span><span class="p">(</span><span class="n">opti</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</pre></div>
</div>
<p>The callback may be cleared from the Opti stack by calling the <code class="xref py py-class docutils literal notranslate"><span class="pre">Callback</span></code> function without arguments.</p>
</div>
</div>
<span id="document-usage"></span><div class="section" id="difference-in-usage-from-different-languages">
<span id="sec-syntax-differences"></span><h2>10. Difference in usage from different languages<a class="headerlink" href="#difference-in-usage-from-different-languages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-usage">
<h3>10.1. General usage<a class="headerlink" href="#general-usage" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-number">Table 10.1.1 </span><span class="caption-text">General usage</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Task</th>
<th class="head">Python</th>
<th class="head">C++</th>
<th class="head">MATLAB/Octave</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Starting CasADi</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">casadi</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;casadi/casadi.hpp&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">casadi</span><span class="p">;</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">import</span> <span class="n">casadi</span><span class="o">.*</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Printing object</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">A</span><span class="p">;</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">disp</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Printing with type information</td>
<td><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&lt;ENTER&gt;</span></code> (interactive), <code class="docutils literal notranslate"><span class="pre">print(repr(A))</span></code></td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">repr</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
</pre></div>
</div>
</td>
<td><code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">&lt;ENTER&gt;</span></code> (interactive), <code class="docutils literal notranslate"><span class="pre">disp(repr(A))</span></code></td>
</tr>
<tr class="row-odd"><td>Get (extended) representation, <code class="docutils literal notranslate"><span class="pre">more=false</span></code> by default</td>
<td><code class="docutils literal notranslate"><span class="pre">A.str(more)</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">str(A,</span> <span class="pre">more)</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">str(A,</span> <span class="pre">more)</span></code></td>
</tr>
<tr class="row-even"><td>Calling a class function</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SX</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SX</span><span class="o">::</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">SX</span><span class="p">.</span><span class="nb">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Creating a dictionary (e.g. for options)</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">opt1</span><span class="o">=</span><span class="n">opt1</span><span class="p">)</span>
<span class="c1">#or</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;opt1&#39;</span><span class="p">:</span><span class="n">opt1</span><span class="p">}</span>
<span class="c1">#or</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;opt1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt1</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Dict</span> <span class="n">a</span><span class="p">;</span>
<span class="n">a</span><span class="p">[</span><span class="s">&quot;opt1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt1</span><span class="p">;</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">;</span>
<span class="n">a</span><span class="p">.</span><span class="n">opt1</span> <span class="p">=</span> <span class="n">opt1</span><span class="p">;</span>

<span class="c">#or</span>
<span class="n">a</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;opt1&#39;</span><span class="p">,</span><span class="n">opt1</span><span class="p">);</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Creating a symbol</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MX</span><span class="o">::</span><span class="n">sym</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Creating a function</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">],[</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">])</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">},{</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">})</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">},{</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">})</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Calling a function (form 1)</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">f</span><span class="p">({</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">})</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Calling a function (form 2)</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="n">res</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">res</span> <span class="o">=</span>\
<span class="n">f</span><span class="p">({&lbrace;</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">},{</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">}&rbrace;);</span>
<span class="n">res</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="p">=</span><span class="n">f</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">res</span><span class="p">.</span><span class="n">z</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Create an NLP solver</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nlp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">:</span><span class="n">f</span><span class="p">}</span>
<span class="n">nlpsol</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="s2">&quot;ipopt&quot;</span><span class="p">,</span><span class="n">nlp</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MXDict</span> <span class="n">nlp</span> <span class="o">=</span>\
<span class="p">{&lbrace;</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">},{</span><span class="s">&quot;f&quot;</span><span class="p">,</span><span class="n">f</span><span class="p">}&rbrace;;</span>
<span class="n">nlpsol</span><span class="p">(</span><span class="s">&quot;S&quot;</span><span class="p">,</span><span class="s">&quot;ipopt&quot;</span><span class="p">,</span><span class="n">nlp</span><span class="p">);</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">nlp</span><span class="p">=</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
<span class="n">nlpsol</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">,</span><span class="s">&#39;ipopt&#39;</span><span class="p">,</span><span class="n">nlp</span><span class="p">);</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="list-of-operations">
<h3>10.2. List of operations<a class="headerlink" href="#list-of-operations" title="Permalink to this headline">¶</a></h3>
<p>The following is a list of the most important operations. Operations that differ between the different
languages are marked with a star (*). This list is neither complete, nor does it show all the variants of
each operation. Further information is available in the API documentation.</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-number">Table 10.2.1 </span><span class="caption-text">General usage</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Task</th>
<th class="head">Python</th>
<th class="head">C++</th>
<th class="head">MATLAB/Octave</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Addition, subtraction</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Elementwise multiplication, division</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">/</span><span class="n">y</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">/</span><span class="n">y</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.*</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">./</span><span class="n">y</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Matrix multiplication</td>
<td><div class="first last highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">@</span> <span class="n">y</span>
<span class="c1"># or before Py3.4:</span>
<span class="n">mtimes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mtimes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">*</span><span class="n">y</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Linear system solve</td>
<td><div class="first last highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">\</span><span class="n">b</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Natural exponential function and logarithm</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">exp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Exponentiation</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">**</span><span class="n">y</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">x</span>^<span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">.^</span><span class="n">y</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Square root</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Trigonometric functions</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">tan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Inverse trigonometric</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">asin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">acos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">asin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">acos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">asin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">acos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Two argument arctangent</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atan2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">atan2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">atan2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Hyperbolic functions</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sinh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">cosh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">sinh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">cosh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">sinh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">cosh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Inverse hyperbolic</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">asinh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">acosh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">asinh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">acosh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">asinh</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">acosh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Inequalities</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">&lt;</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&lt;=</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&gt;</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&gt;=</span><span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">&lt;</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&lt;=</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&gt;</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&gt;=</span><span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">&lt;</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&lt;</span><span class="p">=</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&gt;</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">&gt;</span><span class="p">=</span><span class="n">b</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>(<em>Not</em>) equal to</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">!=</span><span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">!=</span><span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">~=</span><span class="n">b</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Logical and</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logic_and</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Logical or</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logic_or</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">||</span> <span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">|</span> <span class="n">b</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Logical not</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logic_not</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="n">a</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="o">~</span><span class="n">a</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Round to integer</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">floor</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">ceil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Modulus after division</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fmod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">fmod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Absolute value</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fabs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">fabs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Norm</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">norm_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">norm_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Sign function</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>(Inverse) error function</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">erf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">erfinv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">erf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">erfinv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">erf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">erfinv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Elementwise min and max</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fmin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">fmax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">fmin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">fmax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Global min and max</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">mmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">mmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">mmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">mmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Index of first nonzero</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">find</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">find</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">find</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>If-then-else</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">if_else</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">if_else</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">if_else</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Transpose</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">.</span><span class="n">T</span><span class="p">()</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="o">&#39;</span><span class="p">,</span><span class="n">A</span><span class="p">.</span><span class="o">&#39;</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Inner product</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="nb">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Horizontal/vertical concatenation</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">horzcat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">vertcat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">hcat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
<span class="n">vcat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">horzcat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">vertcat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">MX</span><span class="o">::</span><span class="n">horzcat</span><span class="p">({</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">})</span>
<span class="n">MX</span><span class="o">::</span><span class="n">vertcat</span><span class="p">({</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">})</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
<span class="p">[</span><span class="n">x</span><span class="p">;</span> <span class="n">y</span><span class="p">]</span>
<span class="n">c</span> <span class="p">=</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">};</span>
<span class="p">[</span><span class="n">c</span><span class="p">{:}]</span>
<span class="nb">vertcat</span><span class="p">(</span><span class="n">c</span><span class="p">{:})</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Horizontal/vertical split (inverse of concatenation)</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vertsplit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">horzsplit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">vertsplit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">horzsplit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">vertsplit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">horzsplit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Element access</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 0-based</span>
<span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
<span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 0-based</span>
<span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%  1-based</span>
<span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Element assignment</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 0-based</span>
<span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 0-based</span>
<span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="c">%  1-based</span>
<span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">b</span>
<span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">b</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Nonzero access</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 0-based</span>
<span class="n">A</span><span class="o">.</span><span class="n">nz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 0-based</span>
<span class="n">A</span><span class="p">.</span><span class="n">nz</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">currently</span> <span class="n">unsupported</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Nonzero assignment</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 0-based</span>
<span class="n">A</span><span class="o">.</span><span class="n">nz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 0-based</span>
<span class="n">A</span><span class="p">.</span><span class="n">nz</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">currently</span> <span class="n">unsupported</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Project to a different sparsity</td>
<td><div class="first last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">project</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">project</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</td>
<td><div class="first last highlight-octave notranslate"><div class="highlight"><pre><span></span><span class="n">project</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
