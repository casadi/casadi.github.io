<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    
      <title>CasADi - Features</title>
    

    
    <link href="https://web.casadi.org/_css/font-awesome.min.css" rel="stylesheet">

    
    <link href="https://web.casadi.org/_css/bootstrap.min.css" rel="stylesheet">

    
    <link href="https://web.casadi.org/_css/pygments-default.css" rel="stylesheet">

    
    <link href="https://web.casadi.org/_css/casadi-theme.min.css" rel="stylesheet">

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ['\\(','\\)'] ],
          displayMath: [ ['$$','$$'], ['\\[','\\]'] ],
          processEnvironments: false
        }
      });
    </script>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  </head>

  <body>



<nav class="navbar fixed-top navbar-expand-lg nav-top">
  <div class="container">
    <a class="navbar-brand" href="https://web.casadi.org/"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fa fa-bars" aria-hidden="true"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        
        
          
          <li class="nav-item active">
          
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          <li class="nav-item">
          
            <a class="nav-link" href="/get/">Try/Install</a>
          </li>
        
          
          <li class="nav-item">
          
            <a class="nav-link" href="/docs/">Docs</a>
          </li>
        
          
          <li class="nav-item">
          
            <a class="nav-link" href="/support/">Support</a>
          </li>
        
          
          <li class="nav-item">
          
            <a class="nav-link" href="/source/">Source</a>
          </li>
        
          
          <li class="nav-item">
          
            <a class="nav-link" href="/publications/">Publications</a>
          </li>
        
          
          <li class="nav-item">
          
            <a class="nav-link" href="/events/">Workshops</a>
          </li>
        
          
          <li class="nav-item">
          
            <a class="nav-link" href="/blog/">Blog</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

<h2 class="text-center">Composition of the above</h2>

<div class="row">
<div class="col-md-6">
<div class="multisnip text-left">
<div class="highlight">
<pre><code data-lang="example"></code></pre>

<figure class=" default">
  <a href="https://web.casadi.org/home/card-ocp/../composition.png" target="_blank">
  
    <img src="https://web.casadi.org/home/card-ocp/../composition.png"  />
  </a>
  
</figure>



<figure class=" default">
  <a href="https://web.casadi.org/home/card-ocp/../ocp.png" target="_blank">
  
    <img src="https://web.casadi.org/home/card-ocp/../ocp.png"  />
  </a>
  
</figure>


</div>
<div class="highlight"><pre class="chroma"><code class="language-octave" data-lang="octave"><span class="n">import</span> <span class="n">casadi</span><span class="o">.*</span><span class="err">
</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="n">x</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="c">% Two states</span><span class="err">
</span><span class="err"></span><span class="n">p</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">);</span>   <span class="c">% Free parameter</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c">% Expression for ODE right-hand side</span><span class="err">
</span><span class="err"></span><span class="n">z</span> <span class="p">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>^<span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="n">rhs</span> <span class="p">=</span> <span class="p">[</span><span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="nb">tanh</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c">% ODE declaration with free parameter</span><span class="err">
</span><span class="err"></span><span class="n">ode</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;ode&#39;</span><span class="p">,</span><span class="n">rhs</span><span class="p">);</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c">% Construct a Function that integrates over 1s</span><span class="err">
</span><span class="err"></span><span class="n">F</span> <span class="p">=</span> <span class="n">integrator</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">,</span><span class="s">&#39;cvodes&#39;</span><span class="p">,</span><span class="n">ode</span><span class="p">,</span><span class="nb">struct</span><span class="p">(</span><span class="s">&#39;tf&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c">% Control vector</span><span class="err">
</span><span class="err"></span><span class="n">u</span> <span class="p">=</span> <span class="n">MX</span><span class="p">.</span><span class="n">sym</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">];</span> <span class="c">% Initial state</span><span class="err">
</span><span class="err"></span><span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="err">
</span><span class="err"></span>  <span class="c">% Integrate 1s forward in time:</span><span class="err">
</span><span class="err"></span>  <span class="c">% call integrator symbolically</span><span class="err">
</span><span class="err"></span>  <span class="n">res</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;x0&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="n">u</span><span class="p">(</span><span class="n">k</span><span class="p">));</span><span class="err">
</span><span class="err"></span>  <span class="n">x</span> <span class="p">=</span> <span class="n">res</span><span class="p">.</span><span class="n">xf</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="k">end</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c">% NLP declaration</span><span class="err">
</span><span class="err"></span><span class="n">nlp</span> <span class="p">=</span> <span class="nb">struct</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="nb">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">u</span><span class="p">),</span><span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c">% Solve using IPOPT</span><span class="err">
</span><span class="err"></span><span class="n">solver</span> <span class="p">=</span> <span class="n">nlpsol</span><span class="p">(</span><span class="s">&#39;solver&#39;</span><span class="p">,</span><span class="s">&#39;ipopt&#39;</span><span class="p">,</span><span class="n">nlp</span><span class="p">);</span><span class="err">
</span><span class="err"></span><span class="n">res</span> <span class="p">=</span> <span class="n">solver</span><span class="p">(</span><span class="s">&#39;x0&#39;</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="s">&#39;lbg&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;ubg&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">plot</span><span class="p">(</span><span class="nb">full</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">x</span><span class="p">))</span></code></pre></div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">casadi</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="c1"># Two states</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">);</span>   <span class="c1"># Free parameter</span>

<span class="c1"># Expression for ODE right-hand side</span>
<span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="n">vertcat</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">tanh</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># ODE declaration with free parameter</span>
<span class="n">ode</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">p</span><span class="p">,</span><span class="s1">&#39;ode&#39;</span><span class="p">:</span><span class="n">rhs</span><span class="p">}</span>

<span class="c1"># Construct a Function that integrates over 1s</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">integrator</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;cvodes&#39;</span><span class="p">,</span><span class="n">ode</span><span class="p">,{</span><span class="s1">&#39;tf&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># Control vector</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">MX</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Initial state</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
  <span class="c1"># Integrate 1s forward in time:</span>
  <span class="c1"># call integrator symbolically</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&#34;xf&#34;</span><span class="p">]</span>


<span class="c1"># NLP declaration</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">u</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">u</span><span class="p">),</span><span class="s1">&#39;g&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">};</span>

<span class="c1"># Solve using IPOPT</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">nlpsol</span><span class="p">(</span><span class="s1">&#39;solver&#39;</span><span class="p">,</span><span class="s1">&#39;ipopt&#39;</span><span class="p">,</span><span class="n">nlp</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">lbg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ubg</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&#34;x&#34;</span><span class="p">])</span></code></pre></div>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;casadi/casadi.hpp&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">casadi</span><span class="p">;</span>

<span class="n">MX</span> <span class="n">x</span> <span class="o">=</span> <span class="n">MX</span><span class="o">::</span><span class="n">sym</span><span class="p">(</span><span class="s">&#34;x&#34;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// Two states
</span><span class="c1"></span><span class="n">MX</span> <span class="n">p</span> <span class="o">=</span> <span class="n">MX</span><span class="o">::</span><span class="n">sym</span><span class="p">(</span><span class="s">&#34;p&#34;</span><span class="p">);</span>   <span class="c1">// Free parameter
</span><span class="c1"></span>
<span class="c1">// Expression for ODE right-hand side
</span><span class="c1"></span><span class="n">MX</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">);</span>
<span class="n">MX</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">vertcat</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">tanh</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

<span class="c1">// ODE declaration with free parameter
</span><span class="c1"></span><span class="n">MXDict</span> <span class="n">ode</span> <span class="o">=</span> <span class="p">{{</span><span class="s">&#34;x&#34;</span><span class="p">,</span><span class="n">x</span><span class="p">},{</span><span class="s">&#34;p&#34;</span><span class="p">,</span><span class="n">p</span><span class="p">},{</span><span class="s">&#34;ode&#34;</span><span class="p">,</span><span class="n">rhs</span><span class="p">}};</span>

<span class="c1">// Construct a Function that integrates over 1s
</span><span class="c1"></span><span class="n">Function</span> <span class="n">F</span> <span class="o">=</span> <span class="n">integrator</span><span class="p">(</span><span class="s">&#34;F&#34;</span><span class="p">,</span><span class="s">&#34;cvodes&#34;</span><span class="p">,</span><span class="n">ode</span><span class="p">,{{</span><span class="s">&#34;tf&#34;</span><span class="p">,</span><span class="mi">1</span><span class="p">}});</span>

<span class="c1">// Control vector
</span><span class="c1"></span><span class="n">MX</span> <span class="n">u</span> <span class="o">=</span> <span class="n">MX</span><span class="o">::</span><span class="n">sym</span><span class="p">(</span><span class="s">&#34;u&#34;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">DM</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">});</span>  <span class="c1">// Initial state
</span><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Integrate 1s forward in time:
</span><span class="c1"></span>  <span class="c1">// call integrator symbolically
</span><span class="c1"></span>  <span class="n">MXDict</span> <span class="n">res</span> <span class="o">=</span> <span class="n">F</span><span class="p">({{</span><span class="s">&#34;x0&#34;</span><span class="p">,</span><span class="n">x</span><span class="p">},{</span><span class="s">&#34;p&#34;</span><span class="p">,</span><span class="n">u</span><span class="p">(</span><span class="n">k</span><span class="p">)}});</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#34;xf&#34;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// NLP declaration
</span><span class="c1"></span><span class="n">MXDict</span> <span class="n">nlp</span> <span class="o">=</span> <span class="p">{{</span><span class="s">&#34;x&#34;</span><span class="p">,</span><span class="n">u</span><span class="p">},{</span><span class="s">&#34;f&#34;</span><span class="p">,</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">u</span><span class="p">)},{</span><span class="s">&#34;g&#34;</span><span class="p">,</span><span class="n">x</span><span class="p">}};</span>

<span class="c1">// Solve using IPOPT
</span><span class="c1"></span><span class="n">Function</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">nlpsol</span><span class="p">(</span><span class="s">&#34;solver&#34;</span><span class="p">,</span><span class="s">&#34;ipopt&#34;</span><span class="p">,</span><span class="n">nlp</span><span class="p">);</span>
<span class="n">DMDict</span> <span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">DMDict</span><span class="p">{{</span><span class="s">&#34;x0&#34;</span><span class="p">,</span><span class="mf">0.2</span><span class="p">},{</span><span class="s">&#34;lbg&#34;</span><span class="p">,</span><span class="mi">0</span><span class="p">},{</span><span class="s">&#34;ubg&#34;</span><span class="p">,</span><span class="mi">0</span><span class="p">}});</span>
</code></pre></div>
</div>
</div>

<p><div class="col-md-6 text-left">
    <p>CasADi offers a rich set of <em>differentiable</em> operations for its matrix-valued expression graphs, including common <a href="docs/#arithmetic-operations">matrix-valued operations</a>, <a href="docs/#calling-function-objects">serial</a> or <a href="docs/#for-loop-equivalents">parallel</a> function calls, <a href="docs/#non-linear-rootfinding-problems">implicit functions</a>, <a href="docs/#initial-value-problems-and-sensitivity-analysis">integrators</a>, spline-based <a href="docs/#using-lookup-tables">lookup tables</a>, and <a href="docs/#document-custom">external codes</a>.</p>
    <p>These building blocks allow the user to code a wide variety of <a href="docs/#document-ocp">optimal control problem</a> (OCP) formulations.</p>
    <p>For example, a single shooting code can be created by embedding a call to an integrator in an NLP declaration.</p></p>

<p></div>
</div></p>

    <footer>
      <div class="container">
        <div class="row justify-content-md-center">
          <div class="col-md-auto text-center">
            <ul id="social" class="list-inline">
              
                <li class="list-inline-item">
                  <a href="https://github.com/casadi/casadi" title="github">
                    <i class="fa fa-github"></i>
                  </a>
                </li>
              
                <li class="list-inline-item">
                  <a href="https://twitter.com/casadi_software" title="twitter">
                    <i class="fa fa-twitter"></i>
                  </a>
                </li>
              
                <li class="list-inline-item">
                  <a href="https://www.youtube.com/channel/UC3VDpv5Pi3R-a2VkcJN1RLw" title="youtube">
                    <i class="fa fa-youtube"></i>
                  </a>
                </li>
              
            </ul>
            <p class="copyright">Copyright 2018.</p>
          </div>
        </div>
      </div>
    </footer>

    
    <script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    
    <script src="https://web.casadi.org/_js/bootstrap.min.js"></script>

    
    <script src="https://web.casadi.org/_js/scripts.js"></script>

    
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML">
</script>

    
  </body>

</html>

